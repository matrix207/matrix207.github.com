<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Matrix207&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Matrix207's Blog">
<meta property="og:url" content="http://matrix207.github.com/page/17/index.html">
<meta property="og:site_name" content="Matrix207's Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Matrix207's Blog">
<meta name="twitter:description">
  
    <link rel="alternate" href="/atom.xml" title="Matrix207&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Matrix207&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://matrix207.github.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-copy-file-with-progress-bar" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/01/04/copy-file-with-progress-bar/" class="article-date">
  <time datetime="2013-01-03T16:00:00.000Z" itemprop="datePublished">2013-01-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/01/04/copy-file-with-progress-bar/">Copy file with progress bar</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="Copy-file-with-progress-bar"><a href="#Copy-file-with-progress-bar" class="headerlink" title="Copy file with progress bar"></a>Copy file with progress bar</h4><pre><code>#!/usr/bin/bash

print_bar() {        # print the bar 

    local Count=$1
    local Max=$2
    local Remain=$3
    local Elapsed=$4
    local Speed=$5
    local LenBar=50
    if [ $# -eq 6 ]; then
        LenBar=$6
    fi
    if [ ${Count} -gt ${Max} ]; then
        Count=${Max}
    fi
    local Percent=$(((100*Count)/Max))
    local BarPercent=$(((LenBar*Percent)/100))

    if [ ${Percent} -eq 100 ]; then
        Remain=0
    fi

    local BarProgress=$(for i in $(seq ${BarPercent}); do echo -n &apos;=&apos;; done)
    BarProgress=&quot;${BarProgress:0:${#BarProgress}}&gt;&quot;
    local Nxt=$((LenBar-BarPercent))
    local BarPad=$(for i in $(seq ${Nxt}); do echo -n &apos;.&apos;; done)

    local TElapsed=$(date -u -d @$Elapsed +%Hh%Mm%Ss)
    TElapsed=$(echo ${TElapsed} | sed -e &quot;s/^00h//&quot; -e &quot;s/^00m//&quot;)

    local TRemain=$(date -u -d @$Remain +%Hh%Mm%Ss)
    TRemain=$(echo ${TRemain} | sed -e &quot;s/^00h//&quot; -e &quot;s/^00m//&quot;)

    local larg=$(tput cols)
    if [ ${TimeElapsed} -gt ${TimeDiff} ] &amp;&amp; [ ${EndBar} -eq 0 ] &amp;&amp; [ ${Remain} -gt 0 ]; then        
        local mess0=&quot;[ ${Percent}% ][${BarProgress}${BarPad}] (${Speed}K/s) [ Remain: ${TRemain} Spent: ${TElapsed} ]&quot;
        local mess=&quot; :: ${mess0}&quot;
        local mess1=&quot;${TAB_}${mess0}&quot;
        echo -en &quot;\r${mess1}\033[K&quot;
        if [ ${#mess} -gt ${larg} ]; then
            echo -ne &quot;\r\033[1A&quot; src/lib/progbar
        fi
    else
        echo -en &quot;\r${TAB_}[ ${Percent}% ][${BarProgress}${BarPad}][ Time: ${TElapsed} ]\033[K&quot;
    fi
}

if [ $# -eq 2 ]; then
    cp $1 $2 &amp;
fi

file_size_org=0
file_size_dst=0
file_size_org=$(du $1 | awk &apos;{print $1}&apos;)
#echo org size ${file_size_org}

TimeDiff=10
EndBar=1
TimeStart=$(date +%s)
while [ ${file_size_org} -gt ${file_size_dst} ] &amp;&amp; sleep 1
do
    file_size_dst=$(du $2 | awk &apos;{print $1}&apos;)
    TimeNow=$(date +%s)
    TimeElapsed=$(( TimeNow-TimeStart ))
    Speed=$(( file_size_dst/TimeElapsed ))
    TimeRemain=$(( (file_size_org-file_size_dst)/Speed ))
#    echo dst size ${file_size_dst}
    print_bar ${file_size_dst} ${file_size_org} ${TimeRemain} ${TimeElapsed} ${Speed}
#    print_bar ${BytesLoadNow} ${BytesLoadMax} ${TimeRemain} ${TimeElapsed} ${Speed} ${LenBar}
done
echo
</code></pre><h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><ul>
<li><a href="http://sourceforge.net/projects/raider/files/?source=navbar" target="_blank" rel="external">raider: src/lib/progbar</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://matrix207.github.com/2013/01/04/copy-file-with-progress-bar/" data-id="cin61d0g80029fyiz6i8n7mrd" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/">shell</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-svn-project-revision-monitor-linux" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2012/12/20/svn-project-revision-monitor-linux/" class="article-date">
  <time datetime="2012-12-19T16:00:00.000Z" itemprop="datePublished">2012-12-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2012/12/20/svn-project-revision-monitor-linux/">SVN project revision monitor on Linux</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Monitor-revision-of-SVN-repository-auto-send-change-log-to-user-by-mail"><a href="#Monitor-revision-of-SVN-repository-auto-send-change-log-to-user-by-mail" class="headerlink" title="Monitor revision of SVN repository, auto send change log to user by mail"></a>Monitor revision of SVN repository, auto send change log to user by mail</h3><p><strong>pmt.sh</strong>  </p>
<pre><code>#!/usr/bin/bash
################################################################################
# 自动获取SVN版更新信息,并发送邮件通知
# 历史记录:
#   2012-12-20    v1.0    Dennis  Create
#   2012-12-21    v1.1    Dennis  增加注释,加入文件存在判断和写日志
#   2012-12-24    v1.2    Dennis  增加log日期注释,加入文件存在判断和写日志
################################################################################

conf_file=/etc/pmt.conf
log_file=/tmp/pmt.log

cur_time=`date &quot;+%F %R:%S&quot;`
echo $cur_time &quot;pmt start&quot; &gt;&gt; $log_file

# 如果配置文件不存在, 退出程序
if [ ! -f $conf_file ]
then
    echo &quot;Not found $conf_file&quot; &gt;&gt; $log_file
    goto _EXIT
fi

# Fields: project#url#revision#mail
# 每行列数目为4,使用#号作为分割符号提取行信息到数组arr 
field_size=4
arr=($(awk -F&apos;#&apos; &apos;{print $1,$2,$3,$4}&apos; $conf_file))

# 以4个元素为一个单位，获取数组大小, 以模仿二维数组
item_size=$[${#arr[@]}/$field_size]

while true 
do
    # 循环二维数组(模仿)
    for ((i=0;i&lt;$item_size;i++))
    do
    {
    index=$[i*$field_size]

    prj=${arr[$[index+0]]}
    url=${arr[$[index+1]]}
    rev_old=${arr[$[index+2]]}
    # 提取最新版本号
    rev_new=$(svn info $url | awk &apos;NR==8{print $NF}&apos;)

    if (( $rev_new &gt; $rev_old ))
    then
        # 更新版本号到数组
        arr[$[index+2]]=$rev_new

        # 提取log信息
        svn log $url -r $rev_new:$rev_old &gt; svn.log

        subject=&quot;[svn monitor]&quot;${arr[$[index+0]]}&quot; update&quot;
        to=${arr[$[index+3]]}

        # 发送邮件通知
        mail -s &quot;$subject&quot; $to &lt; svn.log

        # 修改为最新版本号
        # sed中使用变量要加上单引号
        sed -i &apos;/&apos;$prj&apos;/{s/\(.*#.*#\)[0-9]\+/\1&apos;$rev_new&apos;/}&apos; $conf_file

        cur_time=`date &quot;+%F %R:%S&quot;`
        echo $cur_time &quot;${arr[$[index+0]]} update, mail to $to&quot; &gt;&gt; $log_file
    fi
    }
    done
    sleep 5
done

:_EXIT
cur_time=`date &quot;+%F %R:%S&quot;`
echo $cur_time &quot;pmt exit&quot; &gt;&gt; $log_file
exit 0
</code></pre><p><strong>pmt.conf</strong></p>
<pre><code>project01#http://172.168.1.122/repos/dev/project01#18559#usr01@gmail.com
project02#http://172.168.1.122/repos/dev/project02#18635#usr02@gmail.com
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://matrix207.github.com/2012/12/20/svn-project-revision-monitor-linux/" data-id="cin61d0g3001tfyiz3bvxzwhc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/awk/">awk</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mail/">mail</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sed/">sed</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/shell/">shell</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/svn/">svn</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-monitor-hardware-status" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2012/12/17/monitor-hardware-status/" class="article-date">
  <time datetime="2012-12-16T16:00:00.000Z" itemprop="datePublished">2012-12-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/windows/">windows</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2012/12/17/monitor-hardware-status/">hardware monitor</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Most of the motherboard can monitor hardware right now, what they can support is<br>depends on the sensor used. So, if you want to known how monitor, you should<br>get the type of sensor chip. I know supermicro x9scl use Nuvoton NCT6776F  and<br>X8SIL use Winbond W83627DHG-P. Once get this message, you can search the<br>datasheet, and get the method how to do it.</p>
<p>On different operation system, have different method to read/write I/O port. I<br>know <a href="http://www.internals.com/" target="_blank" rel="external">WinIO</a> on windows, IoWrite8/16/32 on Linux.</p>
<p>There is a good open source software “Open Hardware Monitor”, which develop by<br>C# language. It support almost all the motherboard.</p>
<hr>
<h1 id="1-Datasheet-of-chips"><a href="#1-Datasheet-of-chips" class="headerlink" title="1. Datasheet of chips"></a>1. Datasheet of chips</h1><p>Look the access channels on file <a href="http://webshop.atlantikelektronik.de/Mailings/NCT6776F_NCT6776D_Datasheet_V1_2.pdf" target="_blank" rel="external">NCT6776F_NCT6776D_Datasheet_V1_2</a><br> page 275</p>
<pre><code>19.2 ACCESS CHANNELS
There are two different channels to set up/access the GPIO ports. The first one is the indirect access via register
2E/2F (4E/4F, it depends by HEFRAS trapping). The registers can be read / written only when the respective
logical device ID and port number are selected.
</code></pre><p>known that rigister index is 0x2E, and data Input/Output port is 0x2F </p>
<p>On page 54<br>    To program the NCT6776F / NCT6776D configuration registers, the following configuration procedures must be<br>    followed in sequence:<br>    (1). Enter the Extended Function Mode.<br>    (2). Configure the configuration registers.<br>    (3). Exit the Extended Function Mode.</p>
<pre><code>7.1.1 Enter the Extended Function Mode
To place the chip into the Extended Function Mode, two successive writes of 0x87 must be applied to Extended
Function Enable Registers (EFERs, i.e. 2Eh or 4Eh).

7.1.2 Configure the Configuration Registers
The chip selects the Logical Device and activates the desired Logical Devices through Extended Function Index
Register (EFIR) and Extended Function Data Register (EFDR). The EFIR is located at the same address as the
EFER, and the EFDR is located at address (EFIR+1).
First, write the Logical Device Number (i.e. 0x07) to the EFIR and then write the number of the desired Logical
Device to the EFDR. If accessing the Chip (Global) Control Registers, this step is not required.

Secondly, write the address of the desired configuration register within the Logical Device to the EFIR and then
write (or read) the desired configuration register through the EFDR.

7.1.3 Exit the Extended Function Mode
To exit the Extended Function Mode, writing 0xAA to the EFER is required. Once the chip exits the Extended
Function Mode, it is in the normal running mode and is ready to enter the configuration mode.
</code></pre><p>Software Programming Example<br>The following example is written in Intel 8086 assembly language. It assumes that the EFER is located at 2Eh, so<br>the EFIR is located at 2Eh and the EFDR is located at 2Fh. If the HEFRAS (CR[26h] bit 6 showing the value of<br>the strap pin at power on) is set, 2Eh can be directly replaced by 4Eh and 2Fh replaced by 4Fh.<br>This example programs the configuration register F0h (clock source) of logical device 1 (UART A) to the value of<br>3Ch (24MHz). First, one must enter the Extended Function Mode, then setting the Logical Device Number (Index<br>07h) to 01h. Then program index F0h to 3Ch. Finally, exit the Extended Function Mode.</p>
<pre><code>;-----------------------------------------------------
; Enter the Extended Function Mode
;-----------------------------------------------------
MOV DX, 2EH
MOV AL, 87H
OUT DX, AL
OUT DX, AL
;-----------------------------------------------------------------------------
; Configure Logical Device 1, Configuration Register CRF0
;-----------------------------------------------------------------------------
MOV DX, 2EH
MOV AL, 07H
OUT DX, AL
; point to Logical Device Number Reg.
MOV DX, 2FH
MOV AL, 01H
OUT DX, AL
; select Logical Device 1
;
MOV DX, 2EH
MOV AL, F0H
OUT DX, AL
; select CRF0
MOV DX, 2FH
MOV AL, 3CH
OUT DX, AL
; update CRF0 with value 3CH
;-----------------------------------------------
; Exit the Extended Function Mode
;----------------------------------------------
MOV DX, 2EH
MOV AL, AAH
OUT DX, AL
</code></pre><hr>
<h1 id="2-Open-Hardware-Monitor"><a href="#2-Open-Hardware-Monitor" class="headerlink" title="2. Open Hardware Monitor"></a>2. Open Hardware Monitor</h1><p><a href="http://openhardwaremonitor.org/" target="_blank" rel="external">Homepage</a><br><a href="http://code.google.com/p/open-hardware-monitor/" target="_blank" rel="external">source code</a>  </p>
<p>The Open Hardware Monitor is a free open source software that monitors<br>temperature sensors, fan speeds, voltages, load and clock speeds of a computer.  </p>
<p>As below, introduct how to use VC++ to monitor HW status on windows: </p>
<p>1). modify computer.cs，add some interface like GetFanSpeed(). if have problem , look report function .<br>2). set the project properity to output class library.<br>3). Reference <a href="http://matrix207.github.com/2012/09/16/VC++-Use-CSharp-Dll/" target="_blank" rel="external">VC++ use C# DLL</a>  </p>
<h2 id="1-1-Analyze-open-hardware-monitor"><a href="#1-1-Analyze-open-hardware-monitor" class="headerlink" title="1.1 Analyze open-hardware-monitor"></a>1.1 Analyze open-hardware-monitor</h2><p>Use Winbond W83627DHG-P chip as example.  </p>
<p>A description about how to monitor hardware, see this<br><a href="http://www.supermicro.com/support/faqs/faq.cfm?faq=12015" target="_blank" rel="external">http://www.supermicro.com/support/faqs/faq.cfm?faq=12015</a></p>
<pre><code>Question
  I&apos;m trying to access the Winbond 83627DHG-P IO chip on the motherboard X8SIL. 
  We want to use the LMsensor. Do you have the offset codes for the smbus?

Answer
  Bus Type = ISAIO/SMBus
  One W83627DHG-P

  Windbond W83627DHG-P, Slave Address=0x2d (0x5a in 8-Bit format)
  OR IndexReg=A15, DataReg=A16
  =============================================================

  Fan1 Fan Speed, Bank 0, Offset 0x29 RPM = 1350000/8/Data
  Fan2 Fan Speed, Bank 5, Offset 0x53 RPM = 1350000/8/Data
  Fan3 Fan Speed, Bank 0, Offset 0x28 RPM = 1350000/8/Data
  Fan4 Fan Speed, Bank 0, Offset 0x3f RPM = 1350000/8/Data
  Fan5 Fan Speed, Bank 0, Offset 0x2a RPM = 1350000/8/Data

  CPU Voltage, Bank 0, Offset 0x20 Voltage = Data* 0.008
  -12V Voltage, Bank 0, Offset 0x26 Voltage = ((Data*0.008-2.048)/(10./242.))+2.048
  +12V Voltage, Bank 0, Offset 0x21 Voltage = Data* 0.008/ (10./66.2)

  AVCC Voltage, Bank 0, Offset 0x22 Voltage = Data* 0.016
  3.3Vcc Voltage, Bank 0, Offset 0x23 Voltage = Data* 0.016

  DIMM Voltage, Bank 0, Offset 0x24 Voltage = Data* 0.008
  +5V Voltage, Bank 0, Offset 0x25 Voltage = Data* 0.008/ (10./40.)
  +3.3VSb Voltage, Bank 5, Offset 0x50 Voltage = Data* 0.016

  VBAT Voltage, Bank 5, Offset 0x51 Voltage = Data* 0.016

  CPU Temperature, Bank 1, Offset 0x50 Temperature = Data

  System Temperature, Bank 2, Offset 0x50 Temperature = Data

  Chassis Intrusion, Bank 0, Offset 0x42, BitMask 0x10 1 = Bad, 0 = Good
  (Clear Bit: Bank 0, Offset 0x46, BitMask 0x80)

  Power Supply Failure, GP23(From W83627DHG-P) 1 = Good, 0 = Bad
</code></pre><hr>
<h3 id="1-1-1-File-Hardware-LPC-LPCIO-cs"><a href="#1-1-1-File-Hardware-LPC-LPCIO-cs" class="headerlink" title="1.1.1 File: Hardware/LPC/LPCIO.cs"></a>1.1.1 File: Hardware/LPC/LPCIO.cs</h3><p>IO Ports</p>
<pre><code>// I/O Ports
private readonly ushort[] REGISTER_PORTS = new ushort[] { 0x2E, 0x4E };
private readonly ushort[] VALUE_PORTS = new ushort[] { 0x2F, 0x4F };
</code></pre><p>Winbond, Nuvoton, Fintek</p>
<pre><code>private const byte FINTEK_VENDOR_ID_REGISTER = 0x23;
private const ushort FINTEK_VENDOR_ID = 0x1934;

private const byte WINBOND_NUVOTON_HARDWARE_MONITOR_LDN = 0x0B;

private const byte F71858_HARDWARE_MONITOR_LDN = 0x02;
private const byte FINTEK_HARDWARE_MONITOR_LDN = 0x04;

private void WinbondNuvotonFintekEnter() {
  Ring0.WriteIoPort(registerPort, 0x87);
  Ring0.WriteIoPort(registerPort, 0x87);
}

private void WinbondNuvotonFintekExit() {
  Ring0.WriteIoPort(registerPort, 0xAA);
}
</code></pre><p>ITE</p>
<pre><code>private const byte IT87_ENVIRONMENT_CONTROLLER_LDN = 0x04;
private const byte IT8705_GPIO_LDN = 0x05;
private const byte IT87XX_GPIO_LDN = 0x07;
private const byte IT87_CHIP_VERSION_REGISTER = 0x22;

private void IT87Enter() {
  Ring0.WriteIoPort(registerPort, 0x87);
  Ring0.WriteIoPort(registerPort, 0x01);
  Ring0.WriteIoPort(registerPort, 0x55);
  Ring0.WriteIoPort(registerPort, 0x55);
}

private void IT87Exit() {
  Ring0.WriteIoPort(registerPort, CONFIGURATION_CONTROL_REGISTER);
  Ring0.WriteIoPort(valuePort, 0x02);
}
</code></pre><p>SMSC</p>
<pre><code>private void SMSCEnter() {
  Ring0.WriteIoPort(registerPort, 0x55);
}

private void SMSCExit() {
  Ring0.WriteIoPort(registerPort, 0xAA);
}
</code></pre><h4 id="How-to-get-value"><a href="#How-to-get-value" class="headerlink" title="How to get value:"></a>How to get value:</h4><p>call ReadByte to get value:  </p>
<pre><code>byte id = ReadByte(CHIP_ID_REGISTER);
byte revision = ReadByte(CHIP_REVISION_REGISTER);
</code></pre><p>look at function ReadByte:</p>
<pre><code>private byte ReadByte(byte register) {
  Ring0.WriteIoPort(registerPort, register);
  return Ring0.ReadIoPort(valuePort);
}
</code></pre><p>first, write register value to registerPort;<br>second, read value from valueport. </p>
<hr>
<h3 id="1-1-2-File-Hardware-LPC-W836XX-cs"><a href="#1-1-2-File-Hardware-LPC-W836XX-cs" class="headerlink" title="1.1.2 File: Hardware/LPC/W836XX.cs"></a>1.1.2 File: Hardware/LPC/W836XX.cs</h3><h4 id="How-to-get-value-1"><a href="#How-to-get-value-1" class="headerlink" title="How to get value:"></a>How to get value:</h4><pre><code>// Hardware Monitor
private const byte ADDRESS_REGISTER_OFFSET = 0x05;
private const byte DATA_REGISTER_OFFSET = 0x06;

// Hardware Monitor Registers
private const byte BANK_SELECT_REGISTER = 0x4E;

private byte ReadByte(byte bank, byte register) {
  Ring0.WriteIoPort(
     (ushort)(address + ADDRESS_REGISTER_OFFSET), BANK_SELECT_REGISTER);
  Ring0.WriteIoPort(
     (ushort)(address + DATA_REGISTER_OFFSET), bank);
  Ring0.WriteIoPort(
     (ushort)(address + ADDRESS_REGISTER_OFFSET), register);
  return Ring0.ReadIoPort(
    (ushort)(address + DATA_REGISTER_OFFSET));
} 
</code></pre><h4 id="What-is-the-value-of-“address”"><a href="#What-is-the-value-of-“address”" class="headerlink" title="What is the value of “address”:"></a>What is the value of “address”:</h4><p>set value by construction</p>
<pre><code>public W836XX(Chip chip, byte revision, ushort address) {
  this.address = address;
  this.revision = revision;
  this.chip = chip;
  ...
}
</code></pre><p>on LPCIO.cs, found the calling code:</p>
<pre><code>private const byte BASE_ADDRESS_REGISTER = 0x60;

ushort address = ReadWord(BASE_ADDRESS_REGISTER);

switch (chip) {
  case Chip.W83627DHG:
  case Chip.W83627DHGP:
  case Chip.W83627EHF:
  case Chip.W83627HF:
  case Chip.W83627THF:
  case Chip.W83667HG:
  case Chip.W83667HGB:
  case Chip.W83687THF:
    superIOs.Add(new W836XX(chip, revision, address));
    break;
  ...
}
</code></pre><h4 id="Get-temperature"><a href="#Get-temperature" class="headerlink" title="Get temperature:"></a>Get temperature:</h4><pre><code>private readonly byte[] TEMPERATURE_REG = new byte[] { 0x50, 0x50, 0x27 };
private readonly byte[] TEMPERATURE_BANK = new byte[] { 1, 2, 0 };

for (int i = 0; i &lt; temperatures.Length; i++) {
  int value = ((sbyte)ReadByte(TEMPERATURE_BANK[i], 
    TEMPERATURE_REG[i])) &lt;&lt; 1;
  if (TEMPERATURE_BANK[i] &gt; 0) 
    value |= ReadByte(TEMPERATURE_BANK[i],
      (byte)(TEMPERATURE_REG[i] + 1)) &gt;&gt; 7;

  float temperature = value / 2.0f;
  if (temperature &lt;= 125 &amp;&amp; temperature &gt;= -55 &amp;&amp; !peciTemperature[i]) {
    temperatures[i] = temperature;
  } else {
    temperatures[i] = null;
  }
}
</code></pre><h4 id="Get-fan-speed"><a href="#Get-fan-speed" class="headerlink" title="Get fan speed:"></a>Get fan speed:</h4><p>call ReadByte(FAN_TACHO_BANK[i], FAN_TACHO_REG[i]) to get speed value to “count”<br>, then set real fan spee to array variable “fans[]“.</p>
<pre><code>private readonly byte[] FAN_TACHO_REG = 
  new byte[] { 0x28, 0x29, 0x2A, 0x3F, 0x53 };
private readonly byte[] FAN_TACHO_BANK = 
  new byte[] { 0, 0, 0, 0, 5 };       
private readonly byte[] FAN_BIT_REG =
  new byte[] { 0x47, 0x4B, 0x4C, 0x59, 0x5D };
private readonly byte[] FAN_DIV_BIT0 = new byte[] { 36, 38, 30, 8, 10 };
private readonly byte[] FAN_DIV_BIT1 = new byte[] { 37, 39, 31, 9, 11 };
private readonly byte[] FAN_DIV_BIT2 = new byte[] { 5, 6, 7, 23, 15 };


ulong bits = 0;
for (int i = 0; i &lt; FAN_BIT_REG.Length; i++)
    bits = (bits &lt;&lt; 8) | ReadByte(0, FAN_BIT_REG[i]);

ulong newBits = bits;
for (int i = 0; i &lt; fans.Length; i++) {
    int count = ReadByte(FAN_TACHO_BANK[i], FAN_TACHO_REG[i]);

    // assemble fan divisor
    int divisorBits = (int)(
            (((bits &gt;&gt; FAN_DIV_BIT2[i]) &amp; 1) &lt;&lt; 2) |
            (((bits &gt;&gt; FAN_DIV_BIT1[i]) &amp; 1) &lt;&lt; 1) |
            ((bits &gt;&gt; FAN_DIV_BIT0[i]) &amp; 1));
    int divisor = 1 &lt;&lt; divisorBits;

    float value = (count &lt; 0xff) ? 1.35e6f / (count * divisor) : 0;
    fans[i] = value;

    // update fan divisor
    if (count &gt; 192 &amp;&amp; divisorBits &lt; 7) 
        divisorBits++;
    if (count &lt; 96 &amp;&amp; divisorBits &gt; 0)
        divisorBits--;

    newBits = SetBit(newBits, FAN_DIV_BIT2[i], (divisorBits &gt;&gt; 2) &amp; 1);
    newBits = SetBit(newBits, FAN_DIV_BIT1[i], (divisorBits &gt;&gt; 1) &amp; 1);
    newBits = SetBit(newBits, FAN_DIV_BIT0[i], divisorBits &amp; 1);
}
</code></pre><hr>
<h1 id="3-lm-sensors"><a href="#3-lm-sensors" class="headerlink" title="3. lm-sensors"></a>3. lm-sensors</h1><p><strong>Introduction</strong></p>
<ul>
<li><a href="http://www.lm-sensors.org/wiki/Download" target="_blank" rel="external">source code download</a>  </li>
<li><a href="http://www.lm-sensors.org/browser/lm-sensors/trunk/doc/developers" target="_blank" rel="external">developer</a>  </li>
<li><a href="http://blog.csdn.net/zhenwenxian/article/details/5331079" target="_blank" rel="external">Lm_sensors和相关技术介绍</a>  </li>
</ul>
<p><strong>lm-sensors configurations</strong>  </p>
<ul>
<li><a href="http://www.lm-sensors.org/wiki/Configurations/Intel" target="_blank" rel="external">Intel</a></li>
<li><a href="http://www.lm-sensors.org/wiki/Configurations/SuperMicro" target="_blank" rel="external">SuperMicro</a>  </li>
<li><a href="http://www.lm-sensors.org/wiki/Configurations/Gigabyte" target="_blank" rel="external">Gigabyte</a></li>
<li><a href="http://www.lm-sensors.org/wiki/Configurations/Asus" target="_blank" rel="external">Asus</a></li>
<li><a href="http://www.lm-sensors.org/wiki/Configurations" target="_blank" rel="external">more</a>  </li>
</ul>
<p><strong>Install</strong></p>
<p>install: <code>yum install lm_sensors</code><br>monitor: <code>sensors</code>  </p>
<hr>
<h1 id="4-Use-WinIO"><a href="#4-Use-WinIO" class="headerlink" title="4. Use WinIO"></a>4. Use WinIO</h1><h2 id="watchdog"><a href="#watchdog" class="headerlink" title="watchdog"></a>watchdog</h2><p>reset Watchdog timeout</p>
<p>Assembly code:</p>
<pre><code>mov    dx, 2eh
mov    al, 87h
out    dx, al
out    dx, al    ; write 0x87 to port 0x2e twice
mov    al, 07h
out    dx, al    ; set Register 0x07 to Index Port
mov    dx, 2fh
mov    al, 08h
out    dx, al    ; switch to Watchdog control page

mov    dx, 2eh
mov    al, f6h
out    dx, al    ; set Register 0xf6 to Index Port
mov    dx, 2fh
mov    al, ah
out    dx, al    ; write time-out value 0x0A to Data Port

mov    dx, 2eh
mov    al, aah
out    dx, al    ; write 0xaa to port 0x2e once
</code></pre><p>C code:</p>
<pre><code>IoWrite8(0x2E,0x87); //write 0x87 to port 0x2e twice
IoWrite8(0x2E,0x87);
IoWrite8(0x2E,0x07); //set Register 0x07 to Index Port
IoWrite8(0x2F,0x08); //switch to Watchdog control page

IoWrite8(0x2E,0xF6); //set Register 0xf6 to Index Port
IoWrite8(0x2F,0x0A); //write time-out value 0x0A to Data Port

IoWrite8(0x2E,0xAA); //write 0xaa to port 0x2e once
</code></pre><p>Want more, visit my windows watchdog project <a href="https://github.com/matrix207/VC/tree/master/watchdog" target="_blank" rel="external">here</a></p>
<p><a href="http://matrix207.github.com/2012/09/16/winio-sample/" target="_blank" rel="external">WinIO sample</a></p>
<hr>
<h1 id="5-Reference"><a href="#5-Reference" class="headerlink" title="5. Reference:"></a>5. Reference:</h1><ul>
<li><a href="http://www.nuvoton.com/hq/enu/ProductAndSales/ProductLines/CloudAndComputingIC/SuperIO/SuperIOforDesktopandIPC/Documents/W83627DHG-P_W83627DHG-PT.pdf" target="_blank" rel="external">W83627DHG-P W83627DHG-PT NUVOTON LPC I/O</a></li>
<li><a href="http://webshop.atlantikelektronik.de/Mailings/NCT6776F_NCT6776D_Datasheet_V1_2.pdf" target="_blank" rel="external">NCT6776F_NCT6776D_Datasheet_V1_2</a></li>
<li><a href="http://lxr.free-electrons.com/source/drivers/watchdog/w83627hf_wdt.c" target="_blank" rel="external">linux/drivers/watchdog/w83627hf_wdt.c</a></li>
<li><a href="http://lxr.free-electrons.com/source/drivers/watchdog/iTCO_vendor_support.c" target="_blank" rel="external">linux/drivers/watchdog/iTCO_vendor_support.c</a></li>
<li><a href="http://lxr.free-electrons.com/source/drivers/hwmon/w83627ehf.c" target="_blank" rel="external">linux/drivers/hwmon/w83627ehf.c</a></li>
<li><a href="http://bbs.csdn.net/topics/390214041" target="_blank" rel="external">watchdog clear</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://matrix207.github.com/2012/12/17/monitor-hardware-status/" data-id="cin61d0g60025fyizj15bsx3p" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/hardware-monitor/">hardware monitor</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-visual-studio-project-atuo-compile" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2012/12/17/visual-studio-project-atuo-compile/" class="article-date">
  <time datetime="2012-12-16T16:00:00.000Z" itemprop="datePublished">2012-12-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2012/12/17/visual-studio-project-atuo-compile/">Viusal studio project auto compile</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Windows-Requirements"><a href="#Windows-Requirements" class="headerlink" title="Windows Requirements"></a>Windows Requirements</h3><pre><code>microsoft visual studio 2005 or newer
subversion 1.7.7 or newer

add the path of command tool &quot;svn&quot; and &quot;devenv&quot; to environment path
</code></pre><h3 id="check-out-project-by-svn"><a href="#check-out-project-by-svn" class="headerlink" title="check out project by svn"></a>check out project by svn</h3><p><code>svn co project_svn_url output_path -r revision</code>  </p>
<p><strong>svn_co.bat</strong>  </p>
<pre><code>@ECHO off&amp;SETlocal enabledelayedexpansion 

REM Useage: svn_co.bat svn_src_url out_path revision log_file

SET func=&quot;check out project&quot;

SET src_url=%1
SET out_path=%2
SET src_rev=%3
SET log_file=%4
SET parameters=%src_url%

IF NOT &quot;%out_path%&quot;==&quot;&quot; SET parameters=!parameters! %out_path%

IF NOT &quot;%src_rev%&quot;==&quot;&quot; SET parameters=!parameters! -r %src_rev%

SET log_file_tmp=NUL
IF NOT &quot;%log_file%&quot;==&quot;&quot; SET log_file_tmp=%log_file%

svn co !parameters!

SET /a ret_code=%ERRORLEVEL%
IF %ret_code% EQU 0 (
    @ECHO svn checkout success
) ELSE (
    @ECHO svn checkout fail
)
</code></pre><h3 id="use-devenv-for-compile"><a href="#use-devenv-for-compile" class="headerlink" title="use devenv for compile"></a>use devenv for compile</h3><p><code>devenv solution_file /build &quot;release|win32&quot;</code>  </p>
<p><strong>compile.bat</strong>  </p>
<pre><code>@ECHO off

REM Useage: compile.bat solution_file

SET sln_file=%1
SET cfg_build=&quot;Release|Win32&quot;

devenv %sln_file% /build %cfg_build%

SET /A retval=%ERRORLEVEL%
EXIT /B %retval%
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://matrix207.github.com/2012/12/17/visual-studio-project-atuo-compile/" data-id="cin61d0g1001pfyiz2zotrcmx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/auto-compile/">auto compile</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/batch/">batch</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-svn-project-revision-monitor" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2012/12/15/svn-project-revision-monitor/" class="article-date">
  <time datetime="2012-12-14T16:00:00.000Z" itemprop="datePublished">2012-12-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/windows/">windows</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2012/12/15/svn-project-revision-monitor/">SVN project revision monitor</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Monitor-revision-change-of-SVN-repository"><a href="#Monitor-revision-change-of-SVN-repository" class="headerlink" title="Monitor revision change of SVN repository"></a>Monitor revision change of SVN repository</h3><p><strong>pmt.bat</strong></p>
<pre><code>@echo off
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: 功能: 监控SVN版本库项目,发现更新自动发送邮件通知 
:: 工具: 
::            subversion    www.sourceforge.net/projects/win32svn
::            blat        www.blat.net
:: 历史:
::        v1.00    2012-12-12    Dennis    create project
::        v1.01    2012-12-13    Dennis    修改邮件附件发送为文本内容发送 
::                                    增加自动更新配置文件中的版本号 
::        v1.02    2012-12-14    Dennis    增加单件实现
::
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
setlocal enabledelayedexpansion

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: run as a singleton
set &quot;app_title=pmt&quot;
tasklist /v | find &quot;%app_title%&quot;&gt;nul &amp;&amp; goto _EXIT
title %app_title%

:: 切换到批处理文件所在目录 
cd /d %~dp0

set app_log=pmt.log
set log_file=svnlog.txt
set cfg_path=%cd%\conf
set cfg_file=%cfg_path%\*.conf
echo %date% %time% start application &gt;&gt; %app_log%

set /a prj_index=1
for /f &quot;tokens=* delims=&quot; %%i in (&apos;dir /s /b /a-d &quot;%cfg_file%&quot;&apos;) do (
    echo call :_CONF_INFO &quot;%%i&quot; !prj_index! &gt;&gt; %app_log%
    call :_CONF_INFO &quot;%%i&quot; !prj_index!
    set prj_!prj_index!_file=&quot;%%i&quot;
    set /a prj_index+=1
)

set /a prj_count=!prj_index!-1
echo Monitor %prj_count% project &gt;&gt; %app_log%
set /a last_rev=0

set &quot;pmt_mail=example@gmail.com&quot;
set &quot;f=-f %pmt_mail%&quot;
set &quot;c=-charset GBK&quot;
:_CHK_REV
:: Check svn revision
:: Send mail by blat when there exist new revision in svn repository
for /l %%i in (1,1,%prj_count%) do (
    echo call :_SVN_LAST_REV !prj_%%i_url! last_rev &gt;&gt; %app_log%
    call :_SVN_LAST_REV !prj_%%i_url! last_rev
    if !last_rev! GTR !prj_%%i_rev! (
        echo !prj_%%i_url! !last_rev! ^&gt; !prj_%%i_rev!
        set /a prj_%%i_rev+=1
        echo project: !prj_%%i_name! &gt; %log_file%
        echo url    : !prj_%%i_url! &gt;&gt; %log_file%
        svn log !prj_%%i_url! -r !last_rev!:!prj_%%i_rev! &gt;&gt; %log_file%

        echo send mail to !prj_%%i_mail! &gt;&gt; %app_log%

        set &quot;s=-s &quot;[svn monitor] !prj_%%i_name! update&quot;&quot;
        set &quot;t=-t !prj_%%i_mail!&quot;
        blat %log_file% !s! %f% !t! %c%
        set prj_%%i_rev=!last_rev!

        :: 更新配置文件版本号 
        :: sed的组括号为批处理特殊字符,需使用^转义 
        :: 如果不转义, 可以采用call的方式 
        :: call :_UPDATE_REV !prj_%%i_file! !last_rev!
        sed -i &apos;/rev=/{s/\^(rev=\^)[0-9]\+/\1!last_rev!/}&apos; !prj_%%i_file!
    )
)
:: sleep 5 seconds
ping -n 5 127.1 &gt; nul    
goto :_CHK_REV

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
::exit
:_EXIT
pause
exit /b 0


::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
::Function

:_CONF_INFO &lt;config file&gt; &lt;project index&gt;
:: Get configure info
:: usebackq 用以解决文件路径中包含空格的情况 
FOR /F &quot;usebackq tokens=1,2* delims==&quot; %%i in (%1) do (
    set &quot;prj_%2_%%i=%%j&quot;
)
GOTO :EOF

:_SVN_LAST_REV &lt;url&gt; [retvar]
:: Get lastest revision
for /f &quot;skip=7 delims=: tokens=2&quot; %%i in (&apos;svn info %1&apos;) do (
    (if %2. neq . (set/a%2=%%i)else echo %%i)&amp;goto :eof
)
GOTO :EOF

REM :_UPDATE_REV &lt;file&gt; &lt;revision&gt;
REM :: Update revision
REM sed -i &apos;/rev=/{s/\(rev=\)[0-9]\+/\1%2/}&apos; %1
REM GOTO :EOF
</code></pre><p><strong>example.conf</strong></p>
<pre><code>name=example_project
url=http://172.168.1.122/repos/dev/example_project/trunk
rev=15793
mail=user@gmail.com,abc@yahoo.com,test@hotmail.com
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://matrix207.github.com/2012/12/15/svn-project-revision-monitor/" data-id="cin61d0g0001kfyizmzhihppm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/batch/">batch</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/blat/">blat</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/svn/">svn</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-send-mail-by-blat" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2012/12/15/send-mail-by-blat/" class="article-date">
  <time datetime="2012-12-14T16:00:00.000Z" itemprop="datePublished">2012-12-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/windows/">windows</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2012/12/15/send-mail-by-blat/">Send mail use blat</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="What-is-blat"><a href="#What-is-blat" class="headerlink" title="What is blat?"></a>What is blat?</h4><p>Blat is a Windows (32 &amp; 64 bit) command line utility that sends eMail using SMTP or post to usenet using NNTP.  </p>
<p>Home: <a href="www.blat.net">www.blat.net</a><br>syntax: <a href="www.blat.net/syntax/syntax.html">www.blat.net/syntax/syntax.html</a><br>ref: <a href="www.cybergav.in/2010/10/28/how-to-send-emails-using-blat/">how to send emails using blat</a>  </p>
<h4 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h4><p><code>blat -installSMTP smtp.gmail.com abc@gmail.com -u username -pw yourpasswd</code></p>
<h4 id="Send-mail"><a href="#Send-mail" class="headerlink" title="Send mail"></a>Send mail</h4><p><code>blat -s &quot;blat mail&quot; -to test@gmail.com -f abc@gmail.com -body&quot;test body&quot;</code></p>
<h4 id="Send-email-with-body-from-a-file"><a href="#Send-email-with-body-from-a-file" class="headerlink" title="Send email with body from a file"></a>Send email with body from a file</h4><p><code>blat test.txt -s &quot;blat mail&quot; -to test@gmail.com -f abc@gmail.com</code></p>
<h4 id="specify-charset-of-body-file"><a href="#specify-charset-of-body-file" class="headerlink" title="specify charset of body file"></a>specify charset of body file</h4><p><code>blat utf8.txt -s &quot;blat mail&quot; -to test@gmail.com -f abc@gmail.com -charset GBK</code></p>
<h4 id="Send-attachment"><a href="#Send-attachment" class="headerlink" title="Send attachment"></a>Send attachment</h4><p><code>blat -s &quot;blat mail&quot; -to test@gmail.com -f abc@gmail.com -body&quot;test attach&quot; -attach 1.txt</code></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://matrix207.github.com/2012/12/15/send-mail-by-blat/" data-id="cin61d0fu0018fyizjvu0khc0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/batch/">batch</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/blat/">blat</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/svn/">svn</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-visual-studio-project-clean" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2012/12/14/visual-studio-project-clean/" class="article-date">
  <time datetime="2012-12-13T16:00:00.000Z" itemprop="datePublished">2012-12-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/windows/">windows</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2012/12/14/visual-studio-project-clean/">Visual studio project clean</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Clean-visual-studio-project"><a href="#Clean-visual-studio-project" class="headerlink" title="Clean visual studio project"></a>Clean visual studio project</h3><pre><code>@ECHO off
setlocal enabledelayedexpansion
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Clean Visual studio project
:: Dennis
:: 2012-12-14
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

:_LOOP
cls
set &quot;prj_path=&quot;
set /p prj_path=Drag project folder here:
if !prj_path!. EQU . goto _EXIT
cd !prj_path!

del *.suo Thumbs.db /f /s /a:h 2&gt;nul
del *.ncb *.user /f /s 2&gt;nul

set /a del_type=1
set /p del_type=Option 1 delete files,2 remove folder(default 1):
if %del_type% GEQ 1 (
    if %del_type% LEQ 2 goto _DEL_TYPE_%del_type%
)
echo Please check your choise, only 1 and 2 is available.
pause
goto _LOOP

:_DEL_TYPE_1
del *.aps *.plg *.bsc *.hpj *.clw *.map *.exp *.cbp *.mdp *.ilk /f /s 2&gt;nul
del *.sbr *.res *.obj *.pch *.pdb *.idb *.tmp *.opt mt.dep /f /s 2&gt;nul
del *.manifest BuildLog.htm /f /s 2&gt;nul
pause
goto _LOOP

:_DEL_TYPE_2
::使用*号做分隔符,解决路径中出现空格导致无法获取完整路径问题 
@for /f &quot;delims=*&quot; %%i in (&apos;dir /s /b /ad&apos;) do (
    if /i &quot;%%~ni&quot;==&quot;debug&quot; rmdir /s /q &quot;%%i&quot;
    if /i &quot;%%~ni&quot;==&quot;release&quot; rmdir /s /q &quot;%%i&quot;
)

pause
goto _LOOP

:_EXIT
pause&amp;exit /B 0
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://matrix207.github.com/2012/12/14/visual-studio-project-clean/" data-id="cin61d0ft0015fyizznwlba3g" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/batch/">batch</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-batch-skill" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2012/12/14/batch-skill/" class="article-date">
  <time datetime="2012-12-13T16:00:00.000Z" itemprop="datePublished">2012-12-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/windows/">windows</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2012/12/14/batch-skill/">Batch skill</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Batch-skills"><a href="#Batch-skills" class="headerlink" title="Batch skills"></a>Batch skills</h3><p>1.<strong>获取当前日期时间</strong><br>    set date<em>time=%date:~,10%</em>%time:~,2%<em>%time:~3,2%</em>%time:~6,2%</p>
<p>2.<strong>获取当前路径</strong><br>    set pwd=%CD%</p>
<p>3.<strong>延时</strong>  </p>
<pre><code>`ping -n 11 127.0.0.1 &gt;nul`  

ping 本机 11 次，可用于批处理延时 10 秒。命令中的&gt;nul 为屏蔽输出。  
_简短式可以写成:_  
`ping -n 11 127.1 &gt;nul`
</code></pre><p>4.<strong>计算运行时间</strong>  </p>
<pre><code>    @ECHO off&amp;setlocal enabledelayedexpansion
    CALL :TIME_START
    REM 修改这里的 ping 为你需要写的代码
    ping 127.1 -n 2 &gt;nul
    CALL :TIME_END
    PAUSE&amp;exit /B 0
    :TIME_START
    SET /a time_s=%time:~6,2%
    SET /a time_m=%time:~3,2%
    @ECHO Start  time: %time%
    GOTO :EOF
    :TIME_END
    @ECHO End  time: %time%
    SET /a diff_m=%time:~3,2%-%time_m%
    SET /a diff_s=%time:~6,2%-%time_s%
    SET /a total=&quot;%diff_m%&quot;*60+&quot;%diff_s%&quot;
    @ECHO Elapsed time: %total% sec
    GOTO :EOF

_运行效果:_  

    D:\work\project\tmp&gt;test.bat
    Start  time: 13:52:00.43
    End  time: 13:52:01.48
    Elapsed time: 1 sec
    请按任意键继续. . .
</code></pre><p>5.<strong>罗列当前目录所有 txt 文件</strong>  </p>
<pre><code>@echo off
for %%i in (*.txt) do echo &quot;%%i&quot;
pause
</code></pre><p>6.<strong>罗列当前和子目录所有 cfg 文件</strong>  </p>
<pre><code>for /r 参数 遍历搜索  
格式：`FOR /R [[drive:]path] %%variable IN (set) DO command [command-parameters]`  

举例:  
命令:(注意，该命令在 dos 窗口运行)  
    `D:\work\project\tmp\CI&gt;for /r %i in (*.cfg) do @echo %i`  

输出:  

    D:\work\project\tmp\CI\ci_cfg\ci_scm_trunk.cfg
    D:\work\project\tmp\CI\ci_cfg\ci_ubackup.cfg
    D:\work\project\tmp\CI\zd15_lcd\setup\Release\apprun.cfg
    D:\work\project\tmp\CI\zd15_lcd\setup\Release\service.cfg
    D:\work\project\tmp\CI\zd15_lcd\src\service\apprun.cfg
    D:\work\project\tmp\CI\zd15_lcd\src\service\service.cfg  

方法二:(注意，该命令在批处理文件中运行)  
    `for /f %%i in (&apos;dir /s /b /a-d *.cfg&apos;) do @ECHO %%i`  

解决路径中出现空格  
    `for /f “delims=*”%%i in (&apos;dir /s /b /a-d *.cfg&apos;) do @ECHO %%`  
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://matrix207.github.com/2012/12/14/batch-skill/" data-id="cin61d0fr0011fyizpe9f13ux" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/batch/">batch</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-analyze-wget-source" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2012/09/27/analyze-wget-source/" class="article-date">
  <time datetime="2012-09-26T16:00:00.000Z" itemprop="datePublished">2012-09-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2012/09/27/analyze-wget-source/">Analyze wget source</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Log-of-study-wget-source-code"><a href="#Log-of-study-wget-source-code" class="headerlink" title="Log of study wget source code"></a>Log of study wget source code</h3><p><strong>2012-9-27 00:04:30</strong></p>
<ol>
<li>config<br> <code>./configure</code></li>
<li>compile<br> <code>make</code></li>
<li>install<br> <code>make install</code></li>
<li>uninstall<br> <code>make uninstall</code></li>
</ol>
<p>compile log: (on virtualbox os ubuntu)  </p>
<pre><code>dennis@dennis-VBox:~/project/wget/wget-1.9$ ./configure
dennis@dennis-VBox:~/project/wget/wget-1.9$ ls
dennis@dennis-VBox:~/project/wget/wget-1.9$ make
// Error message: autoconf: Command not found
// install autoconf
dennis@dennis-VBox:~/project/wget/wget-1.9$ sudo apt-get install autoconf
dennis@dennis-VBox:~/project/wget/wget-1.9$ make
// Error message: makeinfo: Command not found
// install texinfo
dennis@dennis-VBox:~/project/wget/wget-1.9$ sudo apt-get install texinfo
dennis@dennis-VBox:~/project/wget/wget-1.9$ make

Binary file &quot;wget&quot; will be generated at wget-1.9/src/
</code></pre><p><em>todo</em><br>    analyze Makefile</p>
<p><strong>2012-9-26 00:06:18</strong></p>
<ol>
<li><a href="http://www.gnu.org/software/wget/" target="_blank" rel="external">Home</a></li>
<li><a href="http://www.gnu.org/software/wget/manual/" target="_blank" rel="external">manual site</a></li>
<li>manual generation script <a href="http://savannah.gnu.org/cgi-bin/viewcvs/~checkout~/texinfo/texinfo/util/gendocs.sh" target="_blank" rel="external">gendocs.sh</a></li>
<li><a href="http://www.gnu.org/software/wget/manual/wget.pdf" target="_blank" rel="external">pdf format manual</a></li>
</ol>
<p><em>todo</em><br>    compile wget source code</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://matrix207.github.com/2012/09/27/analyze-wget-source/" data-id="cin61d0fw001ffyizlaylupbq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/source-analyze/">source analyze</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wget/">wget</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-vim" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2012/09/26/vim/" class="article-date">
  <time datetime="2012-09-25T16:00:00.000Z" itemprop="datePublished">2012-09-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2012/09/26/vim/">VIM</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I use a variety of vi(m) commands for my job, so many that I can’t always<br>remember how to do something that I have done before. Therefore I keep notes<br>them here, for my bad memory.</p>
<h3 id="What-is-the-difference-between-Vi-and-Vim"><a href="#What-is-the-difference-between-Vi-and-Vim" class="headerlink" title="What is the difference between Vi and Vim"></a>What is the difference between Vi and Vim</h3><p>Vim is Vi improve, everything that in vi is available in vim.<br>Here is some of the extended vim features:<a href="http://askubuntu.com/questions/418396/what-is-the-difference-between-vi-and-vim" target="_blank" rel="external">ref</a>  </p>
<ol>
<li>Vim support syntax highlighting, code folding, etc.  </li>
<li>Vim allows the screen to be split for editing multiple files.  </li>
<li>Vim includes a built in diff for comparing files (vimdiff)  </li>
<li>Vim support plugins  </li>
</ol>
<h3 id="General-command-use-in-VIM"><a href="#General-command-use-in-VIM" class="headerlink" title="General command use in VIM"></a>General command use in VIM</h3><pre><code>### insert mode
i -&gt; insert mode at cursor
I -&gt; insert mode at the beginning of Line
a -&gt; append after the cursor
A -&gt; append at the end ot line
o -&gt; insert bank line below current line
O -&gt; insert bank line above current line

### Cursor move
h,j,k,l ←, ↓, ↑, →
w      -&gt; jump to the head of next word
W      -&gt; jump to the head of next word which begin with bank
e      -&gt; jump to the end of next word
E      -&gt; jump to the end of next word which begin with bank
b      -&gt; jump to the head of previous word
B      -&gt; jump to the head of previous word which begin with bank
0      -&gt; jump to the first character of current line
$      -&gt; jump to the end of current line
^      -&gt; jump to the first not-white-space character of current line
g_     -&gt; jump to the last not-white-space character of current line
gg     -&gt; jump to the first not-while-space character of first line
G      -&gt; jump to the first not-while-space character of last line
`.     -&gt; jump the position of last edit
&apos;&apos;     -&gt; jump the previous position of cursor
H      -&gt; jump to first line of screen
M      -&gt; jump to the middle line of screen
L      -&gt; jump to the last line of screen
%      -&gt; jump to the match symbol
{      -&gt; paragraph backward
}      -&gt; paragraph backward
[      -&gt; jump to previous
]      -&gt; jump to next
zt     -&gt; move current line to the top of window
zz     -&gt; move current line to the center of window
zb     -&gt; move current line to the bottom of window
ctrl+e -&gt; scroll screen backward
ctrl+y -&gt; scrool screen forward
ctrl+u -&gt; scroll half screen backward
ctrl+d -&gt; scroll half screen backward
ctrl+f -&gt; scrool to next screen
ctrl+b -&gt; scrool to previous screen

### Edit
cw     -&gt; change word
C      -&gt; change to the end of line
u      -&gt; undo
~      -&gt; switch case
gu     -&gt; uppercase select characters
gU     -&gt; lowercase select characters
&gt;&gt;     -&gt; indent line one column right
&lt;&lt;     -&gt; indent line one column left
==     -&gt; auto-indent current line
ctrl+r -&gt; redo

### Cut, copy and paste
dd    -&gt; delete current line, and put it to clipboard
x     -&gt; delete current character
X     -&gt; delete previous character
dw    -&gt; delete to end of word
D     -&gt; delete to end of line
yy    -&gt; copy current line
yw    -&gt; copy to end of word
y$    -&gt; copy to end of line
p     -&gt; paste after the cursor
P     -&gt; paste befor the cursor
&quot;+y   -&gt; copy to system clipboard
&quot;+gP  -&gt; paste from system clipboard
[N]yy -&gt; copy N lines

### Fold
zm -&gt; increase the foldlevel by one
zM -&gt; close all open folds
zr -&gt; decrease the foldlevel by one
zR -&gt; decrease the foldlevel to zero -- all folds will be open
zo -&gt; opens a fold at the curse
zO -&gt; opens all folds at the curse
zc -&gt; close one fold
zC -&gt; close all folds at the curse
zj -&gt; jump to next fold
zk -&gt; jump to previous fold
zf -&gt; fold manual, using `V` to select lines and type `zf` to fold them

### split
:split
:vspl
ctrl+w+h/j/k/l  move cursor between split windows

### Search
*          -&gt; search string forward
#          -&gt; search string backward
/pattern   -&gt; search for pattern
/\cpattern -&gt; search for pattern, ignore upper and lower case
/pattern\c -&gt; search for pattern, ignore upper and lower case
?pattern   -&gt; search backwards for pattern
n          -&gt; repeat search in same direction
N          -&gt; repeat search in opposite direction
f          -&gt; search character forward
F          -&gt; search character backward

### Save and quit
:w  -&gt; save
:wq -&gt; save and quit
:x  -&gt; save and quit
:q  -&gt; quit, fail to quit if not save the changed
:q! -&gt; force quit
ZZ  -&gt; save and quit

### File 
use `vim file1 file2 ...` to open multiple files
:bn     -&gt; next buffer
:bp     -&gt; previous buffer 
:bd!    -&gt; delete current buffer tag  
:e path -&gt; edit file
:e      -&gt; reload current file
:r !cmd -&gt; read the result the command to the cursor of current file

### simple skills
xp   -&gt; swap two characters
gg=G -&gt; indent the file
[N]G -&gt; jump to Nth line
yyp  -&gt; copy and paste current line
yw   -&gt; yank to the end of word
yiw  -&gt; yank word
=    -&gt; auto-indent selected lines
==   -&gt; auto-indent current lines
n==  -&gt; auto-indent [count] lines (start from current line)
gd   -&gt; jump to the defined position of variable

### Other
.             -&gt; repeat last change
J             -&gt; join [count] lines
:nohl         -&gt; not highlight
:set          -&gt; nu show number
:set          -&gt; wrap
:set          -&gt; nowrap
:set          -&gt; syntax=python` manual set syntax language
C-x or C-a    -&gt; minus or add 1 to current digit
:%!xxd        -&gt; hex edit
:%!xxd -r     -&gt; return from hex edit
:set mouse =  -&gt; available right button of mouse
:set mouse =a -&gt; disable right button of mouse
:set paste    -&gt; useful for paste text to vim
:set nopaste  -&gt; disable paste mode

### substitute
(use command &quot;:help substitue&quot; for more information)
:[range]s/pattern/string/[c,e,g,i]
  range   1,7 line 1 to 7  1,$ line 1 to last  % all lines
  pattern string  be searched
  string  string for substitute
  c    comfirm
  e    not show error
  g    global, match all search of current line
  i    ignore
e.g.
  :%s/\s\+$//        delete all spaces between first space to the end of line
  :%s/h14/h12/g   replace h14 to be h12 for all occurrence in the file
  :1,$s/h14/h12/g replace h14 to be h12 from first line to the last line

### Visual Mode
(use command &quot;:help v&quot; for more information)
v      start visual mode per character
V      start visual mode linewise
ctrl+v start visual mode blockwise

### Text object (multiple lines possible)
(use command &quot;:help objects&quot; for more information)
Operator Mapping
v|c|d|y     i|a          {|[|(|&quot;|&apos;|w|p
visual  Inner Object      Region
change     An Object      {} [] () &quot;&quot; &apos;&apos; word paragraph
delete
yank
e.g.
  vi{ : select characters between brace
  va&quot; : select characters, include double quotes
  viw : visual a word
  di&quot; : delete characters between quotes
  ci( : change characters between bracket

### do operation to string (single line only)
v|c|d|y  f|t  character, work on current line only
e.g:
  vf{ : select characters to the first &apos;{&apos;, include &apos;{&apos;.
  vt{ : select characters to the first &apos;{&apos;, exclude &apos;{&apos;.
  using `;` to select the next character
v|c|d|y  /|?  character, work on the whole paper
e.g:
  v/{&lt;CR&gt; : select characters to the first &apos;{&apos;, include &apos;{&apos;.
  v///&lt;CR&gt; : select characters to the first &apos;//&apos;, include &apos;//&apos;.
  v?{ : select characters to the first &apos;{&apos;, exclude &apos;{&apos;.
  using `n` or `N` to select the next character

### do operation on lines
[N]yy : copy N lines
[N]dd : delete N lines
:.,+2d : delete current line through the next 2 lines
:3,5m10 : move lines 3 through 5 to follow 10 (like delete and put in vi)
:3,5co10 : copy lines 3 through 5 to after 10 (like yank and put in vi)
:3,5t. : copy lines 3 through 5 to current line (like yank and put in vi)

### Auto completion
C-p
C-n
C-x C-p Word completion, backward
C 10 -x C-n Word completion, forward
C-x C-l Line completion
C-x C-f File name completion

### regular expression
:help regexp  -&gt; for more information
. any character without new line
* 0 or more
^ begin of the line
$ end of the line
\+ 1 or more
\? 0 or 1
\
|
[] -&gt; [abc], [^abc], [a-z]
()
{} -&gt; {n}, {n,}, {n,m}
\d -&gt; digit, [0-9]
\D -&gt; non-digit, [^0-9]
\s -&gt; whitespace character: &lt;Space&gt; and &lt;Tab&gt;
\S -&gt; non-whitespace character
\w
\x    hex digit:            [0-9A-Fa-f]
\X    non-hex digit:            [^0-9A-Fa-f]
\o    octal digit:            [0-7]
\O    non-octal digit:        [^0-7]
\w    word character:            [0-9A-Za-z_]
\W    non-word character:        [^0-9A-Za-z_]
\h    head of word character:        [A-Za-z_]
\H    non-head of word character:    [^A-Za-z_]
\a    alphabetic character:        [A-Za-z]
\A    non-alphabetic character:    [^A-Za-z]
\l    lowercase character:        [a-z]
\L    non-lowercase character:    [^a-z]
\u    uppercase character:        [A-Z]
\U    non-uppercase character:    [^A-Z]

### Session
:mksession .mysession.vim make a session for current documents, use &quot;gvim -S 
.mysession.vim&quot; to open it.

### History
q: enter history commands, then choose and execute the command

### Marks
(use command &quot;:help mark-motions&quot; for more information)
mx     set mark x, x can use a..z characters
&apos;x     jump to mark x
:marks show all marks

### Register
:reg  view register content
&quot;0p   paste from register 0
&quot;1p   paste from register 1
&quot;_D   delete contents to back hole register

### Complex repeats
qq operators q   record all operators to q register
100@q            repeat the operators 100 times

### Editing Files in other places
vim scp://[user@]hostname[:port]//FilePath
e.g.: vim scp://root@172.16.110.39//root/a.c

### Merge code by vimdiff
`]c` go to next difference
`[c` go to previous difference
`do` diff get, get the change from another file to current file
`dp` diff put, put the change from current file to another file

### source vimrc, not need to exit vim to make config effective
:so %        -&gt; source current file(.vimrc)
:so ~/.vimrc -&gt; source specified file

### run vi scripts under terminal
vi -e -s -c &quot;:%s/pattern/string/g&quot; -c &quot;:wq&quot; file-name

### Help
:help symbol
</code></pre><h3 id="skills-for-program"><a href="#skills-for-program" class="headerlink" title="skills for program"></a>skills for program</h3><ol>
<li>open file on current cursor, use command <code>gf</code>; if the file is not in current<br> directory, use <code>:set path+=yourfilepath</code> to add more dir to the path, use<br> <code>:help path</code> for more info.</li>
</ol>
<h3 id="some-skills"><a href="#some-skills" class="headerlink" title="some skills"></a>some skills</h3><ol>
<li><p>command mode type <code>:nohl</code> cancel high light</p>
</li>
<li><p>substituttion<br>sample lines:  </p>
<blockquote>
<p>+ (<a href="http://www.google.com)\[google\" target="_blank" rel="external">http://www.google.com)\[google\</a>]<br>+ (<a href="http://www.wolframalpha.com/)\[wolfram\" target="_blank" rel="external">http://www.wolframalpha.com/)\[wolfram\</a>]<br>into the lines:<br>+ [google](<a href="http://www.google.com" target="_blank" rel="external">http://www.google.com</a>)<br>+ [wolfram](<a href="http://www.wolframalpha.com/" target="_blank" rel="external">http://www.wolframalpha.com/</a>)<br>Here is the command to do this:<br><code>:%s/+ \(.*\)\(\[.*\]\)/+ \2\1/g</code>  </p>
</blockquote>
</li>
<li><p>compare file<br><code>vimdiff file1 file2</code> or <code>gvim -d file1 file2</code></p>
</li>
<li><p>digit operator<br> <code>ctrl+a</code> increment 1<br> <code>ctrl+x</code> subtract 1  </p>
</li>
<li><p>delete all comments<br> <code>:%s/\/\*\_.\{-}\*\//g</code> or <code>:%s#\M/*\m\_.\{-}\M*/##g</code></p>
</li>
<li><p>delete match/unmatch lines<br> <code>:g/.*patternSearch.*/d</code><br> <code>:v/#include/d</code> Delete all lines except “#include” lines  </p>
</li>
<li><p>more substitution<br> Substituting all lines with its line number<br> <code>:%s/^/\=line(&quot;.&quot;) . &quot;. &quot;/g</code><br> Resort numeric<br> <code>:4,$s/\d\+/\=submatch(0) + 1/</code><br> Insert sequence number to column position<br> <code>:%s/table\[\]/\=&#39;table[&#39; . printf(&quot;%d&quot;,line(&quot;.&quot;)) . &#39;]&#39;/g</code><br> <code>:%s/table\[\]/\=&#39;table[&#39; . printf(&quot;%d&quot;,line(&quot;.&quot;)+9) . &#39;]&#39;/g</code> start from 10  </p>
</li>
<li><p>delete bank line<br> <code>:g/^$/d</code><br> <code>:g/^ *$/d</code> delete lines only contain space   </p>
</li>
<li><p>add “inline” to all function<br> <code>:%s/\(.*(\)/inline \1/g</code>  this can work, but not perfect!!<br> <code>%s/\(^[□tab]*\)\(.*(.*\)/\1inline \2/g</code>  </p>
</li>
<li><p>delete all spaces at the end of every line:<br><code>:%s/\(.*\)  *$/\1/</code></p>
</li>
<li><p>read range of lines from another file to current file<br><code>:r! sed -n 100,158p /home/dennis/test.c</code></p>
</li>
<li><p>list all the match lines of searching on screen<br><code>:g/pattern/p</code> In its longer format: <code>:global/regular-expression/print</code><br>If <code>pattern</code> is leave out, like <code>:g//p</code>, vim will uses previous search item.<br>You can leave <code>p</code> out too, because p(rint) is the default action.</p>
</li>
<li><p>copy all lines containing a search pattern<br><code>qaq</code> clear register a<br><code>:g/pattern/y A</code> append all matching lines to register, then use <code>p</code> to paster them.</p>
</li>
<li><p>make a list number, reference <a href="http://vim.wikia.com/wiki/Making_a_list_of_numbers" target="_blank" rel="external">this</a></p>
<p>first, add this code to vimrc:  </p>
<pre><code>&quot; Add argument (can be negative, default 1) to global variable i.
&quot; Return value of i before the change.
function Inc(...)
  let result = g:i
  let g:i += a:0 &gt; 0 ? a:1 : 1
  return result
endfunction
</code></pre><p>then type <code>:so ~/.vimrc</code> to make it effective, and use command<br><code>:let i = 1 | %s/ /\=&#39; &#39; . Inc() . &#39;.&#39;/</code></p>
<p>before:  </p>
<pre><code>* How do you write a fast network server?
* How do you write a network server that can handle 10000 clients?
* What bottlenecks are there and how do you avoid them?
</code></pre><p>after:  </p>
<pre><code>* 10.How do you write a fast network server?
* 11.How do you write a network server that can handle 10000 clients?
* 12.What bottlenecks are there and how do you avoid them?
</code></pre><p>Test command <code>:let i = 0 | %s/f0/\=&#39;f&#39; . Inc()/</code></p>
<p>before:</p>
<pre><code>&lt;f0&gt;int state;\l|\
&lt;f0&gt;int iostate;\l|\
&lt;f0&gt;int fd;\l|\
&lt;f0&gt;struct session *session;\l|\
</code></pre><p>after:</p>
<pre><code>&lt;f0&gt;int state;\l|\
&lt;f1&gt;int iostate;\l|\
&lt;f2&gt;int fd;\l|\
&lt;f3&gt;struct session *session;\l|\
</code></pre></li>
<li><p>delete all space character at the end of each line<br><code>:%s/\s\+$//g</code><br>and for the beginning of each line is <code>:%s/^\s\+//g</code></p>
</li>
<li><p><code>g?</code> translate the selected content by <a href="https://en.wikipedia.org/wiki/ROT13" target="_blank" rel="external">ROT13</a>, using <code>u</code> to cancel operation</p>
</li>
<li><p><code>:%TOhtml</code> translate to html format</p>
</li>
<li><p>Encrypt<br>method one <code>:set key=123456</code>, then save and quit <code>:wq</code><br>method two <code>:X</code>, type the passwd twice，save and quit <code>:wq</code><br>clean passwd <code>:set key=</code>, save and quit <code>:wq</code></p>
</li>
<li><p><code>autocmd FileType c,cpp set shiftwidth=4 | set expandtab</code> add to .vimrc, expand tab to be four space</p>
</li>
<li><p><code>23,38w newfile</code> write the content between specify lines to file, <code>320,$ &gt;&gt;newfile</code> append to file</p>
</li>
<li><p><code>23,38!sort</code> sort lines 23 through 38</p>
</li>
<li><p><code>%s/  */\r/g</code> replace space as return<br><code>%s/[ \t][ \t]*/\r/g</code> replace space or tab as return</p>
</li>
<li><p><code>%s/\(\S\) \+/\1/g</code> delete all whitespace characters which after non-whitespace.</p>
</li>
<li><p><code>:g/\[/,/\]/j</code> join multiple line to one</p>
</li>
</ol>
<h3 id="other-valued-skills"><a href="#other-valued-skills" class="headerlink" title="other valued skills"></a>other valued skills</h3><ul>
<li><a href="http://www.brezeale.com/technical_notes/vim_notes.shtml" target="_blank" rel="external">vim notes</a></li>
<li><a href="http://vim.wikia.com/wiki/Category:VimTip" target="_blank" rel="external">VimTip - Vim Tips Wiki</a></li>
<li><a href="http://vim.wikia.com/wiki/Best_Vim_Tips" target="_blank" rel="external">Best Vim Tips</a></li>
<li><a href="http://www.rayninfo.co.uk/vimtips.html" target="_blank" rel="external">Best of Vim Tips</a></li>
<li><a href="http://www.thegeekstuff.com/2009/04/vi-vim-editor-search-and-replace-examples/" target="_blank" rel="external">12 Powerful Find and Replace Examples</a></li>
</ul>
<h3 id="other-version"><a href="#other-version" class="headerlink" title="other version"></a>other version</h3><ul>
<li><a href="https://neovim.io/" target="_blank" rel="external">neovim</a></li>
</ul>
<h3 id="Vundle-plugin-manager"><a href="#Vundle-plugin-manager" class="headerlink" title="Vundle, plugin manager"></a>Vundle, plugin manager</h3><ul>
<li><a href="http://beiyuu.com/git-vim-tutorial/" target="_blank" rel="external">Git时代的VIM不完全使用教程</a></li>
<li>install<ul>
<li><code>git clone http://github.com/gmarik/vundle.git ~/.vim/bundle/vundle</code></li>
</ul>
</li>
<li><p>.vimrc(put plugin name behind <code>Bundle</code>, more plugin see <a href="http://vim-scripts.org/vim/scripts.html" target="_blank" rel="external">vim-scripts.org</a>)</p>
<pre><code>set nocompatible &quot; be iMproved
filetype off &quot; required!

set rtp+=~/.vim/bundle/vundle/
call vundle#rc()

&quot; let Vundle manage Vundle
&quot; required!
Bundle &apos;gmarik/vundle&apos;

&quot; vim-scripts repos
Bundle &apos;vim-plugin-foo&apos;
Bundle &apos;vim-plugin-bar&apos;

filetype plugin indent on &quot; required!
</code></pre></li>
<li><p>manage plugin</p>
<ul>
<li><code>:BundleInstall</code></li>
<li><code>:BundleUpdate</code></li>
<li><code>:BundleClean</code></li>
</ul>
</li>
<li>powerful plugin<ul>
<li>Bundle ‘ag.vim’</li>
<li>Bundle ‘ctrlp.vim’</li>
<li>Bundle ‘EasyMotion’</li>
<li>Bundle ‘The-NERD-tree’</li>
<li>Bundle ‘The-NERD-Commenter’</li>
<li>Bundle ‘UltiSnips’</li>
<li>Bundle ‘Tabular’</li>
<li>Bundle ‘Valloric/YouCompleteMe’</li>
</ul>
</li>
</ul>
<h3 id="install-vim-by-source"><a href="#install-vim-by-source" class="headerlink" title="install vim by source"></a>install vim by source</h3><ul>
<li>./configure –prefix=path-to-install</li>
<li>make &amp;&amp; make install</li>
<li>export PATH=path-to-install:PATH</li>
</ul>
<h3 id="some-useful-configuration-of-vimrc"><a href="#some-useful-configuration-of-vimrc" class="headerlink" title="some useful configuration of vimrc"></a>some useful configuration of vimrc</h3><ul>
<li><code>set nu</code> show line number</li>
<li><code>set hls</code> highlight search</li>
<li><a href="http://vim.wikia.com/wiki/Toggle_auto-indenting_for_code_paste" target="_blank" rel="external">Toggle auto indenting for code paste</a> <ul>
<li><code>:set paste</code></li>
<li><code>:set nopaste</code></li>
</ul>
</li>
</ul>
<h3 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h3><ul>
<li><a href="http://www.moolenaar.net/" target="_blank" rel="external">vim author</a></li>
<li><a href="http://wiki.hotoo.me/Vim.html" target="_blank" rel="external">vim fans</a></li>
<li><a href="http://coolshell.cn/articles/5426.html" target="_blank" rel="external">简明 Vim 练级攻略</a></li>
<li><a href="http://yannesposito.com/Scratch/en/blog/Learn-Vim-Progressively/" target="_blank" rel="external">Learn Vim Progressively</a></li>
<li><a href="http://vim.wikia.com/wiki/Power_of_g" target="_blank" rel="external">Power of g</a></li>
<li><a href="http://michael.peopleofhonoronly.com/vim/" target="_blank" rel="external">vim cheat sheet for programmers</a></li>
<li><a href="http://www.yolinux.com/TUTORIALS/LinuxTutorialAdvanced_vi.html" target="_blank" rel="external">Linux vi and vim editor: Tutorial and advanced features</a></li>
<li><a href="http://vimregex.com/" target="_blank" rel="external">vim regular expressions</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://matrix207.github.com/2012/09/26/vim/" data-id="cin61d0gq003bfyizd4vwyedp" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vim/">vim</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/16/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/18/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/debug/">debug</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/kernel/">kernel</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/math/">math</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/windows/">windows</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ARP/" style="font-size: 10px;">ARP</a> <a href="/tags/Auto-Compile/" style="font-size: 10px;">Auto Compile</a> <a href="/tags/Batch-File/" style="font-size: 10px;">Batch File</a> <a href="/tags/C/" style="font-size: 10px;">C</a> <a href="/tags/Emacs/" style="font-size: 10px;">Emacs</a> <a href="/tags/FAQ/" style="font-size: 10px;">FAQ</a> <a href="/tags/ICMP/" style="font-size: 10px;">ICMP</a> <a href="/tags/IRC/" style="font-size: 10px;">IRC</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/NetworkStack/" style="font-size: 12.5px;">NetworkStack</a> <a href="/tags/Notepad/" style="font-size: 10px;">Notepad++</a> <a href="/tags/Translation/" style="font-size: 17.5px;">Translation</a> <a href="/tags/WinIO/" style="font-size: 10px;">WinIO</a> <a href="/tags/api/" style="font-size: 10px;">api</a> <a href="/tags/arp/" style="font-size: 10px;">arp</a> <a href="/tags/auto-compile/" style="font-size: 10px;">auto compile</a> <a href="/tags/awk/" style="font-size: 12.5px;">awk</a> <a href="/tags/batch/" style="font-size: 20px;">batch</a> <a href="/tags/blat/" style="font-size: 12.5px;">blat</a> <a href="/tags/blog/" style="font-size: 10px;">blog</a> <a href="/tags/book/" style="font-size: 10px;">book</a> <a href="/tags/dot/" style="font-size: 10px;">dot</a> <a href="/tags/exploit/" style="font-size: 10px;">exploit</a> <a href="/tags/flowchart/" style="font-size: 10px;">flowchart</a> <a href="/tags/gedit/" style="font-size: 10px;">gedit</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/github/" style="font-size: 12.5px;">github</a> <a href="/tags/google/" style="font-size: 10px;">google</a> <a href="/tags/graphviz/" style="font-size: 10px;">graphviz</a> <a href="/tags/hardware-monitor/" style="font-size: 10px;">hardware monitor</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/tags/jekyll/" style="font-size: 10px;">jekyll</a> <a href="/tags/kernel/" style="font-size: 10px;">kernel</a> <a href="/tags/kvm/" style="font-size: 12.5px;">kvm</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/lisp/" style="font-size: 10px;">lisp</a> <a href="/tags/mac/" style="font-size: 10px;">mac</a> <a href="/tags/mail/" style="font-size: 10px;">mail</a> <a href="/tags/malloc-abc/" style="font-size: 10px;">malloc abc</a> <a href="/tags/mathematician/" style="font-size: 10px;">mathematician</a> <a href="/tags/maxima/" style="font-size: 10px;">maxima</a> <a href="/tags/mtrace/" style="font-size: 10px;">mtrace</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/net-snmp/" style="font-size: 10px;">net-snmp</a> <a href="/tags/netbios/" style="font-size: 10px;">netbios</a> <a href="/tags/network/" style="font-size: 10px;">network</a> <a href="/tags/nodejs/" style="font-size: 10px;">nodejs</a> <a href="/tags/novels/" style="font-size: 10px;">novels</a> <a href="/tags/opennebula/" style="font-size: 10px;">opennebula</a> <a href="/tags/org-mode/" style="font-size: 10px;">org mode</a> <a href="/tags/pandoc/" style="font-size: 10px;">pandoc</a> <a href="/tags/plugin/" style="font-size: 10px;">plugin</a> <a href="/tags/raid/" style="font-size: 10px;">raid</a> <a href="/tags/rsync/" style="font-size: 10px;">rsync</a> <a href="/tags/sed/" style="font-size: 12.5px;">sed</a> <a href="/tags/shell/" style="font-size: 17.5px;">shell</a> <a href="/tags/skype/" style="font-size: 12.5px;">skype</a> <a href="/tags/source-analyze/" style="font-size: 10px;">source analyze</a> <a href="/tags/sqlite/" style="font-size: 10px;">sqlite</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/study/" style="font-size: 10px;">study</a> <a href="/tags/svn/" style="font-size: 17.5px;">svn</a> <a href="/tags/tunnel/" style="font-size: 10px;">tunnel</a> <a href="/tags/valgrind/" style="font-size: 12.5px;">valgrind</a> <a href="/tags/vi/" style="font-size: 10px;">vi</a> <a href="/tags/vim/" style="font-size: 17.5px;">vim</a> <a href="/tags/wget/" style="font-size: 10px;">wget</a> <a href="/tags/wifi/" style="font-size: 10px;">wifi</a> <a href="/tags/wireless-tools/" style="font-size: 10px;">wireless-tools</a> <a href="/tags/wpa-supplicant/" style="font-size: 10px;">wpa_supplicant</a> <a href="/tags/xml/" style="font-size: 10px;">xml</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">March 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">November 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">September 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">August 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">May 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/09/">September 2012</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/04/18/hexo/">Hexo</a>
          </li>
        
          <li>
            <a href="/2016/04/13/malloc/">malloc</a>
          </li>
        
          <li>
            <a href="/2016/03/12/performance-optimization-of-cplusplus/">performance optimization of C++</a>
          </li>
        
          <li>
            <a href="/2016/03/09/stack-trace-when-program-crash/">stack trace when program crash</a>
          </li>
        
          <li>
            <a href="/2016/03/09/database-knowledges/">Database knowledges</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Matrix207<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>