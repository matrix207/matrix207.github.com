<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Matrix207&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Matrix207's Blog">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="Matrix207's Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Matrix207's Blog">
<meta name="twitter:description">
  
    <link rel="alternate" href="/atom.xml" title="Matrix207&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Matrix207&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-schema-data-mode" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/07/12/schema-data-mode/" class="article-date">
  <time datetime="2015-07-11T16:00:00.000Z" itemprop="datePublished">2015-07-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/12/schema-data-mode/">schema data mode</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Data-model"><a href="#Data-model" class="headerlink" title="Data model"></a>Data model</h3><h3 id="Why-need-it"><a href="#Why-need-it" class="headerlink" title="Why need it"></a>Why need it</h3><h3 id="Schema-Node"><a href="#Schema-Node" class="headerlink" title="Schema Node"></a>Schema Node</h3><ul>
<li>Define<ul>
<li>R : root node (record node)</li>
<li>S : single node (child node, subschema)</li>
<li>A : array node (child node, subschema)</li>
</ul>
</li>
<li>Example<ul>
<li>R, only root node</li>
<li>R -&gt; S1, only a singal node under root</li>
<li>R -&gt; A1, only an array node under root</li>
<li>R -&gt; A1 -&gt; A2</li>
<li>R -&gt; A1 -&gt; S1</li>
<li>R -&gt; S1 -&gt; A1</li>
<li>R -&gt; S1 -&gt; S2</li>
<li>R -&gt; S1 -&gt; A1 -&gt; S2</li>
<li>R -&gt; A1 -&gt; S1 -&gt; A2</li>
</ul>
</li>
<li>How to find the last node info by index of node?<ul>
<li>step 0, set root node as parent node</li>
<li>step 1, use parent node to find array index</li>
<li>step 2, found array node, set this node to new parent node, go to step 1</li>
<li>step 3, use the parent node to find the last node</li>
<li>step 4, do some operations for the node<ul>
<li>set value to fields and insert. (Using for add a new object)</li>
</ul>
</li>
<li>Notices<ul>
<li>only root node</li>
</ul>
</li>
</ul>
</li>
<li>How to create a key</li>
<li>How to write object</li>
<li>How to read object</li>
<li>How to update object</li>
<li>What is difference between full and delta object</li>
<li>Since there are read and write interfaces, why not insert and delete</li>
</ul>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/07/12/schema-data-mode/" data-id="cin4qo6j200947zizpmvd5k6o" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-key-technology-for-database" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/07/12/key-technology-for-database/" class="article-date">
  <time datetime="2015-07-11T16:00:00.000Z" itemprop="datePublished">2015-07-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/12/key-technology-for-database/">key technology for database</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Introduce"><a href="#Introduce" class="headerlink" title="Introduce"></a>Introduce</h3><h3 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h3><h3 id="BTree"><a href="#BTree" class="headerlink" title="BTree"></a>BTree</h3><h3 id="B-Tree"><a href="#B-Tree" class="headerlink" title="B+Tree"></a>B+Tree</h3><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li>Add wikipedia of Hash key</li>
<li>Add wikipedia of BTree key</li>
<li>Add wikipedia of B+Tree key</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/07/12/key-technology-for-database/" data-id="cin4qo6j000937ziz0e8pgthf" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-what-learn-from-distributed-database" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/07/06/what-learn-from-distributed-database/" class="article-date">
  <time datetime="2015-07-05T16:00:00.000Z" itemprop="datePublished">2015-07-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/06/what-learn-from-distributed-database/">What learn from distributed database</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="What-are-the-distributed-database"><a href="#What-are-the-distributed-database" class="headerlink" title="What are the distributed database"></a>What are the distributed database</h3><p>A distributed database include features:  </p>
<ul>
<li>Data model</li>
<li>SQL Engine</li>
<li>RPC</li>
<li>Backup and restore</li>
<li>Transaction</li>
<li>Common <ul>
<li>log</li>
<li>error</li>
</ul>
</li>
</ul>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/07/06/what-learn-from-distributed-database/" data-id="cin4qo6iz00927zizbs16z2qn" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-how-source-code-turn-to-be-an-executable-program" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/07/05/how-source-code-turn-to-be-an-executable-program/" class="article-date">
  <time datetime="2015-07-04T16:00:00.000Z" itemprop="datePublished">2015-07-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/05/how-source-code-turn-to-be-an-executable-program/">How source code turn to be an executable program</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="What-is-an-executable-program"><a href="#What-is-an-executable-program" class="headerlink" title="What is an executable program"></a>What is an executable program</h3><ul>
<li>On linux, the format of executable program is ELF (<code>Executable and Linking Format</code>)</li>
<li>members of executable program<ul>
<li>text segment</li>
<li>data segment</li>
<li>bss segment</li>
</ul>
</li>
</ul>
<h3 id="How-source-code-be-compiled"><a href="#How-source-code-be-compiled" class="headerlink" title="How source code be compiled"></a>How source code be compiled</h3><h3 id="Relation-of-source-code-object-file-library-file-bin-file"><a href="#Relation-of-source-code-object-file-library-file-bin-file" class="headerlink" title="Relation of source code, object file, library file, bin file"></a>Relation of source code, object file, library file, bin file</h3><h3 id="How-bin-file-to-load-library"><a href="#How-bin-file-to-load-library" class="headerlink" title="How bin file to load library"></a>How bin file to load library</h3><ul>
<li>dynamic library</li>
<li>static library</li>
</ul>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><ul>
<li><p>Hello world, a.c</p>
<pre><code>#include &lt;stdio.h&gt;
int main()
{
    printf (&quot;Hello world\n&quot;);
}
</code></pre></li>
<li><p>compile</p>
<pre><code>[dennis@localhost ~]$ gcc a.c
[dennis@localhost ~]$ objdump -f a.out 

a.out:     file format elf64-x86-64
architecture: i386:x86-64, flags 0x00000112:
EXEC_P, HAS_SYMS, D_PAGED
start address 0x0000000000400440
[dennis@localhost ~]$ file a.out
a.out: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.32, BuildID[sha1]=7396e4d6e7100d1536548d05ba91a67255bf9592, not stripped
[dennis@localhost ~]$ size a.out
   text       data        bss        dec        hex    filename
   1226        548          4       1778        6f2    a.out
[dennis@localhost ~]$ readelf -h a.out
ELF Header:
  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 
  Class:                             ELF64
  Data:                              2&apos;s complement, little endian
  Version:                           1 (current)
  OS/ABI:                            UNIX - System V
  ABI Version:                       0
  Type:                              EXEC (Executable file)
  Machine:                           Advanced Micro Devices X86-64
  Version:                           0x1
  Entry point address:               0x400440
  Start of program headers:          64 (bytes into file)
  Start of section headers:          4504 (bytes into file)
  Flags:                             0x0
  Size of this header:               64 (bytes)
  Size of program headers:           56 (bytes)
  Number of program headers:         9
  Size of section headers:           64 (bytes)
  Number of section headers:         30
  Section header string table index: 27
[dennis@localhost ~]$ readelf -S a.out
</code></pre></li>
</ul>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="http://bbs.pediy.com/showthread.php?t=81284.html" target="_blank" rel="external">linux可执行文件格式</a></li>
<li><a href="http://blog.csdn.net/topasstem8/article/details/38730971" target="_blank" rel="external">Linux下可执行文件格式详解</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/07/05/how-source-code-turn-to-be-an-executable-program/" data-id="cin4qo6iy00917ziz6ci6m3u8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ramcloud" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/06/06/ramcloud/" class="article-date">
  <time datetime="2015-06-05T16:00:00.000Z" itemprop="datePublished">2015-06-06</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/06/ramcloud/">ramcloud</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="what-is-ramcloud"><a href="#what-is-ramcloud" class="headerlink" title="what is ramcloud"></a>what is ramcloud</h4><ul>
<li>ramcloud<ul>
<li><a href="https://ramcloud.atlassian.net/wiki/display/RAM/RAMCloud;jsessionid=D118195965ABC5BF8B90B34EC242B5CE" target="_blank" rel="external">ramcloud</a></li>
<li><a href="http://blog.csdn.net/anzhsoft/article/details/21830991" target="_blank" rel="external">RAMCloud：内存云存储的内存分配机制</a></li>
</ul>
</li>
</ul>
<h4 id="compile-source-code"><a href="#compile-source-code" class="headerlink" title="compile source code"></a>compile source code</h4><ul>
<li><p>install dependency library</p>
<ul>
<li>yum install boost-devel protobuf-devel pcre-devel gtest-devel zookeeper-devel</li>
</ul>
</li>
<li><p>install dependency library</p>
<ul>
<li><p>2015-11-08 </p>
<ul>
<li>update: pull the latest code and do <code>yum install openssl-devel</code></li>
<li><p>6f18e4dfb36ae370f21b39e7f4a4b346c224f469</p>
<p>  [dennis@localhost RAMCloud-master]$ pwd<br>  /home/dennis/work/RAMCloud-master<br>  [dennis@localhost RAMCloud-master]$ make</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="source-code"><a href="#source-code" class="headerlink" title="source code"></a>source code</h4><ul>
<li>Client, CRamCloud.{h,cc}</li>
<li><p>getTableId test from RamCloudTest.cc</p>
<pre><code>TEST_F(RamCloudTest, getTableId) {
    string message(&quot;no exception&quot;);
    try {
        ramcloud-&gt;getTableId(&quot;bogusTable&quot;);
    }
    catch (ClientException&amp; e) {
        message = e.toSymbol();
    }
    EXPECT_EQ(&quot;STATUS_TABLE_DOESNT_EXIST&quot;, message);
    uint64_t id = ramcloud-&gt;getTableId(&quot;table2&quot;);
    EXPECT_EQ(2UL, id);
}

using `ramcloud-&gt;getTableId(&quot;bogusTable&quot;);` to get an id from a not exist table,  
and expect return &quot;STATUS_TABLE_DOESNT_EXIST&quot;

from code `tableId2 = ramcloud-&gt;createTable(&quot;table2&quot;);`, expect id of table2 is 2UL
</code></pre></li>
<li><p>code of table operation: create, drop, getTableId, relax files: TableManager.cc</p>
</li>
<li><p>object serialization and deserialization</p>
<pre><code>+---------------+--------+---------------------------+----------+----------+
| Object Header | # keys | Cumulative Key Lengths .. | Keys ... | Data ... |
+---------------+--------+---------------------------+----------+----------+
               &lt;--------------------- keysAndValue -----------------------&gt;

- `Object Header` include checksum, timestamp, version, tableID
- `keys` is keycount, the number of keys in an object 
- `CumulativeKeyLength` is KeyLength
</code></pre></li>
</ul>
<h4 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h4><ul>
<li><a href="https://ramcloud.atlassian.net/wiki/display/RAM/General+Information+for+Developers" target="_blank" rel="external">General Information for Developers</a></li>
<li><a href="http://fumin.hustbackup.cn/?p=1104&amp;utm_source=tuicool" target="_blank" rel="external">RAMCloud 小结</a></li>
<li><a href="http://blog.csdn.net/anzhsoft/article/details/21830991" target="_blank" rel="external">RAMCloud：内存云存储的内存分配机制</a></li>
<li><a href="http://www.csdn.net/article/2011-08-01/302490" target="_blank" rel="external">大规模存储的未来——内存云</a></li>
<li><a href="http://web.stanford.edu/~ouster/cgi-bin/papers/ramcloud.pdf" target="_blank" rel="external">The Case for RAMClouds: Scalable High-Performance Storage Entirely in DRAM</a></li>
<li><a href="http://web.stanford.edu/~ouster/cgi-bin/papers/RumblePhd.pdf" target="_blank" rel="external">MEMORY AND OBJECT MANAGEMENT IN RAMCLOUD</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/06/06/ramcloud/" data-id="cin4qo6iy00907zizrwpyar3s" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-nfs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/25/nfs/" class="article-date">
  <time datetime="2015-03-24T16:00:00.000Z" itemprop="datePublished">2015-03-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/25/nfs/">nfs</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="About-NFS"><a href="#About-NFS" class="headerlink" title="About NFS"></a>About NFS</h3><p>NFS is “Network File System”.</p>
<ul>
<li>linux find NFS version, using command <code>nfsstat -m</code> on client machine, 找到字符串”vers=4.0”<ul>
<li><a href="http://network.51cto.com/art/201008/216664.htm" target="_blank" rel="external">对比分析各个NFS版本的特点</a></li>
</ul>
</li>
</ul>
<h3 id="How-to-use"><a href="#How-to-use" class="headerlink" title="How to use"></a>How to use</h3><ul>
<li><p>On server:</p>
<ul>
<li>service nfs start|stop</li>
<li>set ACL (Access Control Lists) of files and directories.<ul>
<li>setfacl -m other::— PATH</li>
<li>setfacl -m g:GROUP_NAME:rwx PATH</li>
<li>setfacl -m g:GROUP_NAME:— PATH</li>
</ul>
</li>
</ul>
</li>
<li><p>On clinet: mount nfs share disk</p>
<ul>
<li>showmount -e 172.16.130.143</li>
<li>mkdir /mnt/nfs</li>
<li>mount 172.16.130.143:/share/vdshare001 /mnt/nfs</li>
<li>ls /mnt/nfs</li>
<li>umount /mnt/nfs</li>
</ul>
</li>
<li><p>command operation:  </p>
<p>  [root@Ustor ~]# service nfs start<br>  Starting RPC svcgssd:                                      [  OK  ]<br>  Starting NFS services:                                     [  OK  ]<br>  Starting NFS quotas:                                       [  OK  ]<br>  Starting NFS mountd:                                       [  OK  ]<br>  Stopping RPC idmapd:                                       [  OK  ]<br>  Starting RPC idmapd:                                       [  OK  ]<br>  Starting NFS daemon:                                       [  OK  ]<br>  [root@Ustor ~]# service nfs status<br>  rpc.svcgssd (pid 11647) is running…<br>  rpc.mountd (pid 11657) is running…<br>  nfsd (pid 11722 11721 11720 11719 11718 11717 11716 11715) is running…<br>  rpc.rquotad (pid 11653) is running..<br>  [root@Ustor ~]# ps aux |grep nfs<br>  root   11713  0.0  0.0      0     0 ?      S    23:34   0:00 [nfsd4]<br>  root   11714  0.0  0.0      0     0 ?      S    23:34   0:00 [nfsd4_callbacks]<br>  root   11715  0.0  0.0      0     0 ?      S    23:34   0:00 [nfsd]<br>  root   11716  0.0  0.0      0     0 ?      S    23:34   0:00 [nfsd]<br>  root   11717  0.0  0.0      0     0 ?      S    23:34   0:00 [nfsd]<br>  root   11718  0.0  0.0      0     0 ?      S    23:34   0:00 [nfsd]<br>  root   11719  0.0  0.0      0     0 ?      S    23:34   0:00 [nfsd]<br>  root   11720  0.0  0.0      0     0 ?      S    23:34   0:00 [nfsd]<br>  root   11721  0.0  0.0      0     0 ?      S    23:34   0:00 [nfsd]<br>  root   11722  0.0  0.0      0     0 ?      S    23:34   0:00 [nfsd]<br>  root   11904  0.0  0.0 103240   844 pts/1  S+   23:35   0:00 grep nfs<br>  [root@Ustor ~]# netstat -apn |grep 2049<br>  tcp     0      0 0.0.0.0:2049         0.0.0.0:<em>            LISTEN      -<br>  tcp     0      0 :::2049              :::</em>                 LISTEN      -<br>  udp     0      0 0.0.0.0:2049         0.0.0.0:<em>                        -<br>  udp     0      0 :::2049              :::</em>                             -<br>  [root@Ustor ~]# service nfs stop<br>  Shutting down NFS daemon:                                  [  OK  ]<br>  Shutting down NFS mountd:                                  [  OK  ]<br>  Shutting down NFS quotas:                                  [  OK  ]<br>  Shutting down RPC svcgssd:                                 [  OK  ]</p>
</li>
<li><p>check status from /proc/fs/nfs and /proc/fs/nfsd/</p>
</li>
</ul>
<h3 id="Optimal"><a href="#Optimal" class="headerlink" title="Optimal"></a>Optimal</h3><ul>
<li><p>★★★ <strong><a href="http://blog.csdn.net/yangzhongxuan/article/details/7918884" target="_blank" rel="external">nfs的传输速度优化</a></strong></p>
<ul>
<li>设置块大小 <ul>
<li>time dd if=/dev/zero of=/testfs/testfile bs=8k count=1024 测试nfs写</li>
<li>time dd if=/testfs/testfile of=/dev/null bs=8k 测试nfs读</li>
</ul>
</li>
<li>网络传输包的大小<ul>
<li>ping -s 2048 -f hostname, try different package size</li>
<li>nfsstat －o net</li>
<li>tracepath node1/端口号</li>
<li>ifconfig eth0</li>
<li>ifconfig eth0 mtu 16436, modify MTU value</li>
<li>/proc/sys/net/ipv4/ipfrag_high_thresh和/proc/sys/net/ipv4/ipfrag_low_thresh</li>
</ul>
</li>
<li>nfs挂载的优化<ul>
<li>timeo:如果超时，客户端等待的时间，以十分之一秒计算。</li>
<li>retrans：超时尝试的次数。</li>
<li>bg：后台挂载，很有用</li>
<li>hard：如果server端没有响应，那么客户端一直尝试挂载。</li>
<li>wsize：写块大小</li>
<li>rsize：读块大小</li>
<li>intr：可以中断不成功的挂载</li>
<li>noatime：不更新文件的inode访问时间，可以提高速度。</li>
<li>async：异步读写。</li>
</ul>
</li>
<li>nfsd的个数<ul>
<li>ps -efl |grep nfsd</li>
<li>vi /etc/init.d/nfs, modify RPCNFSDCOUNT </li>
<li>service nfs restart</li>
</ul>
</li>
<li>nfsd的队列长度<ul>
<li>/proc/sys/net/core/rmem_default</li>
<li>/proc/sys/net/core/rmem_max</li>
<li>/proc/sys/net/core/wmem_default</li>
<li>/proc/sys/net/core/wmem_max</li>
<li>vi /etc/sysctl.conf</li>
</ul>
</li>
<li>mount 192.168.1.220:/mnt/nfs /mnt/nfs_t -o nolock, rsize=1024,wsize=1024,timeo=15</li>
</ul>
</li>
<li><p><strong>Linux NFS服务性能优化</strong></p>
<ul>
<li>nfsstat -rc</li>
<li><a href="http://blog.chinaunix.net/uid-24404943-id-3389539.html" target="_blank" rel="external">http://blog.chinaunix.net/uid-24404943-id-3389539.html</a></li>
<li>NFS的队列大小, modify server and client machine: (262144 = 256KB)<br>#echo 262144 &gt; /proc/sys/net/core/rmem_default<br>#echo 262144 &gt; /proc/sys/net/core/rmem_max<br>#echo 262144 &gt; /proc/sys/net/core/wmmen_default<br>#echo 262144 &gt; /proc/sys/net/core/wmmen_max  </li>
<li>[root@localhost iperf-2.0.5]# dd if=/dev/zero of=/tmp/test01.dat bs=1M count=10240<br>10240+0 records in<br>10240+0 records out<br>10737418240 bytes (11 GB) copied, 28.2585 s, 380 MB/s  </li>
<li>ping -s 2048 -f 192.16.110.80</li>
<li><a href="http://www.cnblogs.com/derekchen/archive/2013/01/17/2865207.html" target="_blank" rel="external">http://www.cnblogs.com/derekchen/archive/2013/01/17/2865207.html</a></li>
<li><a href="http://www.lichaozheng.info/2011/10/13/nfs性能优化/" target="_blank" rel="external">http://www.lichaozheng.info/2011/10/13/nfs性能优化/</a></li>
<li><a href="http://blog.csdn.net/anghlq/article/details/8532312" target="_blank" rel="external">http://blog.csdn.net/anghlq/article/details/8532312</a></li>
<li>tracepath 192.16.110.80</li>
<li>[root@localhost iperf-2.0.5]# echo “4096” &gt;/sys/class/net/enp10s0f0/mtu</li>
<li>[root@localhost iperf-2.0.5]# dd if=/dev/zero of=/tmp/test04.dat bs=1M count=10240<br>10737418240 bytes (11 GB) copied, 28.0778 s, 382 MB/s  </li>
</ul>
</li>
</ul>
<ul>
<li><p>NFS共享在使用前需要挂载（mount）。挂载时使用的参数很大程度上影响了读写的性能</p>
<ul>
<li><ol>
<li>TCP or UDP</li>
</ol>
</li>
<li><ol>
<li>rsize和wsize，每次读写的最大值</li>
</ol>
</li>
<li><ol>
<li>sync和async. sync参数会强制wsize变成4KB，这会大大降低写性能。 </li>
</ol>
</li>
</ul>
</li>
<li><p><strong>关于SAMBA和NFS是否支持断点续传</strong></p>
<ul>
<li>经过测试，得出如下结论：<ul>
<li>1.samba 不支持</li>
<li>2.nfs     支持</li>
</ul>
</li>
<li>测试环境和步骤如下：</li>
<li>服务端：<ul>
<li>1.172.16.130.200， Centos7.0</li>
</ul>
</li>
<li>Windows 客户端:<ul>
<li>1.yujl本地机器</li>
<li>2.开始-&gt;运行-&gt;\172.16.130.200</li>
<li>3.拷贝一个大的iso文件到xuni文件夹</li>
<li>4.去机房拔掉172.16.130.200机器的网线</li>
<li>5.发现本地的拷贝窗口停止传送数据</li>
<li>6.接上网线，拷贝窗口仍然没有继续传送的迹象</li>
</ul>
</li>
<li>Linux 客户端:<ul>
<li>1.我本地机器</li>
<li>2.挂载172.16.130.200的/share/sambatest目录到本地的/mnt/nfs</li>
<li>3.cp ~/Downloads/iso/CentOS-6.5-x86_64-bin-DVD1.iso /mnt/nfs/</li>
<li>4.去机房拔掉172.16.130.200机器的网线</li>
<li>5.确认本地无法连接172.16.130.200</li>
<li>6.接上网线，使用ls -l /mnt/nfs/发现iso文件的大小还继续增加</li>
<li>7.待cp完成后，md5sume计算两个iso文件，发现md5值一</li>
</ul>
</li>
<li>不支持，<a href="http://bbs.chinaunix.net/thread-4057603-1-1.html" target="_blank" rel="external">http://bbs.chinaunix.net/thread-4057603-1-1.html</a></li>
<li><a href="http://bbs.chinaunix.net/thread-4057603-1-1.html" target="_blank" rel="external">http://bbs.chinaunix.net/thread-4057603-1-1.html</a></li>
</ul>
</li>
</ul>
<h3 id="Code-analysed-kernel-version-linux-2-6-32-279-el6"><a href="#Code-analysed-kernel-version-linux-2-6-32-279-el6" class="headerlink" title="Code analysed(kernel version: linux-2.6.32-279.el6)"></a>Code analysed(kernel version: linux-2.6.32-279.el6)</h3><ul>
<li><p>NFS 文件系统主要分为三个部分：The Protocol（网络协议），Client Side（NFS 客户端）和 Server Side（NFS 服务器）</p>
<ul>
<li>NFS 客户端提供了接口，保证用户或者应用程序能像访问本地文件系统一样访问NFS 文件系统，</li>
<li>NFS 服务器作为数据源，为 NFS 客户端提供真实的文件系统服务</li>
<li>NFS 网络协议则使得 NFS 客户端和 NFS 服务器能够高效和可靠地进行通信</li>
<li>NFS 网络协议使用的是 RPC（Remote Procedure Call，远程过程调用）/XDR（External Data Representation，外部数据表示）机制</li>
</ul>
</li>
<li><p>code file list: </p>
<p>  [dennis@localhost fs]$ pwd<br>  /home/dennis/work/kernel/linux-2.6.32-279.el6/fs<br>  [dennis@localhost fs]$ ls nfs<br>  cache_lib.c      file.c           nfs2xdr.c            nfsroot.c<br>  cache_lib.h      fscache.c        nfs3acl.c            pagelist.c<br>  callback.c       fscache.h        nfs3proc.c           pnfs.c<br>  callback.h       fscache-index.c  nfs3xdr.c            pnfs_dev.c<br>  callback_proc.c  getroot.c        nfs4filelayout.c     pnfs.h<br>  callback_xdr.c   idmap.c          nfs4filelayoutdev.c  proc.c<br>  client.c         inode.c          nfs4filelayout.h     read.c<br>  delegation.c     internal.h       nfs4_fs.h            super.c<br>  delegation.h     iostat.h         nfs4namespace.c      symlink.c<br>  dir.c            Kconfig          nfs4proc.c           sysctl.c<br>  direct.c         Makefile         nfs4renewd.c         unlink.c<br>  dns_resolve.c    mount_clnt.c     nfs4state.c          write.c<br>  dns_resolve.h    namespace.c      nfs4xdr.c<br>  [dennis@localhost fs]$ ls nfsd<br>  auth.c    Makefile    nfs4callback.c  nfscache.c  nfssvc.c  xdr3.h<br>  auth.h    nfs2acl.c   nfs4idmap.c     nfsctl.c    nfsxdr.c  xdr4.h<br>  cache.h   nfs3acl.c   nfs4proc.c      nfsd.h      state.h   xdr.h<br>  export.c  nfs3proc.c  nfs4recover.c   nfsfh.c     stats.c<br>  Kconfig   nfs3xdr.c   nfs4state.c     nfsfh.h     vfs.c<br>  lockd.c   nfs4acl.c   nfs4xdr.c       nfsproc.c   vfs.h<br>  [dennis@localhost fs]$ ls nfs_common<br>  Makefile  nfsacl.c<br>  [dennis@localhost fs]$ cd ../include/linux/<br>  [dennis@localhost linux]$ ls nfs*<br>  nfs2.h      nfs4.h        nfsd_idmap.h  nfs_fs_sb.h  nfs_iostat.h  nfs_xdr.h<br>  nfs3.h      nfs4_mount.h  nfs_fs.h      nfs.h        nfs_mount.h<br>  nfs4_acl.h  nfsacl.h      nfs_fs_i.h    nfs_idmap.h  nfs_page.h</p>
<p>  nfsd:<br>  const.h  debug.h  export.h  Kbuild  nfsfh.h  stats.h  syscall.h</p>
</li>
<li><p>Client Side 源代码  </p>
<p>Client Side 的头文件在 include/linux/ 下面，C 文件在 fs/nfs 下面。</p>
<p>  dir.c/file.c/inode.c/symlink.c/unlink.c：与文件操作相关的系统调用<br>  read.c/write.c/flushd.c：文件读写<br>  mount_clnt.c/nfs_root.c：将 NFS 文件系统作为 root 目录的相关实现<br>  proc.c/nfs2xdr.c/nfs3proc.c/nfs3xdr.c：网络数据交换 </p>
</li>
</ul>
<p>与文件操作相关的系统调用都在 struct file_operations，struct inode_operations<br>这两个数据结构里面定义。文件的读操作 nfs_file_read 和写操作 nfs_file_write 被单<br>独提出来，因为文件读写性能将直接关系到文件系统的成败</p>
<ul>
<li>Server Side 源代码</li>
</ul>
<p>Server Side 的头文件在 include/linux/nfsd 下面，C 文件在 fs/nfsd 下面。</p>
<pre><code>auth.c/lockd.c/export.c/nfsctl.c/nfscache.c/nfsfh.c/stats.c：导出目录的访问管理
nfssvc.c：NFS 服务 deamon 的实现
vfs.c：将 NFS 文件系统的操作转换成具体文件系统的操作
nfsproc.c/nfsxdr.c/nfs3proc.c/nfs3xdr.c：网络数据交换
</code></pre><p>导出目录的访问管理主要解决网络文件系统实现面临的几个重要问题，包括目录导出服务，<br>外部访问的权限控制，多客户端以及客户端与服务器的文件并发操作等。 </p>
<ul>
<li><p>process number of nfsd:  </p>
</li>
<li><p>rename call stack:  </p>
<p>  client: nfs_rename -&gt;<br>  server: nfsd4_rename -&gt; nfsd_rename </p>
</li>
<li><p><strong>To be continue…</strong></p>
</li>
</ul>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><strong><a href="http://www.ibm.com/developerworks/cn/linux/l-cn-nfs/" target="_blank" rel="external">NFS文件系统源代码剖析</a></strong></li>
<li><a href="http://zohead.com/archives/nfs-rwsize/" target="_blank" rel="external">NFS读写块大小问题分析</a></li>
<li><a href="http://www.lichaozheng.info/2011/10/13/nfs性能优化/" target="_blank" rel="external">NFS性能优化手册</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/03/25/nfs/" data-id="cin4qo6ix008z7ziziwlay0es" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-how-to-detect-the-internal-network-topology-of-company" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/12/how-to-detect-the-internal-network-topology-of-company/" class="article-date">
  <time datetime="2015-03-11T16:00:00.000Z" itemprop="datePublished">2015-03-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/12/how-to-detect-the-internal-network-topology-of-company/">how to detect the internal network topology of company</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="What-I-want"><a href="#What-I-want" class="headerlink" title="What I want"></a>What I want</h3><p>How can know how many route/hub/switch are in my LAN network?</p>
<h3 id="What-I-know"><a href="#What-I-know" class="headerlink" title="What I know"></a>What I know</h3><ul>
<li>Host LAN IP is : 172.16.50.39</li>
<li>gateway is : 172.16.50.1</li>
<li>WLan IP: 219.134.89.155</li>
</ul>
<h3 id="Operations"><a href="#Operations" class="headerlink" title="Operations"></a>Operations</h3><pre><code>[dennis@localhost ~]$ ip addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: enp2s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:23:ae:96:d6:9a brd ff:ff:ff:ff:ff:ff
    inet 172.16.50.39/24 brd 172.16.50.255 scope global enp2s0
       valid_lft forever preferred_lft forever
    inet6 fe80::223:aeff:fe96:d69a/64 scope link 
       valid_lft forever preferred_lft forever
[dennis@localhost ~]$ route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
^C
[dennis@localhost ~]$ route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         172.16.50.1     0.0.0.0         UG    1024   0        0 enp2s0
172.16.50.0     0.0.0.0         255.255.255.0   U     0      0        0 enp2s0
[dennis@localhost ~]$ curl ifconfig.me
219.134.89.155
[dennis@localhost ~]$ ping www.baidu.com
PING www.a.shifen.com (180.97.33.108) 56(84) bytes of data.
64 bytes from 180.97.33.108: icmp_seq=1 ttl=51 time=36.6 ms
64 bytes from 180.97.33.108: icmp_seq=2 ttl=51 time=42.0 ms
...
^C
--- www.a.shifen.com ping statistics ---
120 packets transmitted, 120 received, 0% packet loss, time 138219ms
rtt min/avg/max/mdev = 28.061/41.513/82.900/10.308 ms
[dennis@localhost ~]$ traceroute www.baidu.com
traceroute to www.baidu.com (180.97.33.107), 30 hops max, 60 byte packets
 1  172.16.50.1 (172.16.50.1)  3.386 ms  3.431 ms  3.463 ms
 2  219.134.89.153 (219.134.89.153)  6.355 ms  7.169 ms  7.155 ms
 3  10.1.100.37 (10.1.100.37)  5.989 ms  6.274 ms  6.318 ms
 4  121.15.130.18 (121.15.130.18)  7.180 ms  7.167 ms  7.153 ms
 5  61.104.38.59.broad.fs.gd.dynamic.163data.com.cn (59.38.104.61)  6.227 ms  6.219 ms 57.104.38.59.broad.fs.gd.dynamic.163data.com.cn (59.38.104.57)  6.924 ms
 6  183.56.65.30 (183.56.65.30)  31.614 ms 183.56.66.2 (183.56.66.2)  13.175 ms 183.56.65.38 (183.56.65.38)  12.152 ms
 7  202.97.64.73 (202.97.64.73)  37.557 ms  37.543 ms  38.302 ms
 8  202.102.69.114 (202.102.69.114)  42.036 ms  43.259 ms  43.246 ms
 9  * * *
10  180.97.32.2 (180.97.32.2)  37.346 ms 180.97.32.6 (180.97.32.6)  38.140 ms 180.97.32.22 (180.97.32.22)  36.722 ms
11  * * *
12  * * *
13  * * *
14  * * *
15  * * *
16  * * *
17  * * *
18  * * *
19  * * *
20  * * *
21  * * *
22  * * *
23  * * *
24  * * *
25  * * *
26  * * *
27  * * *
28  * * *
29  * * *
30  * * *
[dennis@localhost ~]$ traceroute 219.134.89.155
traceroute to 219.134.89.155 (219.134.89.155), 30 hops max, 60 byte packets
 1  172.16.50.1 (172.16.50.1)  3.835 ms  3.856 ms  3.885 ms
 2  * * *
 3  * * *
 4  * * *
 5  * * *
 6  * * *
 7  * * *
 8  * * *
 9  * * *
10  * * *
11  * * *
12  * * *
13  * * *
14  * * *
15  * * *
16  * * *
17  * * *
18  * * *
19  * * *
20  * * *
21  * * *
22  * * *
23  * * *
24  * * *
25  * * *
26  * * *
27  * * *
28  * * *
29  * * *
30  * * *
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/03/12/how-to-detect-the-internal-network-topology-of-company/" data-id="cin4qo6iw008y7ziz9x6cr38i" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-understand-linux-route" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/03/11/understand-linux-route/" class="article-date">
  <time datetime="2015-03-10T16:00:00.000Z" itemprop="datePublished">2015-03-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/03/11/understand-linux-route/">understand linux route</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="路由规则理解"><a href="#路由规则理解" class="headerlink" title="路由规则理解"></a>路由规则理解</h3><p>主机的网络封包需要会根据路由规则来判断如何将封包发送出去</p>
<p>路由是雙向的，你必須要瞭解出去的路由與回來時的規則</p>
<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><ul>
<li><code>route</code><br><code>route -n</code><br><code>route add default gw 172.16.130.1 eth2</code><br><code>route del default gw 172.16.130.1 eth2</code><br><code>route add -host 192.168.168.110 dev eth0</code><br><code>route del -host 192.168.168.110 dev eth0</code><br><code>route add -net 172.16.130.0/24 gw 172.16.130.1 eth2</code><br><code>route del -net 172.16.0.0 netmask 255.255.0.0 dev eth0</code><br><code>ip route flush cache</code>  </li>
<li><code>sysctl -a |grep forward</code></li>
<li><code>sysctl -a |grep ignore</code></li>
<li><code>echo 2 &gt; /proc/sys/net/ipv4/conf/default/rp_filter</code></li>
<li><code>echo 2 &gt; /proc/sys/net/ipv4/conf/all/rp_filter</code></li>
<li><code>sysctl -p</code></li>
<li><code>vim /etc/sysctl.conf</code></li>
<li><code>traceroute www.baidu.com</code></li>
</ul>
<h3 id="相关配置文件"><a href="#相关配置文件" class="headerlink" title="相关配置文件"></a>相关配置文件</h3><pre><code>[root@localhost ~]# cat /etc/iproute2/rt_tables
#
# reserved values
#
255    local
254    main
253    default
0    unspec
#
# local
#
#1    inr.ruhep
[root@localhost ~]# sysctl -a |grep ignore
net.ipv4.conf.all.arp_ignore = 0
net.ipv4.conf.default.arp_ignore = 0
net.ipv4.conf.lo.arp_ignore = 0
net.ipv4.conf.eth0.arp_ignore = 0
net.ipv4.conf.eth1.arp_ignore = 0
net.ipv4.icmp_echo_ignore_all = 0
net.ipv4.icmp_echo_ignore_broadcasts = 1
net.ipv4.icmp_ignore_bogus_error_responses = 1
[root@localhost ~]# cat /etc/sysctl.conf 
</code></pre><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>如果是双网卡且设定的是同一网段IP:   </p>
<ul>
<li>eth0 : 192.168.0.100</li>
<li>eth1 : 192.168.0.200</li>
</ul>
<p>那么一般会生成这样的路由规则:  </p>
<pre><code>[root@www ~]# route -n
Kernel IP routing table
Destination     Gateway   Genmask         Flags Metric Ref   Use Iface
192.168.0.0     0.0.0.0   255.255.255.0   U     0      0       0 eth1
192.168.0.0     0.0.0.0   255.255.255.0   U     0      0       0 eth0
</code></pre><p>也就是說:  </p>
<ul>
<li>當要主動發送封包到192.168.0.0/24的網域時，都只會透過第一條規則，也就是透過eth1來傳出去!</li>
<li>在回應封包方面，不管是由eth0還是由eth1進來的網路封包，都會透過 eth1 來回傳!</li>
</ul>
<p>来自: <a href="http://linux.vbird.org/linux_server/0230router.php" target="_blank" rel="external">http://linux.vbird.org/linux_server/0230router.php</a>, [8.1.3 重複路由的問題] </p>
<h3 id="只设置一个网口IP"><a href="#只设置一个网口IP" class="headerlink" title="只设置一个网口IP"></a>只设置一个网口IP</h3><pre><code>[dennis@localhost ~]$ ssh root@172.16.60.53
root@172.16.60.53&apos;s password: 
Last login: Wed Mar 11 17:54:12 2015 from 172.16.50.39
[root@localhost ~]# route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
172.16.60.0     *               255.255.255.0   U     0      0        0 eth2
default         172.16.60.1     0.0.0.0         UG    0      0        0 eth2
[root@localhost ~]# ip addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc mq state DOWN qlen 1000
    link/ether a0:36:9f:32:b0:d0 brd ff:ff:ff:ff:ff:ff
3: eth1: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc mq state DOWN qlen 1000
    link/ether a0:36:9f:32:b0:d1 brd ff:ff:ff:ff:ff:ff
4: eth2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP qlen 1000
    link/ether 00:25:90:f4:6b:60 brd ff:ff:ff:ff:ff:ff
    inet 172.16.60.53/24 brd 172.16.60.255 scope global eth2
    inet6 fe80::225:90ff:fef4:6b60/64 scope link 
       valid_lft forever preferred_lft forever
5: eth3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP qlen 1000
    link/ether 00:25:90:f4:6b:61 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::225:90ff:fef4:6b61/64 scope link 
       valid_lft forever preferred_lft forever
</code></pre><h3 id="没有问题的设定"><a href="#没有问题的设定" class="headerlink" title="没有问题的设定"></a>没有问题的设定</h3><pre><code>[dennis@localhost ~]$ ssh root@172.16.130.105
root@172.16.130.105&apos;s password: 
Permission denied, please try again.
root@172.16.130.105&apos;s password: 
Last login: Wed Mar 11 16:34:38 2015 from 172.16.50.39
[root@localhost ~]# route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
172.16.130.0    *               255.255.255.0   U     0      0        0 eth0
172.16.130.0    *               255.255.255.0   U     0      0        0 eth1
default         172.16.130.1    0.0.0.0         UG    0      0        0 eth1
default         172.16.130.1    0.0.0.0         UG    0      0        0 eth0
[root@localhost ~]# ping 172.16.50.39 -I eth1
PING 172.16.50.39 (172.16.50.39) from 172.16.130.106 eth1: 56(84) bytes of data.
64 bytes from 172.16.50.39: icmp_seq=1 ttl=63 time=11.7 ms
64 bytes from 172.16.50.39: icmp_seq=2 ttl=63 time=0.265 ms
^C
--- 172.16.50.39 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1568ms
rtt min/avg/max/mdev = 0.265/6.030/11.795/5.765 ms
[root@localhost ~]# ping 172.16.50.39 -I eth0
PING 172.16.50.39 (172.16.50.39) from 172.16.130.105 eth0: 56(84) bytes of data.
64 bytes from 172.16.50.39: icmp_seq=1 ttl=63 time=0.244 ms
64 bytes from 172.16.50.39: icmp_seq=2 ttl=63 time=6.12 ms
64 bytes from 172.16.50.39: icmp_seq=3 ttl=63 time=6.50 ms
^C
--- 172.16.50.39 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2414ms
rtt min/avg/max/mdev = 0.244/4.290/6.504/2.866 ms
[root@localhost ~]# ip addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000
    link/ether 00:25:90:de:fc:13 brd ff:ff:ff:ff:ff:ff
    inet 172.16.130.106/24 scope global eth1
    inet6 fe80::225:90ff:fede:fc13/64 scope link 
       valid_lft forever preferred_lft forever
3: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000
    link/ether 00:25:90:de:fc:12 brd ff:ff:ff:ff:ff:ff
    inet 172.16.130.105/24 scope global eth0
    inet6 fe80::225:90ff:fede:fc12/64 scope link 
       valid_lft forever preferred_lft forever
[root@localhost ~]# ip route show
172.16.130.0/24 dev eth0  proto kernel  scope link  src 172.16.130.105 
172.16.130.0/24 dev eth1  proto kernel  scope link  src 172.16.130.106 
default via 172.16.130.1 dev eth1 
default via 172.16.130.1 dev eth0 
</code></pre><h3 id="一台奇怪问题的机器"><a href="#一台奇怪问题的机器" class="headerlink" title="一台奇怪问题的机器"></a>一台奇怪问题的机器</h3><p>问题机器: 双网卡，IP信息 eth0:172.16.60.150 eth1:172.16.60.151 网关172.16.60.1  </p>
<p>本地主机: IP 172.16.50.39, 网关:172.16.50.1</p>
<p>本地(50.39)可以正常ssh登陆60.150  </p>
<p>但ping 172.16.60.151没有回应:</p>
<pre><code>[root@localhost ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth0
DEVICE=eth0
HWADDR=00:1e:67:c9:9a:f4
TYPE=Ethernet
UUID=5adb47dc-d361-43b7-a23a-f17c2ade1e2d
ONBOOT=yes
NM_CONTROLLED=yes
BOOTPROTO=none
IPADDR=172.16.60.150
NETMASK=255.255.255.0
GATEWAY=172.16.60.1
IPV6INIT=no
USERCTL=no
[root@localhost ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth1
DEVICE=eth1
HWADDR=00:1e:67:c9:9a:f5
TYPE=Ethernet
UUID=2af28c1e-abe2-4805-8c78-880ffbfc567e
ONBOOT=yes
NM_CONTROLLED=yes
BOOTPROTO=none
IPV6INIT=no
USERCTL=no
IPADDR=172.16.60.151
NETMASK=255.255.255.0
GATEWAY=172.16.60.1
[root@localhost ~]# ip addr  
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 16436 qdisc noqueue state UNKNOWN   
  link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00  
  inet 127.0.0.1/8 scope host lo  
  inet6 ::1/128 scope host   
     valid_lft forever preferred_lft forever  
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP qlen 1000  
  link/ether 00:1e:67:c9:9a:f4 brd ff:ff:ff:ff:ff:ff  
  inet 172.16.60.150/24 brd 172.16.60.255 scope global eth0  
  inet6 fe80::21e:67ff:fec9:9af4/64 scope link   
     valid_lft forever preferred_lft forever  
3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP qlen 1000  
  link/ether 00:1e:67:c9:9a:f5 brd ff:ff:ff:ff:ff:ff  
  inet 172.16.60.151/24 brd 172.16.60.255 scope global eth1  
  inet6 fe80::21e:67ff:fec9:9af5/64 scope link   
     valid_lft forever preferred_lft forever  
[root@localhost ~]# route  
Kernel IP routing table  
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface  
172.16.60.0     *               255.255.255.0   U     0      0        0 eth0  
172.16.60.0     *               255.255.255.0   U     0      0        0 eth1  
link-local      *               255.255.0.0     U     1002   0        0 eth0  
link-local      *               255.255.0.0     U     1003   0        0 eth1  
default         172.16.60.1     0.0.0.0         UG    0      0        0 eth0  
</code></pre><p>通过同一网段的机器(172.16.60.53)，ping 151得到的是Destination Host Unreachable  </p>
<pre><code>[dennis@localhost ~]$ ssh root@172.16.60.53
The authenticity of host &apos;172.16.60.53 (172.16.60.53)&apos; can&apos;t be established.
RSA key fingerprint is e6:b0:c1:60:53:cd:77:7c:32:e4:27:4f:01:43:5a:8a.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added &apos;172.16.60.53&apos; (RSA) to the list of known hosts.
root@172.16.60.53&apos;s password: 
Last login: Fri Dec  6 04:46:04 2013
[root@localhost ~]# route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
172.16.60.0     *               255.255.255.0   U     0      0        0 eth2
default         172.16.60.1     0.0.0.0         UG    0      0        0 eth2
[root@localhost ~]# ping 172.16.60.151
PING 172.16.60.151 (172.16.60.151) 56(84) bytes of data.
From 172.16.60.53 icmp_seq=2 Destination Host Unreachable
From 172.16.60.53 icmp_seq=3 Destination Host Unreachable
From 172.16.60.53 icmp_seq=4 Destination Host Unreachable
^C
--- 172.16.60.151 ping statistics ---
5 packets transmitted, 0 received, +3 errors, 100% packet loss, time 4988ms
pipe 3
[root@localhost ~]# ping 172.16.60.150
PING 172.16.60.150 (172.16.60.150) 56(84) bytes of data.
64 bytes from 172.16.60.150: icmp_seq=1 ttl=64 time=0.933 ms
64 bytes from 172.16.60.150: icmp_seq=2 ttl=64 time=0.235 ms
64 bytes from 172.16.60.150: icmp_seq=3 ttl=64 time=0.223 ms
^C
--- 172.16.60.150 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2045ms
rtt min/avg/max/mdev = 0.223/0.463/0.933/0.332 ms
[root@localhost ~]# 
</code></pre><p>且从eth1(60.151)ping不通网关(172.16.60.1), ping同网段另外一台机器(60.53)开始会停顿:   </p>
<pre><code>[root@localhost ~]# arp
Address                  HWtype  HWaddress           Flags Mask            Iface
172.16.60.1              ether   00:0f:e2:b1:c7:5d   C                     eth0
[root@localhost ~]# route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
172.16.60.0     *               255.255.255.0   U     0      0        0 eth0
172.16.60.0     *               255.255.255.0   U     0      0        0 eth1
link-local      *               255.255.0.0     U     1002   0        0 eth0
default         172.16.60.1     0.0.0.0         UG    0      0        0 eth0
[root@localhost ~]# ping 172.16.60.53 -I eth1
PING 172.16.60.53 (172.16.60.53) from 172.16.60.151 eth1: 56(84) bytes of data.
64 bytes from 172.16.60.53: icmp_seq=10 ttl=64 time=1.08 ms
64 bytes from 172.16.60.53: icmp_seq=11 ttl=64 time=0.228 ms
64 bytes from 172.16.60.53: icmp_seq=12 ttl=64 time=0.230 ms
64 bytes from 172.16.60.53: icmp_seq=13 ttl=64 time=0.226 ms
64 bytes from 172.16.60.53: icmp_seq=14 ttl=64 time=0.238 ms
64 bytes from 172.16.60.53: icmp_seq=15 ttl=64 time=0.225 ms
64 bytes from 172.16.60.53: icmp_seq=16 ttl=64 time=0.227 ms
^C
--- 172.16.60.53 ping statistics ---
16 packets transmitted, 7 received, 56% packet loss, time 15646ms
rtt min/avg/max/mdev = 0.225/0.351/1.085/0.299 ms
[root@localhost ~]# ping 172.16.50.39 -I eth1
PING 172.16.50.39 (172.16.50.39) from 172.16.60.151 eth1: 56(84) bytes of data.
From 172.16.60.151 icmp_seq=2 Destination Host Unreachable
From 172.16.60.151 icmp_seq=3 Destination Host Unreachable
From 172.16.60.151 icmp_seq=4 Destination Host Unreachable
From 172.16.60.151 icmp_seq=6 Destination Host Unreachable
From 172.16.60.151 icmp_seq=7 Destination Host Unreachable
From 172.16.60.151 icmp_seq=8 Destination Host Unreachable
^C
--- 172.16.50.39 ping statistics ---
8 packets transmitted, 0 received, +6 errors, 100% packet loss, time 7646ms
pipe 3
[root@localhost ~]# ping 172.16.60.1 -I eth1
PING 172.16.60.1 (172.16.60.1) from 172.16.60.151 eth1: 56(84) bytes of data.
</code></pre><p>执行<code>route add default gw 172.16.60.1 eth1</code>后，可以ping 172.16.60.151,但是150有问题了.  </p>
<p>使用ssh root@172.16.60.151登陆看到的路由信息</p>
<pre><code>[root@localhost ~]# route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
172.16.60.0     *               255.255.255.0   U     0      0        0 eth0
172.16.60.0     *               255.255.255.0   U     0      0        0 eth1
link-local      *               255.255.0.0     U     1002   0        0 eth0
default         172.16.60.1     0.0.0.0         UG    0      0        0 eth1
default         172.16.60.1     0.0.0.0         UG    0      0        0 eth0
[root@localhost ~]# ping 172.16.60.1 -I eth0
PING 172.16.60.1 (172.16.60.1) from 172.16.60.150 eth0: 56(84) bytes of data.
64 bytes from 172.16.60.1: icmp_seq=1 ttl=255 time=8.88 ms
64 bytes from 172.16.60.1: icmp_seq=2 ttl=255 time=6.85 ms
64 bytes from 172.16.60.1: icmp_seq=3 ttl=255 time=1.74 ms
^C
--- 172.16.60.1 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2142ms
rtt min/avg/max/mdev = 1.747/5.830/8.885/3.003 ms
[root@localhost ~]# ping 172.16.60.1 -I eth1
PING 172.16.60.1 (172.16.60.1) from 172.16.60.151 eth1: 56(84) bytes of data.
^C
--- 172.16.60.1 ping statistics ---
17 packets transmitted, 0 received, 100% packet loss, time 16976ms

[root@localhost ~]# ping 172.16.50.39 -I eth0
PING 172.16.50.39 (172.16.50.39) from 172.16.60.150 eth0: 56(84) bytes of data.
^C
--- 172.16.50.39 ping statistics ---
13 packets transmitted, 0 received, 100% packet loss, time 12830ms

[root@localhost ~]# ping 172.16.50.39 -I eth1
PING 172.16.50.39 (172.16.50.39) from 172.16.60.151 eth1: 56(84) bytes of data.
64 bytes from 172.16.50.39: icmp_seq=1 ttl=63 time=0.245 ms
64 bytes from 172.16.50.39: icmp_seq=2 ttl=63 time=0.296 ms
^C
--- 172.16.50.39 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1391ms
rtt min/avg/max/mdev = 0.245/0.270/0.296/0.030 ms
[root@localhost ~]# ping 172.16.60.53 -I eth0
PING 172.16.60.53 (172.16.60.53) from 172.16.60.150 eth0: 56(84) bytes of data.
64 bytes from 172.16.60.53: icmp_seq=1 ttl=64 time=0.252 ms
64 bytes from 172.16.60.53: icmp_seq=2 ttl=64 time=0.196 ms
^C
--- 172.16.60.53 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1342ms
rtt min/avg/max/mdev = 0.196/0.224/0.252/0.028 ms
[root@localhost ~]# ping 172.16.60.53 -I eth1
PING 172.16.60.53 (172.16.60.53) from 172.16.60.151 eth1: 56(84) bytes of data.
64 bytes from 172.16.60.53: icmp_seq=1 ttl=64 time=0.236 ms
64 bytes from 172.16.60.53: icmp_seq=2 ttl=64 time=0.232 ms
64 bytes from 172.16.60.53: icmp_seq=3 ttl=64 time=0.240 ms
^C
--- 172.16.60.53 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2431ms
rtt min/avg/max/mdev = 0.232/0.236/0.240/0.003 ms
</code></pre><p><strong>这时候应该怎么设置route呢?</strong></p>
<p>可是没有看出哪里有问题，发往172.16.60.XX ip段的都从eth0走，其他IP段的从eth0发送给默认网关172.16.60.1</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://linux.vbird.org/linux_server/0150detect_network.php" target="_blank" rel="external">Linux 網路偵錯</a></li>
<li><a href="http://my.oschina.net/jing31/blog/6611" target="_blank" rel="external">Linux双网卡设置IP属于同一网段的问题</a></li>
<li><a href="http://os.51cto.com/art/201205/339800.htm" target="_blank" rel="external">Linux系统IP路由的工作原理</a></li>
<li><a href="http://linux.vbird.org/linux_server/0230router.php" target="_blank" rel="external">路由觀念與路由器設定</a></li>
<li><a href="http://my.oschina.net/guol/blog/156607" target="_blank" rel="external">Linux策略路由</a></li>
<li><a href="http://yuangeqingtian.blog.51cto.com/6994701/1218946" target="_blank" rel="external">linux下路由表详解</a></li>
<li><a href="http://www.centoscn.com/CentOS/Intermediate/2013/0915/1633.html" target="_blank" rel="external">CentOS双网卡策略路由测试</a></li>
<li><a href="http://my.oschina.net/7shell/blog/308887" target="_blank" rel="external">Linux双网卡(内外网)同时使用路由设置</a></li>
<li><a href="http://forum.ubuntu.org.cn/viewtopic.php?f=54&amp;t=327616" target="_blank" rel="external">linux双网卡实现局域网跨网段访问</a></li>
<li><a href="http://blog.csdn.net/zhuying_linux/article/details/6770730" target="_blank" rel="external">ping工作原理</a></li>
<li><a href="http://stackoverflow.com/questions/18536796/icmp-request-received-but-doesnt-reply" target="_blank" rel="external">icmp request received, but doesn’t reply</a></li>
<li><a href="https://access.redhat.com/solutions/53031" target="_blank" rel="external">https://access.redhat.com/solutions/53031</a></li>
<li><a href="http://fengyun.blog.51cto.com/532912/608713" target="_blank" rel="external">杂谈icmp</a></li>
<li><a href="http://leo0216.blog.51cto.com/188904/84863" target="_blank" rel="external">LINUX ROUTE配置小记</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/03/11/understand-linux-route/" data-id="cin4qo6iv008x7zizxpcg06el" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-message-queue-middleware" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/02/09/message-queue-middleware/" class="article-date">
  <time datetime="2015-02-08T16:00:00.000Z" itemprop="datePublished">2015-02-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/02/09/message-queue-middleware/">Message Queue Middleware</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Introduce"><a href="#Introduce" class="headerlink" title="Introduce"></a>Introduce</h3><ul>
<li>MOM: Message Oriented Middleware</li>
<li>Message Queue ( MQ ) is a middleware between applications and networks.</li>
</ul>
<p>There are a number of open source choices of messaging middleware systems, including   </p>
<ul>
<li>JBoss Messaging </li>
<li>JORAM </li>
<li><a href="http://en.wikipedia.org/wiki/Apache_ActiveMQ" target="_blank" rel="external">Apache ActiveMQ</a></li>
<li>Sun Open Message Queue </li>
<li>Apache Qpid</li>
<li><a href="http://en.wikipedia.org/wiki/RabbitMQ" target="_blank" rel="external">RabbitMQ</a></li>
<li>Beanstalkd </li>
<li>Tarantool </li>
<li>HTTPSQS</li>
<li><a href="http://en.wikipedia.org/wiki/Microsoft_Message_Queuing" target="_blank" rel="external">MSMQ</a></li>
</ul>
<h3 id="Compare"><a href="#Compare" class="headerlink" title="Compare"></a>Compare</h3><ul>
<li>Application A &lt;–&gt; Network &lt;–&gt; Application B</li>
<li>Application A &lt;–&gt; MOM &lt;—&gt; Application B</li>
</ul>
<h3 id="Standard-and-protocol"><a href="#Standard-and-protocol" class="headerlink" title="Standard and protocol"></a>Standard and protocol</h3><ul>
<li>AMQP</li>
</ul>
<h3 id="Using-ActiveMQ"><a href="#Using-ActiveMQ" class="headerlink" title="Using ActiveMQ"></a>Using ActiveMQ</h3><p><strong>1.Download and run activemq</strong>:  </p>
<ul>
<li>Download the latest activemq from <a href="http://activemq.apache.org/download.html" target="_blank" rel="external">http://activemq.apache.org/download.html</a></li>
<li>tar xvf apache-activemq-5.11.0-bin.tar.gz </li>
<li>cd apache-activemq-5.11.0</li>
<li>./bin/activemq start </li>
<li><a href="http://localhost:8161" target="_blank" rel="external">http://localhost:8161</a>. The default username and password is admin/admin</li>
<li>check running: <ul>
<li>netstat -apn |grep 61616</li>
<li>ps aux |grep activemq</li>
</ul>
</li>
<li>./bin/activemq stop</li>
<li>for more information, read docs/user-guide.html </li>
</ul>
<p><strong>2.Build openwire-cpp example</strong>:  </p>
<ul>
<li>yum install activemq-cpp-devel</li>
<li>cd /home/dennis/Downloads/apache-activemq-5.11.0/examples/openwire/cpp </li>
<li>gcc Listener.cpp -o listener -I/usr/include/activemq-cpp-3.8.3 -I/usr/include/apr-1 -lactivemq-cpp -lstdc++</li>
<li>gcc Publisher.cpp -o publisher -I/usr/include/activemq-cpp-3.8.3 -I/usr/include/apr-1 -lactivemq-cpp -lstdc++</li>
</ul>
<p><strong>3.Running example</strong>:  </p>
<ul>
<li><p>3.1 Run service as root </p>
<p>  [dennis@localhost apache-activemq-5.11.0]$ su<br>  Password:<br>  [root@localhost apache-activemq-5.11.0]# ./bin/activemq start<br>  INFO: Loading ‘/home/dennis/Downloads/apache-activemq-5.11.0/bin/env’<br>  INFO: Using java ‘/usr/bin/java’<br>  INFO: Process with pid ‘3510’ is already running</p>
</li>
<li><p>3.2 Run listener  </p>
<h1 id="dennis-localhost-cpp-listener"><a href="#dennis-localhost-cpp-listener" class="headerlink" title="  [dennis@localhost cpp]$ ./listener "></a>  [dennis@localhost cpp]$ ./listener </h1><h2 id="Starting-the-Listener-example"><a href="#Starting-the-Listener-example" class="headerlink" title="  Starting the Listener example:"></a>  Starting the Listener example:</h2><p>  Waiting for messages…<br>  Received 1000 messages.<br>  Received 2000 messages.<br>  Received 3000 messages.<br>  Received 4000 messages.<br>  Received 5000 messages.<br>  Received 6000 messages.<br>  Received 7000 messages.<br>  Received 8000 messages.<br>  Received 9000 messages.<br>  Received 10000 messages.</p>
<h2 id="Received-10000-in-1-606-seconds"><a href="#Received-10000-in-1-606-seconds" class="headerlink" title="  Received 10000 in 1.606 seconds"></a>  Received 10000 in 1.606 seconds</h2><h1 id="Finished-with-the-example"><a href="#Finished-with-the-example" class="headerlink" title="  Finished with the example."></a>  Finished with the example.</h1></li>
<li><p>3.3 Run publisher  </p>
<h1 id="dennis-localhost-cpp-publisher"><a href="#dennis-localhost-cpp-publisher" class="headerlink" title="  [dennis@localhost cpp]$ ./publisher "></a>  [dennis@localhost cpp]$ ./publisher </h1><h2 id="Starting-the-Publisher-example"><a href="#Starting-the-Publisher-example" class="headerlink" title="  Starting the Publisher example:"></a>  Starting the Publisher example:</h2><p>  Sent 1000 messages<br>  Sent 2000 messages<br>  Sent 3000 messages<br>  Sent 4000 messages<br>  Sent 5000 messages<br>  Sent 6000 messages<br>  Sent 7000 messages<br>  Sent 8000 messages<br>  Sent 9000 messages</p>
<h2 id="Sent-10000-messages"><a href="#Sent-10000-messages" class="headerlink" title="  Sent 10000 messages"></a>  Sent 10000 messages</h2><h1 id="Finished-with-the-example-1"><a href="#Finished-with-the-example-1" class="headerlink" title="  Finished with the example."></a>  Finished with the example.</h1></li>
</ul>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="http://en.wikipedia.org/wiki/Message_queue" target="_blank" rel="external">Message Queue</a></li>
<li><a href="http://en.wikipedia.org/wiki/Message-oriented_middleware" target="_blank" rel="external">Message-oriented middleware</a></li>
<li><a href="http://blog.fity.cn/post/377/" target="_blank" rel="external">消息队列中间件的技术选型分析</a></li>
<li><a href="http://www.infoq.com/cn/articles/apache-kafka" target="_blank" rel="external">Apache Kafka：下一代分布式消息系统</a></li>
<li>★★★<a href="http://alibaba.github.io/RocketMQ-docs/document/openuser/mqvsmq.pdf" target="_blank" rel="external">消息队列中间件调研文档</a></li>
<li><a href="http://www.ibm.com/developerworks/cn/websphere/library/techarticles/loulijun/MQnewer/MQnewer.html" target="_blank" rel="external">消息中间件及WebSphere MQ入门</a></li>
<li><a href="https://github.com/zeromq" target="_blank" rel="external">The ZeroMQ project</a></li>
<li><a href="http://api.zeromq.org/" target="_blank" rel="external">api of zeroMQ</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/02/09/message-queue-middleware/" data-id="cin4qo6iu008w7zizvp2erovy" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-linux-network-performance-monitor" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/01/21/linux-network-performance-monitor/" class="article-date">
  <time datetime="2015-01-20T16:00:00.000Z" itemprop="datePublished">2015-01-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/01/21/linux-network-performance-monitor/">linux network performance monitor</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="ethtool"><a href="#ethtool" class="headerlink" title="ethtool"></a>ethtool</h3><h3 id="iptraf"><a href="#iptraf" class="headerlink" title="iptraf"></a>iptraf</h3><h3 id="netperf"><a href="#netperf" class="headerlink" title="netperf"></a>netperf</h3><h3 id="iperf"><a href="#iperf" class="headerlink" title="iperf"></a>iperf</h3><p>Build from source:  </p>
<pre><code>[root@localhost ~]# tar xvf iperf-2.0.5.tar.gz 
...
[root@localhost ~]# cd iperf-2.0.5
[root@localhost iperf-2.0.5]# ./configure 
...
[root@localhost iperf-2.0.5]# make
...
</code></pre><p>On server machine:  </p>
<pre><code>[root@Ustor iperf-2.0.5]# ./src/iperf -s
------------------------------------------------------------
Server listening on TCP port 5001
TCP window size: 85.3 KByte (default)
------------------------------------------------------------
[  4] local 192.16.110.80 port 5001 connected with 192.16.110.50 port 43341
[ ID] Interval       Transfer     Bandwidth
[  4]  0.0-10.0 sec  9.20 GBytes  7.90 Gbits/sec
[  5] local 192.16.110.80 port 5001 connected with 192.16.110.50 port 43342
[  5]  0.0-10.0 sec  9.26 GBytes  7.95 Gbits/sec
[  4] local 192.16.110.80 port 5001 connected with 192.16.110.50 port 43343
[  4]  0.0-10.0 sec  8.98 GBytes  7.71 Gbits/sec
</code></pre><p>On Client machine:  </p>
<pre><code>[root@localhost iperf-2.0.5]# ./src/iperf -c 192.16.110.80 -f M -i 2
------------------------------------------------------------
Client connecting to 192.16.110.80, TCP port 5001
TCP window size: 0.02 MByte (default)
------------------------------------------------------------
[  3] local 192.16.110.50 port 43343 connected with 192.16.110.80 port 5001
[ ID] Interval       Transfer     Bandwidth
[  3]  0.0- 2.0 sec  1598 MBytes   799 MBytes/sec
[  3]  2.0- 4.0 sec  1919 MBytes   960 MBytes/sec
[  3]  4.0- 6.0 sec  1892 MBytes   946 MBytes/sec
[  3]  6.0- 8.0 sec  1894 MBytes   947 MBytes/sec
[  3]  8.0-10.0 sec  1893 MBytes   947 MBytes/sec
[  3]  0.0-10.0 sec  9196 MBytes   920 MBytes/sec
</code></pre><ul>
<li>通用参数<ul>
<li>-f [k|m|K|M] 分别表示以Kbits, Mbits, KBytes, MBytes显示报告，默认以Mbits为单位,eg:iperf -c 222.35.11.23 -f K</li>
<li>-i sec 以秒为单位显示报告间隔，eg:iperf -c 222.35.11.23 -i 2</li>
<li>-l 缓冲区大小，默认是8KB,eg:iperf -c 222.35.11.23 -l 16</li>
<li>-m 显示tcp最大mtu值</li>
<li>-o 将报告和错误信息输出到文件eg:iperf -c 222.35.11.23 -o c:\iperflog.txt</li>
<li>-p 指定服务器端使用的端口或客户端所连接的端口eg:iperf -s -p 9999;iperf -c 222.35.11.23 -p 9999</li>
<li>-u 使用udp协议,测试htb的时候最好用udp，udp通信开销小，测试的带宽更准确</li>
<li>-w 指定TCP窗口大小，默认是8KB.如果窗口太小，有可能丢包</li>
<li>-B 绑定一个主机地址或接口（当主机有多个地址或接口时使用该参数）</li>
<li>-C 兼容旧版本（当server端和client端版本不一样时使用）</li>
<li>-M 设定TCP数据包的最大mtu值</li>
<li>-N 设定TCP不延时</li>
<li>-V 传输ipv6数据包</li>
</ul>
</li>
<li>server专用参数<ul>
<li>-D 以服务方式运行ipserf，eg:iperf -s -D</li>
<li>-R 停止iperf服务，针对-D，eg:iperf -s -R</li>
</ul>
</li>
<li>client端专用参数<ul>
<li>-d 同时进行双向传输测试</li>
<li>-n 指定传输的字节数，eg:iperf -c 222.35.11.23 -n 100000</li>
<li>-r 单独进行双向传输测试</li>
<li>-b 指定发送带宽，默认是1Mbit/s. 在测试qos的时候，这是最有用的参数。</li>
<li>-t 测试时间，默认10秒,eg:iperf -c 222.35.11.23 -t 5.默认是10s</li>
<li>-F 指定需要传输的文件</li>
<li>-T 指定ttl值 </li>
</ul>
</li>
</ul>
<h3 id="tcpdump-tcptrace"><a href="#tcpdump-tcptrace" class="headerlink" title="tcpdump tcptrace"></a>tcpdump tcptrace</h3><ul>
<li>tcpdump -i eth0</li>
<li>tcpdump -i eth0 host 172.16.30.44 and port 80</li>
<li>tcpdump -U port 3260 -w /tmp/tcpdump.pcap</li>
</ul>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="http://www.vpsee.com/2009/11/linux-system-performance-monitoring-network/" target="_blank" rel="external">Linux性能监测：network</a></li>
<li><a href="http://blog.chinaunix.net/uid-20778443-id-94533.html" target="_blank" rel="external">iperf 使用总结</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/01/21/linux-network-performance-monitor/" data-id="cin4qo6it008v7ziz14nvjbq1" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/5/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/debug/">debug</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/kernel/">kernel</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/math/">math</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/windows/">windows</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ARP/">ARP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Auto-Compile/">Auto Compile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Batch-File/">Batch File</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Emacs/">Emacs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FAQ/">FAQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ICMP/">ICMP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IRC/">IRC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NetworkStack/">NetworkStack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Notepad/">Notepad++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Translation/">Translation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WinIO/">WinIO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/api/">api</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/arp/">arp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/auto-compile/">auto compile</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/awk/">awk</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/batch/">batch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blat/">blat</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/book/">book</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dot/">dot</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/exploit/">exploit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/flowchart/">flowchart</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gedit/">gedit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/google/">google</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/graphviz/">graphviz</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hardware-monitor/">hardware monitor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jekyll/">jekyll</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kernel/">kernel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kvm/">kvm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lisp/">lisp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mac/">mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mail/">mail</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mathematician/">mathematician</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/maxima/">maxima</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mtrace/">mtrace</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mysql/">mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/net-snmp/">net-snmp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/netbios/">netbios</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/network/">network</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/">nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/novels/">novels</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/opennebula/">opennebula</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/org-mode/">org mode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pandoc/">pandoc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/plugin/">plugin</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/raid/">raid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rsync/">rsync</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sed/">sed</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/">shell</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/skype/">skype</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/source-analyze/">source analyze</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sqlite/">sqlite</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/study/">study</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/svn/">svn</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tunnel/">tunnel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/valgrind/">valgrind</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vi/">vi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vim/">vim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wget/">wget</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wifi/">wifi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wireless-tools/">wireless-tools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wpa-supplicant/">wpa_supplicant</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xml/">xml</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ARP/" style="font-size: 10px;">ARP</a> <a href="/tags/Auto-Compile/" style="font-size: 10px;">Auto Compile</a> <a href="/tags/Batch-File/" style="font-size: 10px;">Batch File</a> <a href="/tags/C/" style="font-size: 10px;">C</a> <a href="/tags/Emacs/" style="font-size: 10px;">Emacs</a> <a href="/tags/FAQ/" style="font-size: 10px;">FAQ</a> <a href="/tags/ICMP/" style="font-size: 10px;">ICMP</a> <a href="/tags/IRC/" style="font-size: 10px;">IRC</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/NetworkStack/" style="font-size: 12.5px;">NetworkStack</a> <a href="/tags/Notepad/" style="font-size: 10px;">Notepad++</a> <a href="/tags/Translation/" style="font-size: 17.5px;">Translation</a> <a href="/tags/WinIO/" style="font-size: 10px;">WinIO</a> <a href="/tags/api/" style="font-size: 10px;">api</a> <a href="/tags/arp/" style="font-size: 10px;">arp</a> <a href="/tags/auto-compile/" style="font-size: 10px;">auto compile</a> <a href="/tags/awk/" style="font-size: 12.5px;">awk</a> <a href="/tags/batch/" style="font-size: 20px;">batch</a> <a href="/tags/blat/" style="font-size: 12.5px;">blat</a> <a href="/tags/book/" style="font-size: 10px;">book</a> <a href="/tags/dot/" style="font-size: 10px;">dot</a> <a href="/tags/exploit/" style="font-size: 10px;">exploit</a> <a href="/tags/flowchart/" style="font-size: 10px;">flowchart</a> <a href="/tags/gedit/" style="font-size: 10px;">gedit</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/github/" style="font-size: 12.5px;">github</a> <a href="/tags/google/" style="font-size: 10px;">google</a> <a href="/tags/graphviz/" style="font-size: 10px;">graphviz</a> <a href="/tags/hardware-monitor/" style="font-size: 10px;">hardware monitor</a> <a href="/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/tags/jekyll/" style="font-size: 10px;">jekyll</a> <a href="/tags/kernel/" style="font-size: 10px;">kernel</a> <a href="/tags/kvm/" style="font-size: 12.5px;">kvm</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/lisp/" style="font-size: 10px;">lisp</a> <a href="/tags/mac/" style="font-size: 10px;">mac</a> <a href="/tags/mail/" style="font-size: 10px;">mail</a> <a href="/tags/mathematician/" style="font-size: 10px;">mathematician</a> <a href="/tags/maxima/" style="font-size: 10px;">maxima</a> <a href="/tags/mtrace/" style="font-size: 10px;">mtrace</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/net-snmp/" style="font-size: 10px;">net-snmp</a> <a href="/tags/netbios/" style="font-size: 10px;">netbios</a> <a href="/tags/network/" style="font-size: 10px;">network</a> <a href="/tags/nodejs/" style="font-size: 10px;">nodejs</a> <a href="/tags/novels/" style="font-size: 10px;">novels</a> <a href="/tags/opennebula/" style="font-size: 10px;">opennebula</a> <a href="/tags/org-mode/" style="font-size: 10px;">org mode</a> <a href="/tags/pandoc/" style="font-size: 10px;">pandoc</a> <a href="/tags/plugin/" style="font-size: 10px;">plugin</a> <a href="/tags/raid/" style="font-size: 10px;">raid</a> <a href="/tags/rsync/" style="font-size: 10px;">rsync</a> <a href="/tags/sed/" style="font-size: 12.5px;">sed</a> <a href="/tags/shell/" style="font-size: 17.5px;">shell</a> <a href="/tags/skype/" style="font-size: 12.5px;">skype</a> <a href="/tags/source-analyze/" style="font-size: 10px;">source analyze</a> <a href="/tags/sqlite/" style="font-size: 10px;">sqlite</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/study/" style="font-size: 10px;">study</a> <a href="/tags/svn/" style="font-size: 17.5px;">svn</a> <a href="/tags/tunnel/" style="font-size: 10px;">tunnel</a> <a href="/tags/valgrind/" style="font-size: 12.5px;">valgrind</a> <a href="/tags/vi/" style="font-size: 10px;">vi</a> <a href="/tags/vim/" style="font-size: 17.5px;">vim</a> <a href="/tags/wget/" style="font-size: 10px;">wget</a> <a href="/tags/wifi/" style="font-size: 10px;">wifi</a> <a href="/tags/wireless-tools/" style="font-size: 10px;">wireless-tools</a> <a href="/tags/wpa-supplicant/" style="font-size: 10px;">wpa_supplicant</a> <a href="/tags/xml/" style="font-size: 10px;">xml</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">March 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">November 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">September 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">August 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">May 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/09/">September 2012</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/04/13/malloc/">malloc</a>
          </li>
        
          <li>
            <a href="/2016/03/12/performance-optimization-of-cplusplus/">performance optimization of C++</a>
          </li>
        
          <li>
            <a href="/2016/03/09/database-knowledges/">Database knowledges</a>
          </li>
        
          <li>
            <a href="/2016/03/09/check-pow-overflow/">check pow overflow</a>
          </li>
        
          <li>
            <a href="/2016/03/09/stack-trace-when-program-crash/">stack trace when program crash</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Matrix207<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>