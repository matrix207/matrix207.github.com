<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Matrix207&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Matrix207's Blog">
<meta property="og:url" content="http://matrix207.github.com/page/7/index.html">
<meta property="og:site_name" content="Matrix207's Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Matrix207's Blog">
<meta name="twitter:description">
  
    <link rel="alternate" href="/atom.xml" title="Matrix207&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Matrix207&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://matrix207.github.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-data-structures-relation-to-image" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/28/data-structures-relation-to-image/" class="article-date">
  <time datetime="2014-07-27T16:00:00.000Z" itemprop="datePublished">2014-07-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/28/data-structures-relation-to-image/">data structures relation to image</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="What-it-is"><a href="#What-it-is" class="headerlink" title="What it is"></a>What it is</h3><p><strong>ds2img</strong>.py (DataStructure To Image) </p>
<p>A python script transfer c header file which contains lots of data structures<br>to a dot script, and then use dot to convert to a image file</p>
<h3 id="How-to-run"><a href="#How-to-run" class="headerlink" title="How to run"></a>How to run</h3><pre><code>Usage: ds2imgpy -i INPUT_FILE -f png|svg -o OUTPUT_FILE [-d DOT_FILE]

-i  input file which have structures&quot;
-f  image fomat, only support png and svg&quot;
-o  output file, image file&quot;
-d  dot script file, default is tmp.dot&quot;

e.g:

python ds2img.py -i t.h -f png -o t.png 
</code></pre><h3 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h3><p>Waiting for your advices</p>
<h3 id="Warning"><a href="#Warning" class="headerlink" title="Warning"></a>Warning</h3><ol>
<li>Not support structure contain other structure!</li>
<li>Not support multi-lines comment</li>
</ol>
<h3 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h3><p>You can get the latest version from:<br><a href="https://github.com/matrix207/scripts/blob/master/ds2img/ds2img.py" target="_blank" rel="external">https://github.com/matrix207/scripts/blob/master/ds2img/ds2img.py</a></p>
<pre><code>#!/usr/bin/python
#####################################################################
# Generate dot script file from c file, which have lots of structures
#
# You can get the latest version from: 
# https://github.com/matrix207/scripts/blob/master/ds2img/ds2img.py
#
# Warning: Not support structure contain other structure!
# 
# Depends:
#     1. python
#     2. graphviz
#
# History:
#    v1.0  2014-07-28  Dennis  implement generate_relation function
#                              add parse option funtion
#    v0.1  2014-07-27  Dennis  Create
#####################################################################

import os
import re
import sys
import getopt
import datetime

version = &quot;v1.0 Create by Dennis 2014-07-28&quot;
debug = 0

def is_comment(line):
    if &apos;\\&apos; in line:
        return true
    print true

# process each line
def process(line):
    print line,

def get_struct_name(line):
    print line,

def get_datetime():
    today = datetime.datetime.now()
    print today.strftime(&apos;%Y-%m-%d %H:%M:%S&apos;)

def generate_dot_header(output_file):
    if debug : 
        print &quot;generating dot header&quot;
    f=open(output_file,&apos;a+&apos;)
    print&gt;&gt;f, &quot;/**********************************************&quot;
    print&gt;&gt;f, &quot;* Auto generate by ds2img.py&quot;
    print&gt;&gt;f, &quot;* Author:  matrix207&quot;
    print&gt;&gt;f, &quot;* Date  :  %s&quot; % datetime.datetime.now().strftime(&apos;%Y-%m-%d %H:%M:%S&apos;)
    print&gt;&gt;f, &quot;**********************************************/\n&quot;
    print&gt;&gt;f, &quot;digraph DS2IMG {&quot;
    print&gt;&gt;f, &quot;    node [shape=record fontsize=12 fontname=Courier style=filled];&quot;
    print&gt;&gt;f, &quot;    edge[color=blue]; rankdir=LR;&quot;
    print&gt;&gt;f, &quot;&quot;
    f.close()

def generate_dot_end(output_file):
    if debug : 
        print &quot;generating dot end&quot;
    f=open(output_file,&apos;a+&apos;)
    print&gt;&gt;f, &quot;}&quot;
    f.close()

def generate_struct_header(output_file, struct_name):
    if debug : 
        print &quot;generating struct header&quot;
    f=open(output_file,&apos;a+&apos;)
    print&gt;&gt;f, &quot;subgraph cluster_%s {&quot; % struct_name
    print&gt;&gt;f, &quot;    node [shape=record fontsize=12 fontname=Courier style=filled];&quot;
    print&gt;&gt;f, &quot;    color = lightgray; style=filled; label = \&quot;struct %s \&quot;; edge[color=\&quot;#2e3436\&quot;];&quot; % struct_name
    print&gt;&gt;f, &quot;    node_%s [shape=record label=\&quot;&lt;f0&gt;*** struct %s ***\\&quot; % (struct_name, struct_name)
    f.close()

def generate_struct_member(output_file, index, member_name):
    if debug : 
        print &quot;generating struct member&quot;
    f=open(output_file,&apos;a+&apos;)
    print&gt;&gt;f, &quot;|&lt;f%d&gt;%s\\n\\&quot; % (index, member_name)
    f.close()

def generate_struct_end(output_file):
    if debug : 
        print &quot;generating struct end&quot;
    f=open(output_file,&apos;a+&apos;)
    print&gt;&gt;f, &quot;\&quot;];&quot;
    print&gt;&gt;f, &quot;}&quot;
    print&gt;&gt;f, &quot;&quot;
    f.close()

def generate_relation(output_file, structs_name, structs):
    if debug : 
        print &quot;generating relation&quot;
    f=open(output_file,&apos;a+&apos;)
    print&gt;&gt;f, &quot;#relation &quot;
    # structs_name contain all structure name 
    # structs      contain all structures, include structure name and it&apos;s member name
    for a in structs_name:           # structs_name[a] is structure name
        for b in structs:            # b is structure name 
            for c in structs[b]:     # c is member index, structs[b][c] is member name
                # only match structure name
                tmp = structs[b][c].split(&apos; &apos;)
                #if structs_name[a] in structs[b][c]:
                if tmp[1]==structs_name[a]:
                    #print &quot;%s contain %s\n&quot; % (b,structs_name[a])
                    #print &quot;%s:&lt;f%d&gt; -&gt; %s:f0\n&quot; % (b,c,structs_name[a])
                    print&gt;&gt;f, &quot;node_%s:&lt;f%d&gt; -&gt; node_%s:f0;&quot; % (b,c,structs_name[a])
    print&gt;&gt;f, &quot;&quot;
    f.close()

def clean_multi_space(line):
    line = re.sub(r&apos; +&apos;, &apos; &apos;, line)
    return line

def clean_array_size(line):
    line = re.sub(r&apos;\[.+\]&apos;, &apos;[]&apos;, line)
    return line

def clean_specify_dirty(line):
    line = re.sub(r&apos;\[.+&lt;&lt;.+\]&apos;, &apos;[]&apos;, line)
    return line

# handle line which has comment information
def handle_comment(line):
    pos = line.find(&quot;/*&quot;)
    if pos &gt; 0:
        line = re.sub(r&apos;/\*.+\*/&apos;, &apos;&apos;, line)
        line = line.strip()
    return line

def struct2dot(input_file, output_file):
    generate_dot_header(output_file)
    reader = open(input_file, &apos;r&apos;)
    i = 1
    structs = {}
    structs_name = {}
    while True: 
        line = reader.readline()
        if not line: 
            break
        # skip the comment line
        pos = line.find(&quot;/&quot;)
        if pos == 0:
            continue
        if pos &gt; 0:
            handle_comment(line)
        m = re.match(&apos;^struct (\w+) {$&apos;,line)
        if m: # Find structure start
            structs_name[i] = m.group(1)
            st_name = m.group(1)
            i += 1
            generate_struct_header(output_file, m.group(1))
            structs[m.group(1)] = {}
            j = 1
            while True:
                line = reader.readline()
                if not line: 
                    break
                line = line.strip();
                if len(line) == 0:
                    continue
                # skip the comment line
                pos = line.find(&quot;/&quot;)
                if pos == 0:
                    continue
                if pos &gt; 0:
                    line = handle_comment(line)
                line = clean_specify_dirty(line)
                line = clean_multi_space(line)
                m = re.match(&apos;^};$&apos;,line)
                if m: # Find structure end
                    generate_struct_end(output_file)
                    break
                structs[st_name][j] = line
                generate_struct_member(output_file, j, line)
                j += 1
    reader.close()
    generate_relation(output_file, structs_name, structs)
    generate_dot_end(output_file)

def dot2png(input_file, output_file):
    cmdline = &quot;dot -Tpng &quot; + input_file + &quot; -o &quot; + output_file
    if debug:
        print cmdline
    os.system(cmdline)

def clean_file(input_file):
    cmdline = &quot;&gt; &quot; + input_file
    os.system(cmdline)

# Test Function
def test(input_file, output_file):
    #find_comment(sys.argv[1])
    generate_dot_header(output_file)
    generate_struct_header(output_file, &quot;func_test&quot;)
    generate_struct_member(output_file, 1, &quot;int test_a_13;&quot;)
    generate_struct_member(output_file, 2, &quot;int test_a_13;&quot;)
    generate_struct_member(output_file, 3, &quot;int test_a_13;&quot;)
    generate_struct_end(output_file)
    generate_dot_end(output_file)

def find_comment(input_file):
    reader = open(input_file, &apos;r&apos;)
    while True:
        line = reader.readline()
        if len(line) == 0:
            break
        pos = line.find(&quot;/*&quot;)
        if pos&gt;=0:
            print line,
    reader.close()

def usage(bin_file):
    print &quot;Usage: %s -i INPUT_FILE -f png|svg -o OUTPUT_FILE [-d DOT_FILE]&quot; % bin_file
    print &quot;      -i  input file which have structures&quot;
    print &quot;      -f  image fomat, only support png and svg&quot;
    print &quot;      -o  output file, image file&quot;
    print &quot;      -d  dot script file, default is tmp.dot&quot;
    print &quot;  e.g:\n\tpython %s -i t.h -f png -o t.png&quot; % bin_file
    sys.exit(1)

if __name__ == &apos;__main__&apos;:
    paramlen = len(sys.argv)

    config = {  
        &quot;input&quot;:&quot;&quot;,  
        &quot;format&quot;:&quot;&quot;,  
        &quot;output&quot;:&quot;&quot;,  
        &quot;dotfile&quot;:&quot;tmp.dot&quot;,  
    }      
    opts, args = getopt.getopt(sys.argv[1:], &apos;hi:f:o:d:&apos;,
        [  
        &apos;input=&apos;,
        &apos;format=&apos;,
        &apos;output=&apos;,
        &apos;dotfile=&apos;,
        &apos;help&apos;  
        ]  
    )    

    for option, value in opts:  
        if  option in [&quot;-h&quot;,&quot;--help&quot;]:  
            usage(sys.argv[0])
        elif option in [&apos;--input&apos;, &apos;-i&apos;]:  
            config[&quot;input&quot;] = value  
        elif option in [&apos;--output&apos;, &apos;-o&apos;]:  
            config[&quot;output&quot;] = value  
        elif option in [&apos;--format&apos;, &apos;-f&apos;]:  
            config[&quot;format&quot;] = value  
        elif option in [&apos;--dotfile&apos;, &apos;-d&apos;]:  
            config[&quot;dotfile&quot;] = value  
        else:
            usage(sys.argv[0])

    if config[&quot;input&quot;] == &quot;&quot; or config[&quot;output&quot;]==&quot;&quot; or config[&quot;format&quot;]==&quot;&quot; :
        usage(sys.argv[0])


    clean_file(config[&quot;dotfile&quot;])

    struct2dot(config[&quot;input&quot;], config[&quot;dotfile&quot;])

    # generate graphic
    filename = os.path.basename(sys.argv[1]) 
    png_file = filename + &quot;.png&quot;
    dot2png(config[&quot;dotfile&quot;], config[&quot;output&quot;])

    print &quot;Done&quot;
</code></pre><h3 id="example"><a href="#example" class="headerlink" title="example"></a>example</h3><p>transfer iscsitarget-1.4.20/kernel/iscsi.h </p>
<pre><code>[dennis@localhost kernel]$ pwd
/home/dennis/work/git/iet/src/iscsitarget-1.4.20/kernel
[dennis@localhost kernel]$ ds2img.py -i iscsi.h -f png -o iscsi.png
Done
[dennis@localhost kernel]$ ds2img.py -i iscsi.h -f svg -o iscsi.svg
Done
</code></pre><p><img src="/assets/image/posts/iscsi_kernel_structs.png" alt=""></p>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="http://emacser.com/emacs_graphviz_ds.htm" target="_blank" rel="external">★★★使用graphviz画数据结构</a></li>
<li><a href="http://www.graphviz.org/content/datastruct" target="_blank" rel="external">graphviz for Data Structures</a></li>
<li><a href="http://gashero.iteye.com/blog/1748795" target="_blank" rel="external">使用graphviz dot来画图表</a></li>
<li><a href="http://www.cnblogs.com/huxi/archive/2010/07/04/1771073.html" target="_blank" rel="external">Python正则表达式指南</a></li>
<li><a href="http://blog.csdn.net/wangyezi19930928/article/details/25652295" target="_blank" rel="external">★★python文件操作字符串操作总结</a></li>
<li><a href="http://zhidao.baidu.com/link?url=lwqlXGEAznkWAc26v929RcbA-TuG_McqeQ2BgRWWXaiNS2KQPfU4LR-QdmJkn3eWb5Bfn6qA_7wAboaFThjUkSznQi432soyDnXbd3vPxWO" target="_blank" rel="external">用python如何匹配注释</a></li>
<li><a href="http://blog.csdn.net/xmnathan/article/details/4192821" target="_blank" rel="external">Python文件去除注释</a></li>
<li><a href="http://5iqiong.blog.51cto.com/2999926/806230" target="_blank" rel="external">★★★遍历python字典几种方法</a></li>
<li><a href="http://www.cnblogs.com/skyhacker/archive/2012/01/27/2330177.html" target="_blank" rel="external">python循环遍历字典元素</a></li>
<li><a href="http://blog.csdn.net/nrs12345/article/details/4869272" target="_blank" rel="external">Python的字典操作</a></li>
<li><a href="http://blog.csdn.net/feixin620/article/details/4209783" target="_blank" rel="external">★★★python解析ini文件</a></li>
<li><a href="http://blog.csdn.net/xiaocaiju/article/details/7590106" target="_blank" rel="external">python_getopt解析命令行输入参数的使用</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://matrix207.github.com/2014/07/28/data-structures-relation-to-image/" data-id="cin61d0ka008gfyiz7p5nyt0h" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-jni-on-linux" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/18/jni-on-linux/" class="article-date">
  <time datetime="2014-07-17T16:00:00.000Z" itemprop="datePublished">2014-07-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/18/jni-on-linux/">jni on linux</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="1-create-Message-java-define-native-function-and-load-library"><a href="#1-create-Message-java-define-native-function-and-load-library" class="headerlink" title="1. create Message.java, define native function and load library"></a>1. create Message.java, define native function and load library</h4><pre><code>[dennis@localhost jni]$ cat Message.java
class Message
{ 
    public native int writeMessage(int type, char page_num, String content); 
    public native int getCPUTemperature(); 
    public native int getHDDTemperature(); 

    static 
    { 
        System.loadLibrary(&quot;Message&quot;); 
    }  
}
</code></pre><h4 id="2-run-‘javac-Message-java’-to-generate-Message-class"><a href="#2-run-‘javac-Message-java’-to-generate-Message-class" class="headerlink" title="2. run ‘javac Message.java’ to generate Message.class"></a>2. run ‘javac Message.java’ to generate Message.class</h4><pre><code>[dennis@localhost jni]$ javac Message.java 
</code></pre><h4 id="3-run-‘javah-Message’-to-generate-Message-h"><a href="#3-run-‘javah-Message’-to-generate-Message-h" class="headerlink" title="3. run ‘javah Message’ to generate Message.h"></a>3. run ‘javah Message’ to generate Message.h</h4><pre><code>[dennis@localhost jni]$ javah Message
[dennis@localhost jni]$ cat Message.h
/* DO NOT EDIT THIS FILE - it is machine generated */
#include &lt;jni.h&gt;
/* Header for class Message */

#ifndef _Included_Message
#define _Included_Message
#ifdef __cplusplus
extern &quot;C&quot; {
#endif
/*
 * Class:     Message
 * Method:    writeMessage
 * Signature: (ICLjava/lang/String;)I
 */
JNIEXPORT jint JNICALL Java_Message_writeMessage
  (JNIEnv *, jobject, jint, jchar, jstring);

/*
 * Class:     Message
 * Method:    getCPUTemperature
 * Signature: ()I
 */
JNIEXPORT jint JNICALL Java_Message_getCPUTemperature
  (JNIEnv *, jobject);

/*
 * Class:     Message
 * Method:    getHDDTemperature
 * Signature: ()I
 */
JNIEXPORT jint JNICALL Java_Message_getHDDTemperature
  (JNIEnv *, jobject);

#ifdef __cplusplus
}
#endif
#endif
</code></pre><h4 id="4-create-Message-c-and-implement-function"><a href="#4-create-Message-c-and-implement-function" class="headerlink" title="4. create Message.c, and implement function"></a>4. create Message.c, and implement function</h4><pre><code>[dennis@localhost jni]$ cat Message.c
#include &lt;jni.h&gt;
#include &lt;stdio.h&gt;
#include &quot;Message.h&quot;

int iCpu;
int iHdd;
int iMainboard;
int iFan;

void ReadTemperatureIni()
{
    iCpu = 37;
    iHdd = 28;
    iMainboard = 30;
    iFan = 3200;
    printf(&quot;call %s %s %d\n&quot;, __FILE__, __func__, __LINE__);
}

void send_msg(const short code, const char page, const char *content) 
{
    printf(&quot;code=%d, page=%d, content=%s\n&quot;, code, page, content);
    printf(&quot;call %s %s %d\n&quot;, __FILE__, __func__, __LINE__);
}

JNIEXPORT jint JNICALL Java_Message_getCPUTemperature(JNIEnv *env, jobject obj)
{
    ReadTemperatureIni();
    return iCpu;
}

JNIEXPORT jint JNICALL Java_Message_getHDDTemperature(JNIEnv *env, jobject obj)
{
    ReadTemperatureIni();
    return iHdd;
}

JNIEXPORT jint JNICALL Java_Message_getMainboardTemperature (JNIEnv *env, jobject obj)
{
    ReadTemperatureIni();
    return iMainboard;    
}

JNIEXPORT jint JNICALL Java_Message_getCPUFanSpeed (JNIEnv *env, jobject obj)
{
    ReadTemperatureIni();
    return iFan;
}


JNIEXPORT jint JNICALL Java_Message_writeMessage 
(JNIEnv *env, jobject obj, jint type, jchar page_num, jstring content)
{
    /* c   code use: (*env)-&gt; */
    /* c++ code use: env-&gt;    */
    const jbyte *str = (const jbyte *)(*env)-&gt;GetStringUTFChars(env,content,JNI_FALSE);
    send_msg(type, page_num, (const char*)str);
    (*env)-&gt;ReleaseStringUTFChars(env,content,(const char *)str);

    return 0;
}
</code></pre><h4 id="5-start-to-compile-file-to-dynamic-library-then-copy-the-so-file-to-usr-lib64"><a href="#5-start-to-compile-file-to-dynamic-library-then-copy-the-so-file-to-usr-lib64" class="headerlink" title="5. start to compile file to dynamic library, then copy the *.so file to /usr/lib64/"></a>5. start to compile file to dynamic library, then copy the *.so file to /usr/lib64/</h4><pre><code>[dennis@localhost jni]$ cat Makefile 
CC = gcc 
CFLAGS = -Wall -shared -fPIC
# change the directory for YOUR OS
JAVA_INC = -I/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.60-2.5.0.1.fc20.x86_64/include/  \
           -I/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.60-2.5.0.1.fc20.x86_64/include/linux 
TARGET = libMessage.so

all:$(TARGET)

libMessage.so: Message.c
    $(CC) $(CFLAGS) $(JAVA_INC) -o $@ $^

.PHONY:clean
clean:
    rm -f *.class $(TARGET)
[dennis@localhost jni]$ make
gcc  -Wall -shared -fPIC -I/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.60-2.5.0.1.fc20.x86_64/include/ -I/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.60-2.5.0.1.fc20.x86_64/include/linux  -o libMessage.so Message.c
[dennis@localhost jni]$ su -c &apos;cp libMessage.so /usr/lib64&apos;
</code></pre><h4 id="6-create-Test-java-a-sample-code-to-test-interface-function"><a href="#6-create-Test-java-a-sample-code-to-test-interface-function" class="headerlink" title="6. create Test.java, a sample code to test interface function"></a>6. create Test.java, a sample code to test interface function</h4><pre><code>[dennis@localhost jni]$ cat Test.java 
public class Test
{
     public static void main(String argv[])
     {
         new Test();
     }

     public Test()
     {
         char type = 0x1F;
         char page = 1;
         String content = &quot;Test Message&quot;;
         int ret = new Message().writeMessage(type, page, content); 

         int cpu=new Message().getCPUTemperature();
         System.out.println(cpu);     

         int hdd=new Message().getHDDTemperature();
         System.out.println(hdd);
     }
}
</code></pre><h4 id="7-run-‘javac-Test-java’"><a href="#7-run-‘javac-Test-java’" class="headerlink" title="7. run ‘javac Test.java’"></a>7. run ‘javac Test.java’</h4><pre><code>[dennis@localhost jni]$ javac Test.java    
</code></pre><h4 id="8-run-‘java-Test’"><a href="#8-run-‘java-Test’" class="headerlink" title="8. run ‘java Test’"></a>8. run ‘java Test’</h4><pre><code>[dennis@localhost jni]$ java Test 
code=31, page=1, content=Test Message
call Message.c send_msg 22
call Message.c ReadTemperatureIni 16
37
call Message.c ReadTemperatureIni 16
28
</code></pre><h4 id="A-full-version-Makefile-support-compile-java-code"><a href="#A-full-version-Makefile-support-compile-java-code" class="headerlink" title="A full version Makefile, support compile java code"></a>A full version Makefile, support compile java code</h4><pre><code>#################################################################
# Makefile 
# For JNI project on Fedora x86_64 release 20
# Create by Dennis
# 2014-07-18
#
# HOW TO MAKE A JNI PROJECT
# 1. create Message.java, define native function and load library
# 2. run &apos;javac Message.java&apos; to generate Message.class
# 3. run &apos;javah Message&apos; to generate Message.h
# 4. create Message.c, and implement function
# 5. start to compile file to dynamic library, then copy the *.so 
#    file to /usr/lib64/
# 6. create Test.java, a sample code to test interface function
# 7. run &apos;javac Test.java&apos; to generate Test.class
# 7. run &apos;java Test&apos; 
#################################################################
CC = gcc 
JAVAC = javac
CFLAGS = -Wall -shared -fPIC
# change the directory for YOUR OS
JAVA_INC = -I/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.60-2.5.0.1.fc20.x86_64/include/  \
           -I/usr/lib/jvm/java-1.7.0-openjdk-1.7.0.60-2.5.0.1.fc20.x86_64/include/linux 
TARGET = libMessage.so Test.class

all:$(TARGET)

libMessage.so: Message.c
    $(CC) $(CFLAGS) $(JAVA_INC) -o $@ $^

Test.class: 
    $(JAVAC) Test.java    

.PHONY:clean
clean:
    rm -f *.class $(TARGET)
</code></pre><h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><ul>
<li><a href="http://www.cnblogs.com/bastard/archive/2012/05/17/2506877.html" target="_blank" rel="external">Linux下 JNI的使用</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://matrix207.github.com/2014/07/18/jni-on-linux/" data-id="cin61d0k7008efyiz2tghgl6n" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-storage-technology" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/18/storage-technology/" class="article-date">
  <time datetime="2014-07-17T16:00:00.000Z" itemprop="datePublished">2014-07-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/18/storage-technology/">storage technology</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>###<a href="http://blog.csdn.net/liuaigui/article/details/5333752" target="_blank" rel="external">从研发角度谈存储技术的学习</a></p>
<p>对于研发人员，存储技术的学习内容非常之多。我根据自己的理解，把它们大致分为以下8项内容：</p>
<ol>
<li>系统管理：UNIX/Linux/Windows操作系统管理，要求熟悉甚至精通。</li>
<li>开发技术：C/C++，网络编程，多进程/多线程，进程间通信。如果能掌握内核开发、驱<br>动程序开发则更佳。</li>
<li>存储基础：磁盘、RAID阵列、文件系统等存储相关硬件和软件的安装、配置、调试。</li>
<li>存储系统：RAID, DAS, SAN, NAS, CAS等，对存储系统的原理以及实现技术熟悉。</li>
<li>存储协议：TCP/IP, SCSI, iSCSI, NFS/CIFS等, 熟悉这些存储相关协议。</li>
<li>文件系统：VFS, EXTx/NTFS/FAT32等磁盘文件系统, NFS/CIFS网络文件系统, Lustre/GFS/AFS<br>等分布式文件系统，掌握原理和实现技术，能够阅读源码则更好。</li>
<li>存储技术：Deduplication, SSD, HSM, Virtualization, Snapshot, Replication, CDP<br>, VTL, Thin Provision等等，尽量多跟踪最新存储技术进展，多多益善。</li>
<li>存储架构：掌握不同行业的存储需求，能够根据实际需求提出存储解决方案，并进行存<br>储系统架构、设计和实现。</li>
</ol>
<p>存储研发人员成长大致可分为四个级别：</p>
<ol>
<li>存储初级研发：掌握1、2、3项存储内容，在中高级存储研发指导下，可以进行存储研发工作。</li>
<li>存储中级研发：掌握4、5项存储内容，可以带领团队进行研发工作，并指导初级研发。</li>
<li>存储高级研发：掌握6、7项存储内容，可以进行存储新技术的研究，对现有存储系统优<br>化改进，原型系统开发。</li>
<li>存储研发专家：掌握8项存储内容，存储前沿技术研究，存储系统规划与架构，对存储发<br>展趋势有着很好的理解和洞察。</li>
</ol>
<p>10000小时法则 (The 10,OOO Hour Rule)，简单地说，任何人要在任何领域出类拔萃，脱颖<br>而出，都需要认真投入10000小时以上。10000小时是一个突破的临界点。以每天10个小时算<br>，10000小时相当于三年。也就是说，要做成功一件事情，你就要每天10小时投入，持续3年<br>。如果每天只有5小时，那么需要6年。如果每天3小时，则需要10年。因此，如果想成为存<br>储领域的专家，没有什么捷径可走，只有坚持学习、实践、思考。3年、5年、8年、10年后<br>，只要你仍在追求既定目标，定会有所成就。</p>
<p>“厚积而薄发”，与所有存储同行共勉！</p>
<p>###<a href="http://blog.csdn.net/liuaigui/article/details/5368300" target="_blank" rel="external">存储学习之路</a></p>
<ul>
<li>0、存储入门</li>
</ul>
<p>　领路人的作用很大，这个人可能是你做研究生的导师，或者工作中的tutor，或者是朋友、<br>同事。指点迷津，学习和研究过程中将少走很多弯路，经验的价值这在这里体现。如果你是<br>存储初学者，赶快去寻找你的领路人。当然自学成才的例子举不胜举，还是靠自己来做权衡。</p>
<ul>
<li>1、存储图书</li>
</ul>
<p>　学习存储的基础理论最直接的方法就是读书。相对于计算与网络技术，存储技术发展是相<br>对落后的，因此图书方面也要少很多，国内的更少，而且大多是翻译或改编的。我读过的国<br>内存储图书有：</p>
<ul>
<li>网络存储技术    清华大学出版社</li>
<li>网络存储技术导论    清华大学出版社</li>
<li>SAN存储区域网络    机械工业出版社</li>
<li>数据存储备份与灾难恢复    电子工业出版社</li>
<li>基于对象的网络存储    电子工业出版社</li>
<li>IPSAN权威指南    中国电力出版社</li>
<li>成就存储专家之路    清华大学出版社</li>
<li>信息存储与管理    人民邮电出版社</li>
<li>大话存储    清华大学出版社    </li>
<li>数据重现    清华大学出版社</li>
</ul>
<ul>
<li>2、存储资源</li>
</ul>
<p>　网络资源也是学习存储的重要资源，而且能够很好地跟踪存储的最近发展动态。我常访问的URL有：</p>
<ul>
<li>InfoStor: <a href="http://www.infostor.com" target="_blank" rel="external">http://www.infostor.com</a>  </li>
<li>SINA: <a href="http://www.snia.org/home" target="_blank" rel="external">http://www.snia.org/home</a>  </li>
<li>Gartner: <a href="http://www.gartner.com/technology/home.jsp" target="_blank" rel="external">http://www.gartner.com/technology/home.jsp</a>  </li>
<li>SanSky: <a href="http://www.sansky.net/" target="_blank" rel="external">http://www.sansky.net/</a>  </li>
<li>DoStor: <a href="http://www.dostor.com/" target="_blank" rel="external">http://www.dostor.com/</a>  </li>
<li>WatchStor: <a href="http://www.watchstor.com/" target="_blank" rel="external">http://www.watchstor.com/</a>  </li>
</ul>
<p>另外还有一些国际上存储会议，比如：</p>
<ul>
<li>SDC，Storage Developer Conference　(2009,<a href="http://www.snia.org/events/storage-developer2009/presentations" target="_blank" rel="external">http://www.snia.org/events/storage-developer2009/presentations</a>)</li>
<li>FAST, File and Storage Technologies (<a href="http://www.usenix.org/events/fast/" target="_blank" rel="external">http://www.usenix.org/events/fast/</a>)</li>
</ul>
<ul>
<li><p>3、存储实践</p>
<p>大学中我们最缺是估计就是实践。实践可以帮助我们更深刻地理解和掌握理论，并且获得<br>将理论进行实现和应用的能力。实践有很多方式，比如自己动手进行存储软硬件的调试、存<br>储系统集优化改进、开发一些软件、阅读存储软件源码等等。实践这个东西，多多益善，尽<br>量找机会多做。源代码除了Linux kernel外，www.sourceforge.net是最好的去处，可以读<br>VFS、EXT2/3/4、Soft RAID、LVM、FDISK、NFS/CIFS、SCSI/iSCSI、FUSE、AFS、LUSTRE等等。</p>
</li>
<li><p>4、存储交流</p>
</li>
</ul>
<p>　牛人大多都是喜欢与人分享的，你也不要担心分享自己的东西，别人就超越你了。能把自<br>己的东西说得让别人明白，实际上对自己也是一个提升。物以类聚，人以群分。现在网络不<br>要太方便，找一群兴趣相投的人，多多交流，大家共同进步就何等的好事。而且同时可以建<br>立人脉，说不定哪天志同道合的人，就一起做共事或创业了。</p>
<ul>
<li>5、存储思考</li>
</ul>
<p>　学而不思则罔，思而不学则贻。当已经掌握了一些存储理论和实践后，我们可能会遇到发<br>展的瓶颈，需要选择一两个方向进行深入学习和研究。这样我们才能有精力去分析和思考理<br>论和技术上优点与不足，继而不断实践和思考。从而就有可能达到一个更高的层次，并且可<br>能会发现一些机会。</p>
<ul>
<li>6、存储经验</li>
</ul>
<p>　我们常常看到招聘信息上要求8－10年的相关工作经验。不管是失败还是成功的经验，对<br>未来的工作都很有意义，尤其是失败的经验，将大大提成功的几率。对搞存储的来说，最好<br>能找机会进入存储行业的公司或研究机构工作，这对经验的提升非常重要。因为这是正规军<br>，是适应市场用户需求的，而自己的学习和研究，都是出自自身需求的。如果你在公司工作<br>，或者自己创业，用户需求是做产品的根本出发点，这个意识要尽早培养。</p>
<ul>
<li>7、存储趋势</li>
</ul>
<p>　熟悉历史，把握现在，预测未来。一旦我们对存储技术的过去和现在都非常熟悉和深入理<br>解，那么我们就有可能正确地对存储的未来趋势进行分析和预测，掌握先机和商机。这种人<br>是大牛，或许我们很难达到这个层次，但至少大牛提出很多新的观点和概念时，我们能很快<br>理解和认同。</p>
<ul>
<li>8、存储创新</li>
</ul>
<p>　创新是需要前提条件的，如果没有前面的学习、实践、思考，存储创新根本无从谈起。创<br>新可能是理论创新和技术创新，主要出发点就是要解决和改进目前理论或技术上存在的缺陷<br>与不足，这自然就要求我们对现有的东西非常熟悉。达到可以深入思考和寻求创新的层次，<br>我想大概规律性的东西就很少了。成功有时是需要点运气，但前期的功课是要做好的，成功<br>还是眷顾有充分准备的人的。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://matrix207.github.com/2014/07/18/storage-technology/" data-id="cin61d0kh008lfyizhmxkssf3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ipmi" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/07/09/ipmi/" class="article-date">
  <time datetime="2014-07-08T16:00:00.000Z" itemprop="datePublished">2014-07-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/07/09/ipmi/">ipmi</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Introduce"><a href="#Introduce" class="headerlink" title="Introduce"></a>Introduce</h3><p>The <strong>Intelligent Platform Management Interface (IPMI)</strong> is a standardized computer<br>system interface used by system administrators for out-of-band management of<br>computer systems and monitoring of their operation. It is a way to manage a<br>computer that may be powered off or otherwise unresponsive by using a network<br>connection to the hardware rather than to an operating system or login shell.</p>
<p><img src="http://upload.wikimedia.org/wikipedia/commons/f/f2/IPMI-Block-Diagram.png" alt=""></p>
<h3 id="Why-use"><a href="#Why-use" class="headerlink" title="Why use"></a>Why use</h3><p>Use lm-sensor? </p>
<pre><code>[root@localhost ~]# sensors
acpitz-virtual-0
Adapter: Virtual device
temp1:       +27.8°C  (crit = +106.0°C)                  
temp2:       +29.8°C  (crit = +106.0°C)                  

coretemp-isa-0000
Adapter: ISA adapter
Physical id 0: +35.0°C  (high = +85.0°C, crit = +105.0°C)  
Core 0:        +32.0°C  (high = +85.0°C, crit = +105.0°C)  
Core 1:        +31.0°C  (high = +85.0°C, crit = +105.0°C)  
</code></pre><p>Use dmidecode?</p>
<h3 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h3><p>On Centos 6.5</p>
<pre><code>[root@localhost ~]# yum install OpenIPMI -y
[root@localhost ~]# yum install ipmitool -y
[root@localhost ~]# chkconfig ipmi on
[root@localhost ~]# service ipmi start
Starting ipmi drivers:                                     [  OK  ]
[root@localhost ~]# ls -l /dev/ipmi*
crw-rw----. 1 root root 245, 0 Feb  5 14:18 /dev/ipmi0
[root@localhost ~]# lsmod | grep ipmi
ipmi_devintf            7729  0 
[root@localhost ~]# modinfo ipmi_devintf
filename:       /lib/modules/2.6.32-431.el6.x86_64/kernel/drivers/char/ipmi/ipmi_devintf.ko
alias:          platform:ipmi_si
description:    Linux device interface for the IPMI message handler.
author:         Corey Minyard &lt;minyard@mvista.com&gt;
license:        GPL
srcversion:     592518D3E7F47DFC4EBEC9F
depends:        
vermagic:       2.6.32-431.el6.x86_64 SMP mod_unload modversions 
parm:           ipmi_major:Sets the major number of the IPMI device.  By default, or if you set it to zero, it will choose the next available device.  Setting it to -1 will disable the interface.  Other values will set the major device number to that value. (int)
[root@localhost ~]#
</code></pre><h3 id="Use"><a href="#Use" class="headerlink" title="Use"></a>Use</h3><ol>
<li><p><strong>To check firmware version</strong></p>
<pre><code>[root@localhost ~]# ipmitool mc info
Device ID                 : 20
Device Revision           : 1
Firmware Revision         : 0.8
IPMI Version              : 2.0
Manufacturer ID           : 9091
Manufacturer Name         : Unknown (0x2383)
Product ID                : 289 (0x0121)
Product Name              : Unknown (0x121)
Device Available          : yes
Provides Device SDRs      : no
Additional Device Support :
    Sensor Device
    SDR Repository Device
    SEL Device
    FRU Inventory Device
    IPMB Event Receiver
    Chassis Device
Aux Firmware Rev Info     : 
    0x00
    0x37
    0x00
    0x00
</code></pre></li>
<li><p><strong>Show sensor output</strong></p>
<pre><code>[root@localhost ~]# ipmitool sdr list
CPU0_TEMP        | 25 degrees C      | ok
VCORE_CPU0       | 0.83 Volts        | ok
+1.5V_DDR3       | 1.52 Volts        | ok
PCH              | 1.04 Volts        | ok
+3.3V            | 3.42 Volts        | ok
+5V              | 5.14 Volts        | ok
+5VSB            | 5.07 Volts        | ok
VBAT             | 3.34 Volts        | ok
+12V_MONITOR     | 12.40 Volts       | ok
THERMAL01        | 35 degrees C      | ok
THERMAL02        | 31 degrees C      | ok
CPU_FAN1         | 5900 RPM          | ok
SYS_FAN1         | 0 RPM             | nr
SYS_FAN2         | 0 RPM             | nr
SYS_FAN3         | 0 RPM             | nr
Watchdog         | Not Readable      | ns
[root@localhost ~]# ipmitool sdr type list
Sensor Types:
    Temperature                 Voltage                  
    Current                     Fan                      
    Physical Security           Platform Security        
    Processor                   Power Supply             
    Power Unit                  Cooling Device           
    Other                       Memory                   
    Drive Slot / Bay            POST Memory Resize       
    System Firmwares            Event Logging Disabled   
    Watchdog                    System Event             
    Critical Interrupt          Button                   
    Module / Board              Microcontroller          
    Add-in Card                 Chassis                  
    Chip Set                    Other FRU                
    Cable / Interconnect        Terminator               
    System Boot Initiated       Boot Error               
    OS Boot                     OS Critical Stop         
    Slot / Connector            System ACPI Power State  
    Watchdog                    Platform Alert           
    Entity Presence             Monitor ASIC             
    LAN                         Management Subsystem Health
    Battery                     Session Audit            
    Version Change              FRU State                
[root@localhost ~]# ipmitool sdr type Fan
CPU_FAN1         | 31h | ok  |  7.1 | 5900 RPM
SYS_FAN1         | 32h | lnr |  7.2 | 0 RPM
SYS_FAN2         | 33h | lnr |  7.5 | 0 RPM
SYS_FAN3         | 34h | lnr |  7.6 | 0 RPM
[root@localhost ~]# ipmitool sdr type Temperature
CPU0_TEMP        | 21h | ok  |  7.1 | 25 degrees C
THERMAL01        | 23h | ok  |  7.1 | 35 degrees C
THERMAL02        | 24h | ok  |  7.1 | 31 degrees C
</code></pre></li>
<li><p><strong>Display/reset password for default root user (userid ‘2’)</strong></p>
<pre><code>ipmitool user list 1
ipmitool user set password 2 &lt;new_password&gt;
</code></pre></li>
</ol>
<p><strong>Display/configure lan settings</strong></p>
<pre><code>ipmitool lan print 1
ipmitool lan set 1 ipsrc [ static | dhcp ]
ipmitool lan set 1 ipaddr 192.168.1.101
ipmitool lan set 1 netmask 255.255.255.0
ipmitool lan set 1 defgw ipaddr 192.168.1.254
</code></pre><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="http://www.chenshake.com/summary-of-ipmi/" target="_blank" rel="external">IPMI总结</a></li>
<li><a href="http://www.openfusion.net/linux/ipmi_on_centos" target="_blank" rel="external">IPMI on CentOS/RHEL</a></li>
<li><a href="http://blog.csdn.net/goodluckwhh/article/details/9955715" target="_blank" rel="external">open ipmi内核实现简介</a></li>
<li><a href="http://www.ibm.com/developerworks/cn/linux/l-ipmi/index.html" target="_blank" rel="external">使用ipmitool实现Linux系统下对服务器的ipmi管理</a></li>
<li><a href="http://sourceforge.net/projects/openipmi/" target="_blank" rel="external">openipmi on sourceforge</a></li>
<li><a href="http://blog.csdn.net/huzhenwei/article/details/6300472" target="_blank" rel="external">在Linux系统上配置IPMI来远程控制服务器</a></li>
<li><a href="http://wenku.baidu.com/link?url=Sk-pIPKAOIrUVwg1L00GHmIMPjuFsqj13308opURYRARvyQh-pzOEOUm5_uwk7C-eBqGb91iXhacQ6eTIFG8AQ8YO9ZUjne6J_T0JES5ihy" target="_blank" rel="external">Linux平台下IPMI驱动程序设计与实现</a></li>
<li><a href="http://openipmi.sourceforge.net/IPMI.pdf" target="_blank" rel="external">IPMI - Gentle Introduction with OpenIPM</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://matrix207.github.com/2014/07/09/ipmi/" data-id="cin61d0k9008ffyizrihj28g6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-gnu-linux-program" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/28/gnu-linux-program/" class="article-date">
  <time datetime="2014-06-27T16:00:00.000Z" itemprop="datePublished">2014-06-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/28/gnu-linux-program/">GNU Linux program</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<h3 id="Part-1-Linux-program-tools"><a href="#Part-1-Linux-program-tools" class="headerlink" title="Part 1 Linux program tools"></a>Part 1 Linux program tools</h3><h4 id="GNU-cc"><a href="#GNU-cc" class="headerlink" title="GNU cc"></a>GNU cc</h4><pre><code>gcc myapp.c -L/home/fred/lib -I/home/fred/include -lnew -o myapp

gcc cursesapp.c -lncurse -static -o cursesapp

/*
 * pisqrt.c - Calculate the square of PI 100,000,000
 * times
 */
#include &lt;stdio.h&gt;
#include &lt;math.h&gt;

int main(void)
{
    double pi = M_PI; /* Defined in &lt;math.h&gt; */
    double pisqrt;
    long i;

    for (i=0; i&lt;10000000; ++i) {
        pisqrt = sqrt(pi);
    }

    return 0;
}
</code></pre><h4 id="GNU-make"><a href="#GNU-make" class="headerlink" title="GNU make"></a>GNU make</h4><pre><code>auto variable
$@
$&lt;
$^
$?
$(@D)
$(@F)
</code></pre><h4 id="GNU-autoconf"><a href="#GNU-autoconf" class="headerlink" title="GNU autoconf"></a>GNU autoconf</h4><pre><code>configure.in
AC_INIT(unique_file_in_source_dir)
AC_OUTPUT([file...[,extra_cmds[,init_cmds]]])

AC_INIT
    Test program
    Test function library
    Test header
    Test type defined
    Test structure
    Test compile
    Test library function
    Test system call
AC_OUTPUT

autoscan
ifnames
</code></pre><h4 id="patch"><a href="#patch" class="headerlink" title="patch"></a>patch</h4><pre><code>diff
patch

diff -c sigrot.1 sigrot.2 &gt; sigrot.path
patch -p0 &lt; sigrot.patch
</code></pre><h4 id="GDB"><a href="#GDB" class="headerlink" title="GDB"></a>GDB</h4><h4 id="assert"><a href="#assert" class="headerlink" title="assert"></a>assert</h4><pre><code>#include &lt;assert.h&gt;
void assert (int expression);
</code></pre><h4 id="macro"><a href="#macro" class="headerlink" title="macro"></a>macro</h4><pre><code>__LINE__
__FILE__
__FUNCTION__
</code></pre><h4 id="system-header-and-error"><a href="#system-header-and-error" class="headerlink" title="system header and error"></a>system header and error</h4><pre><code>stdlib.h    void abort(void);
stdlib.h    void exit(int status);
stdlib.h    int atexit(void (*fcn) (void));
stdio.h        void perror(const char *s);
string.h    char *strerror(int errnum);
errno.h        int errno;

void clearerr(FILE *stream);
int feof(FILE *stream);
int ferror(FILE *stream);
</code></pre><h4 id="system-log"><a href="#system-log" class="headerlink" title="system log"></a>system log</h4><pre><code>klogd
syslogd

#include &lt;syslog.h&gt;
void syslog(int priority, char *format, ...);

syslog(LOG_WARNING | LOG_USER, &quot;unable to open file %s *** %m\n&quot;, fname);

for shell:
logger [-s] [-f file] [-p pri] [-t tag] [-u socket] [message ...]
</code></pre><h4 id="dynamic-library"><a href="#dynamic-library" class="headerlink" title="dynamic library"></a>dynamic library</h4><pre><code>nm [options] file
ar {dmpgrtx} [member] archive files ...
ldd [options] file
ldconfig [options] [libs]

gcc -fPIC -g -c liberrr.c -o liberr.o
gcc -g -shared -Wl,-soname,liberr.so -o liberr.so.1.0.0 liberr.o -lc
ln -s liberr.so.1.0.0 liberr.so.1

void *dlopen(const char *filename, int flag);
void *dlsym(void *handle, char *symbol);
const char *dlerror(void);
int dlclose(void *handle);

gcc -g -Wall dltest.c -o dltest -ldl
</code></pre><hr>
<h3 id="Part-2-System-Program"><a href="#Part-2-System-Program" class="headerlink" title="Part 2 System Program"></a>Part 2 System Program</h3><h4 id="File-I-O"><a href="#File-I-O" class="headerlink" title="File I/O"></a>File I/O</h4><pre><code>open
create
close
read
write
ftruncate
lseek
fsync
fstat
fchown
fchmod
flock
fcntl
dup
dup2
slect
ioctl

fopen
freopen
fclose

feof
ferror
clearer
fileno

printf
fprintf
sprintf
snprintf

vprintf
vfprintf
vsprintf
vsnprintf

scanf
fscanf
sscanf

vscanf
vsscanf
vfscanf

fseek
ftell
fgetpos
fsetpos
rewind

fflush
setbuf
setbuffer
setlinebuf
setvbuf

remove
rename

tmpfile
tmpnam

mkstemp

getcwd
chdir
fchdir

mkdir
rmdir

opendir
readdir
rewinddir
closedir
</code></pre><h4 id="Process-control"><a href="#Process-control" class="headerlink" title="Process control"></a>Process control</h4><pre><code>system
fork
exec
popen
pclose

wait
waitpid

exit
abort
kill

alarm
pause

sigemptyset
sigfillset
sigaddset
sigdelset
sigismember

sigprocmask
sigaction
sgpending

sched_setscheduler
sched_getscheduler
sched_get_priority_max
sched_get_priority_min
getpriority
setpriority
nice
</code></pre><h4 id="Thread"><a href="#Thread" class="headerlink" title="Thread"></a>Thread</h4><pre><code>_clone

pthread_create
pthread_exit
pthread_join
pthread_detach
pthread_atfork
pthread_cancel
pthread_setcancelstate
pthread_setcanceltype
pthread_testcancel

pthread_cleanup_push
pthread_cleanup_pop
pthread_cleanup_push_defer_np
pthread_cleanup_pop_restore_np

pthread_cond_signal
pthread_cond_broadcast
pthread_cond_wait
pthread_cond_timewait
pthread_cond_destroy

pthread_equal

pthread_attr_

pthread_mutex_
</code></pre><h4 id="memory-manager"><a href="#memory-manager" class="headerlink" title="memory manager"></a>memory manager</h4><pre><code>malloc
calloc
realloc
free

mmap
mumap
msync
mprotect
mlock
munlock
mlockall
munlockall
</code></pre><hr>
<h4 id="Part-3-IPC-and-Network-program"><a href="#Part-3-IPC-and-Network-program" class="headerlink" title="Part 3 IPC and Network program"></a>Part 3 IPC and Network program</h4><h4 id="IPC"><a href="#IPC" class="headerlink" title="IPC"></a>IPC</h4><pre><code>pipe
popen
pclose

mkfifo

shmget
shmat
shmdt

msgget
msgsnd
msgrcv
msgctl

semget
semop
semctl

setsid

openlog
closelog
syslog
</code></pre><h4 id="Netwrok"><a href="#Netwrok" class="headerlink" title="Netwrok"></a>Netwrok</h4><pre><code>socket
bind
listen
connect
accept
read
write
recv_from
send_to

sendfile
close

netstat 
tcpdump

multicast
</code></pre><hr>
<h3 id="Part-4-GUI"><a href="#Part-4-GUI" class="headerlink" title="Part 4 GUI"></a>Part 4 GUI</h3><pre><code>terminal

ncurses

x windows

GTK+ GUI

Qt GUI

OpenGL Mesa 3D
</code></pre><hr>
<h3 id="Part-5-Special-program-technology"><a href="#Part-5-Special-program-technology" class="headerlink" title="Part 5 Special program technology"></a>Part 5 Special program technology</h3><h4 id="GNU-Bash"><a href="#GNU-Bash" class="headerlink" title="GNU Bash"></a>GNU Bash</h4><h4 id="Device-Driver"><a href="#Device-Driver" class="headerlink" title="Device Driver"></a>Device Driver</h4><hr>
<h3 id="Part-6"><a href="#Part-6" class="headerlink" title="Part 6"></a>Part 6</h3><h4 id="RPM"><a href="#RPM" class="headerlink" title="RPM"></a>RPM</h4><h4 id="Licence"><a href="#Licence" class="headerlink" title="Licence"></a>Licence</h4><ol>
<li>MIT</li>
<li>BSD</li>
<li>GNU</li>
</ol>
<hr>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="">GNU Linux program</a></li>
<li><a href="http://www.advancedlinuxprogramming.com/alp-folder/advanced-linux-programming.pdf" target="_blank" rel="external">Advanced linux program</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://matrix207.github.com/2014/06/28/gnu-linux-program/" data-id="cin61d0k6008dfyiz5f8c36wi" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-sdn" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/26/sdn/" class="article-date">
  <time datetime="2014-06-25T16:00:00.000Z" itemprop="datePublished">2014-06-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/26/sdn/">SDN</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="http://upload.wikimedia.org/wikipedia/commons/0/0b/Sdn-3layers.gif" alt="SDN-3Layers"></p>
<p><strong>SDN 3Layers</strong></p>
<hr>
<p><img src="http://upload.wikimedia.org/wikipedia/commons/d/d0/SDN-architecture-overview.png" alt="SDN-architecture-overview"></p>
<p><strong>SDN Architecture Overview</strong></p>
<hr>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="http://en.wikipedia.org/wiki/Software-defined_networking" target="_blank" rel="external">Software Defined Networking</a></li>
<li><a href="http://www.ithome.com.tw/node/77353" target="_blank" rel="external">新一代網路架構SDN顛覆傳統網路的控制模式</a></li>
<li><a href="http://www.ithome.com.tw/node/77354" target="_blank" rel="external">3種SDN架構的產品策略</a></li>
<li><a href="http://www.h3c.com.cn/Solution/VAN/Home/Project_features/201303/778755_30004_0.htm" target="_blank" rel="external">SDN软件定义网络</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://matrix207.github.com/2014/06/26/sdn/" data-id="cin61d0k10089fyiz1pcjf8n7" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-iscsi" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/24/iscsi/" class="article-date">
  <time datetime="2014-06-23T16:00:00.000Z" itemprop="datePublished">2014-06-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/24/iscsi/">iSCSI</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="What-is-ISCSI"><a href="#What-is-ISCSI" class="headerlink" title="What is ISCSI"></a>What is ISCSI</h3><p>iSCSI是由IEETF开发的网络存储标准，目的是为了用IP协议将存储设备连接在一起。</p>
<h3 id="Why-need-iSCSI"><a href="#Why-need-iSCSI" class="headerlink" title="Why need iSCSI"></a>Why need iSCSI</h3><ol>
<li>解决了SCSI协议在设备数目和连接距离上的限制;</li>
<li>为SAN提供了一种高性价比的传输协议；</li>
<li>与各种存储管理结合起来，提供灵活的备份、镜像、灾难恢复以及次级存储解决方案；</li>
</ol>
<h3 id="iSCSI-的存储连接方式"><a href="#iSCSI-的存储连接方式" class="headerlink" title="iSCSI 的存储连接方式"></a>iSCSI 的存储连接方式</h3><ol>
<li><p>iSCSI HBA卡连接方式（硬iSCSI）：<br>在主机上安装专业的iSCSI HBA适配卡，从而实现主机与交换机之间、主机与存储之间的<br>高效数据交换。传输性能好，价格高。</p>
</li>
<li><p>以太网卡+initiator软件方式（软iSCSI）：<br>服务器、工作站等主机使用标准的以太网卡，通过以太网线直接与以太网交换机连接，<br>iSCSI存储也通过以太网线连接到以太网交换机上，或直接连接到主机的以太网卡上。<br>在主机上安装Initiator软件，Initiator软件可以将以太网卡虚拟为iSCSI卡，接受和发<br>送iSCSI数据报文，从而实现主机和iSCSI设备之间的iSCSI协议和TCP/IP协议传输功能。</p>
</li>
</ol>
<h3 id="Compile-and-install"><a href="#Compile-and-install" class="headerlink" title="Compile and install"></a>Compile and install</h3><p>The iSCSI target consists of a kernel module (iscsi_trgt.ko) , daemon<br>(ietd) and control utility (ietadm).</p>
<ul>
<li>Compile</li>
</ul>
<ol>
<li>build all: <code>make</code></li>
<li>build component: <code>make kernel</code> or <code>make usr</code></li>
</ol>
<ul>
<li>install</li>
</ul>
<ol>
<li>Install all: <code>make [KSRC=&lt;kernel-src&gt;] install</code></li>
<li><p>Install individual components:</p>
<p> make [KSRC=<kernel-src>] install-kernel - for kernel module<br> make [KSRC=<kernel-srv>] install-usr - for daemon and utility<br> make [KSRC=<kernel-srv>] install-init - for init.d script<br> make [KSRC=<kernel-srv>] install-etc - for config files</kernel-srv></kernel-srv></kernel-srv></kernel-src></p>
</li>
</ol>
<p>ietd and ietadm will be install in /usr/sbin<br>iscsi-target was install in /etc/init.d/<br>ietd.conf and initiators.{allow,denny} were install in /etc</p>
<ul>
<li><p>start stop</p>
<p>  /etc/init.d/iscsi-target start<br>  /etc/init.d/iscsi-target stop</p>
</li>
</ul>
<h3 id="iet基本配置和命令"><a href="#iet基本配置和命令" class="headerlink" title="iet基本配置和命令"></a>iet基本配置和命令</h3><p><strong>iet主要配置</strong></p>
<p>主要包括以下配置文件</p>
<pre><code>/etc/ietd.conf ：iet的主配置文件
/etc/initiators.allow：控制initiator对target的访问权限
/etc/initiators.deny：控制initiator对target的访问权限
/etc/targets.allow：控制不同target的被访问权限
</code></pre><p>通过/etc/ietd.conf, iet实现iSCSI Target的基本功能.</p>
<p>iSCSI Target的命名，命名在同一子网内应该是唯一。</p>
<pre><code>Target  target名称
其中：
target 名称：是iSCSI Target名称。一般iSCSI Target命名采用
    “iqn.yyyy-mm.&lt;reversed domain name&gt;: identifier 识别代号”的格式。
</code></pre><p>将块设备、文件、LVM卷、RAID卷作为块设备映射给iSCSI initiator使用。 </p>
<pre><code>Lun  &lt;lunID&gt; Path=&lt;device&gt;,Type=fileio|blockio[,IOMode=(wb|ro)]
其中：
&lt;lunID&gt;：是Lun的编号从0开始，最大2^14-1。
Path=&lt;device&gt;：指定块设备。可以使用dd命令生成一个文件。
Type=fileio|blockio：指定块设备类型，分区及dd命令生成的文件使用fileio类型；
    LVM卷、RAID卷使用blockio类型。
IOMode=(wb|ro)：指定iSCSI initiator允许的操作，wb表示可读写；ro表示只读。
</code></pre><p>配置完后重起iscsi-target，initiator即可连接使用.</p>
<p><strong>iet其它配置</strong></p>
<p>通过命令方式配置的iSCSI Target在重启后会失效。</p>
<pre><code>添加一个新的Target。其中[id]为数字却必须唯一，Name需自定义，也要唯一。
ietadm --op new --tid=[id] --params Name=iqn.zqin.example

添加一个新的lun。其中[id]必须是一个已存在的tid号，[lun]从0开始。
ietadm --op new --tid=[id] --lun=[lun] --params Path=/path/exported/file,Type=fileio
</code></pre><p><strong>iet常用命令</strong></p>
<pre><code>查看当前iSCSI Target清单。 
cat /proc/net/iet/volume

查看当前服务器iSCSI Target服务以及连接状态命令
cat /proc/net/iet/sessions

停止某个Target 的某个 Connection 的连接。
ietadm --op delete --tid=2 --sid=562950876233792 --cid=1  &amp;&amp; ietadm --op delete --tid=2

停止所有Target 的连接。
ietadm --op delete

删除某个Target （已经没有 Session 连接的）。
ietadm --op delete --tid= 1
</code></pre><p><strong>完整操作如下</strong>:</p>
<pre><code>[root@ ~]# dd if=/dev/zero of=/root/iscsi.disk bs=1M count=1024
1024+0 records in
1024+0 records out
1073741824 bytes (1.1 GB) copied, 9.30143 s, 115 MB/s
[root@ ~]# echo &quot;Target iqn.2014-06.com.matrix:storage.515.disk&quot; &gt;&gt; /etc/ietd.conf
[root@ ~]# echo &quot;Lun 0 Path=/root/iscsi.disk,Type=fileio&quot;&gt;&gt;/etc/ietd.conf
[root@ ~]# echo &quot;Alias lun0&quot;&gt;&gt;/etc/ietd.conf
[root@ ~]# cat /etc/ietd.conf 
Target iqn.2014-06.com.matrix:storage.515.disk
Lun 0 Path=/root/iscsi.disk,Type=fileio
Alias lun0
[root@ ~]# echo &quot;iqn.2014-06.com.matrix:storage.515.disk 172.16.*.*&quot;&gt;&gt; /etc/initiators.allow
[root@ ~]# cat /etc/initiators.allow 
iqn.2014-06.com.matrix:storage.515.disk 172.16.*.*
[root@ ~]# netstat -tulpn | grep 3260 
tcp     0      0 172.16.110.10:3260   0.0.0.0:*  LISTEN  12147/ietd 
[root@ ~]# cat /proc/net/iet/session 
tid:1 name:iqn.2014-06.com.matrix:storage.515.disk
[root@ ~]# cat /proc/net/iet/volume 
tid:1 name:iqn.2014-06.com.matrix:storage.515.disk
    lun:0 state:0 iotype:fileio iomode:wt blocks:2097152 blocksize:512 path:/root/iscsi.disk

[root@ ~]# /etc/init.d/iscsi-target restart
Stopping iSCSI Target:                                     [  OK  ]
Starting iSCSI Target: FATAL: Error inserting crc32c_intel (/lib/modules/2.6
.32-279.el6.x86_64/kernel/arch/x86/crypto/crc32c-intel.ko): No such device
                                                           [  OK  ]
</code></pre><p>上面的错误是因为centos 6.3, kernel 2.6.32-279.el6.x86_64, 该版本已不需要<br>crc32c_intel.ko模块，可以过屏蔽脚本<code>/etc/init.d/iscsi-target</code>中的<br><code>modprobe -q crc32</code>来解决该错误信息。</p>
<pre><code>[root@ ~]# /etc/init.d/iscsi-target restart
Stopping iSCSI Target:                                     [  OK  ]
Starting iSCSI Target:                                     [  OK  ]
[root@ ~]# service iscsi-target status
iSCSI Target (pid 12147) is running...
</code></pre><h3 id="iSCSI-initiator"><a href="#iSCSI-initiator" class="headerlink" title="iSCSI initiator"></a>iSCSI initiator</h3><p>安装 <code>yum install iscsi-initiator-utils</code></p>
<p>iscsiadm是基于命令行的iscsi管理工具，提供对iscsi节点、会话、连接以及发现记录的操作。<br>涉及的主要操作如下:</p>
<ol>
<li>发现iscsi存储: iscsiadm -m discovery -t st -p ISCSI_IP</li>
<li>查看iscsi发现记录 iscsiadm -m node</li>
<li>删除iscsi发现记录 iscsiadm -m node -o delete -T LUN_NAME -p ISCSI_IP</li>
<li>登录iscsi存储 iscsiadm -m node -T LUN_NAME -p ISCSI_IP -l</li>
<li>登出iscsi存储 iscsiadm -m node -T LUN_NAME -p ISCSI_IP -u</li>
<li>登录全部iscsi存储 iscsiadm -m node -L all</li>
<li>登出全部iscsi存储 iscsiadm -m node -U all</li>
<li>查看session iscsiadm -m session</li>
<li><p>设置CHAP, vim /etc/iscsi/iscsid.conf, 或这使用下面的命令设置: </p>
<p>   [root@localhost ~]# iscsiadm -m node -T iqn.2007-10.lio.com:dg3.liolv1 -p 172.16.130.100 -o update –name node.session.auth.authmethod –value=CHAP<br>   [root@localhost ~]# iscsiadm -m node -T iqn.2007-10.lio.com:dg3.liolv1 -p 172.16.130.100 -o update –name node.session.auth.username –value=alan<br>   [root@localhost ~]# iscsiadm -m node -T iqn.2007-10.lio.com:dg3.liolv1 -p 172.16.130.100 -o update –name node.session.auth.password –value=123555<br>   [root@localhost ~]# iscsiadm -m node -T iqn.2007-10.lio.com:dg3.liolv1 -p 172.16.130.100 –login<br>注意:<br>要先使用发现discovery，然后才能登陆login，否则会出现错误“iscsiadm: No records found”</p>
</li>
</ol>
<p>下面是详细的操作：(<strong>注意:括号内容为注释说明</strong>)</p>
<pre><code>[root@localhost dennis]# fdisk -l

Disk /dev/sda: 149 GiB, 160000000000 bytes, 312500000 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x00007f87

Device    Boot     Start       End    Blocks  Id System
/dev/sda1 *         2048   1026047    512000  83 Linux
/dev/sda2        1026048 312498175 155736064  8e Linux LVM

(...此处省略不必要的内容...)
[root@localhost dennis]# iscsiadm -m discovery -t st -p 172.16.110.10
172.16.110.10:3260,1 iqn.2014-06.com.matrix:storage.515.disk
[root@localhost dennis]# iscsiadm -m node -T iqn.2014-06.com.matrix:storage.515.disk -p 172.16.110.10 -l
Logging in to [iface: default, target: iqn.2014-06.com.matrix:storage.515.disk, portal: 172.16.110.10,3260] (multiple)
Login to [iface: default, target: iqn.2014-06.com.matrix:storage.515.disk, portal: 172.16.110.10,3260] successful.
[root@localhost dennis]# fdisk -l

Disk /dev/sda: 149 GiB, 160000000000 bytes, 312500000 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x00007f87

Device    Boot     Start       End    Blocks  Id System
/dev/sda1 *         2048   1026047    512000  83 Linux
/dev/sda2        1026048 312498175 155736064  8e Linux LVM

(...此处省略不必要的内容...)
(成功连接后,多出一块磁盘/dev/sdb，大小刚好是前面dd创建的1G文件)
Disk /dev/sdb: 1 GiB, 1073741824 bytes, 2097152 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes

[root@localhost dennis]# iscsiadm -m node -T iqn.2014-06.com.matrix:storage.515.disk -p 172.16.110.10 -u
Logging out of session [sid: 1, target: iqn.2014-06.com.matrix:storage.515.disk, portal: 172.16.110.10,3260]
Logout of [sid: 1, target: iqn.2014-06.com.matrix:storage.515.disk, portal: 172.16.110.10,3260] successful.
[root@localhost dennis]# 
</code></pre><p>连接成功后，iet端显示如下：</p>
<pre><code>[root@ ~]# cat /proc/net/iet/session
tid:1 name:iqn.2014-06.com.matrix:storage.515.disk
    sid:562949990973952 initiator:iqn.1994-05.com.redhat:7d366003913
        cid:0 ip:172.16.50.39 state:active hd:none dd:none    tip:172.16.110.10
</code></pre><p>第一次连接时，磁盘是还没有分区化, 磁盘分区：</p>
<pre><code>[root@localhost dennis]# fdisk /dev/sdb

Welcome to fdisk (util-linux 2.24.2).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

Device does not contain a recognized partition table.

Created a new DOS disklabel with disk identifier 0xf1eb4d09.

Command (m for help): m

Help:

  DOS (MBR)
   a   toggle a bootable flag
   b   edit nested BSD disklabel
   c   toggle the dos compatibility flag

  Generic
   d   delete a partition
   l   list known partition types
   n   add a new partition
   p   print the partition table
   t   change a partition type
   v   verify the partition table

  Misc
   m   print this menu
   u   change display/entry units
   x   extra functionality (experts only)

  Save &amp; Exit
   w   write table to disk and exit
   q   quit without saving changes

  Create a new label
   g   create a new empty GPT partition table
   G   create a new empty SGI (IRIX) partition table
   o   create a new empty DOS partition table
   s   create a new empty Sun partition table


Command (m for help): g
Created a new GPT disklabel (GUID: 22C002F1-D9F7-4E4C-8F89-9EFEBB971A1D).

Command (m for help): n
Partition number (1-128, default 1): 1
First sector (2048-2097118, default 2048): 
Last sector, +sectors or +size{K,M,G,T,P} (2048-2097118, default 2097118): 

Created a new partition 1 of type &apos;Linux filesystem&apos; and of size 1023 MiB.

Command (m for help): p
Disk /dev/sdb: 1 GiB, 1073741824 bytes, 2097152 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: gpt
Disk identifier: 22C002F1-D9F7-4E4C-8F89-9EFEBB971A1D

Device    Start          End   Size Type
/dev/sdb1  2048      2097118  1023M Linux filesystem

Command (m for help): w

The partition table has been altered.
Calling ioctl() to re-read partition table.
Syncing disks.

[root@localhost dennis]# fdisk -l

Disk /dev/sda: 149 GiB, 160000000000 bytes, 312500000 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x00007f87

Device    Boot     Start       End    Blocks  Id System
/dev/sda1 *         2048   1026047    512000  83 Linux
/dev/sda2        1026048 312498175 155736064  8e Linux LVM

(...此处省略不必要的内容...)

Disk /dev/sdb: 1 GiB, 1073741824 bytes, 2097152 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: gpt
Disk identifier: 22C002F1-D9F7-4E4C-8F89-9EFEBB971A1D

Device    Start          End   Size Type
/dev/sdb1  2048      2097118  1023M Linux filesystem
</code></pre><p>分区完毕后，对磁盘该分区进行格式化：</p>
<pre><code>[root@localhost dennis]# mkfs.ext3 /dev/sdb1
mke2fs 1.42.8 (20-Jun-2013)
Filesystem label=
OS type: Linux
Block size=4096 (log=2)
Fragment size=4096 (log=2)
Stride=0 blocks, Stripe width=0 blocks
65536 inodes, 261883 blocks
13094 blocks (5.00%) reserved for the super user
First data block=0
Maximum filesystem blocks=268435456
8 block groups
32768 blocks per group, 32768 fragments per group
8192 inodes per group
Superblock backups stored on blocks: 
    32768, 98304, 163840, 229376

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (4096 blocks): done
Writing superblocks and filesystem accounting information: done
</code></pre><p>格式化完毕后,进行挂载，然后就可以像对待本地目录一样进行相关操作了(拷贝、删除等)<br><strong>注：下一次登陆iscsi卷后，不用进行分区、格式化了，直接挂载就可以使用了</strong></p>
<pre><code>[root@localhost dennis]# mkdir /mnt/iscsi
[root@localhost dennis]# mount /dev/sdb1 /mnt/iscsi
[root@localhost dennis]# ls /mnt/iscsi/
lost+found
[root@localhost dennis]# cp Downloads/VirtualBox-4.3-4.3.12_93733_fedora18-1.x86_64.rpm /mnt/iscsi/
[root@localhost dennis]# ls -lh /mnt/iscsi/
total 74M
drwx------. 2 root root 16K Jun 27 12:10 lost+found
-rw-r--r--. 1 root root 74M Jun 27 12:13 VirtualBox-4.3-4.3.12_93733_fedora18-1.x86_64.rpm
[root@localhost dennis]# 
</code></pre><h3 id="Initiator-for-windows"><a href="#Initiator-for-windows" class="headerlink" title="Initiator for windows"></a>Initiator for windows</h3><p>login with batch script </p>
<pre><code>@echo off
for /l %%j in (1,1,2) do (
    for /l %%k in (0,1,49) do (
        iscsicli logintarget iqn.2007-10.cbxa.com:r5%%j.aa%%k T 192.168.166.100 3260 * * * * * * * * * * * * * 0       
    )
)
pause
</code></pre><p>使用用户名(aa0~aa49)和密码(123456789012)登陆:</p>
<pre><code>iscsicli logintarget iqn.2007-10.cbxa.com:r5%%j.aa%%k T 192.168.166.100 3260 * * * * * * * * * aa%%k 123456789012  1 * 0
</code></pre><h3 id="Protocol"><a href="#Protocol" class="headerlink" title="Protocol"></a>Protocol</h3><p><img src="/assets/image/posts/iscsi/iscsi_010.png" alt=""><br><img src="/assets/image/posts/iscsi/iscsi_011.png" alt=""><br><img src="/assets/image/posts/iscsi/iscsi_026.png" alt=""><br><img src="/assets/image/posts/iscsi/iscsi_027.png" alt=""><br><img src="/assets/image/posts/iscsi/iscsi_028.png" alt=""><br><img src="/assets/image/posts/iscsi/iscsi_029.png" alt=""><br><img src="/assets/image/posts/iscsi/iscsi_030.png" alt=""><br><img src="/assets/image/posts/iscsi/iscsi_031.png" alt=""><br><img src="/assets/image/posts/iscsi/iscsi_032.png" alt=""><br><img src="/assets/image/posts/iscsi/iscsi_033.png" alt=""><br><img src="/assets/image/posts/iscsi/iscsi_034.png" alt=""><br><img src="/assets/image/posts/iscsi/iscsi_035.png" alt=""><br><img src="/assets/image/posts/iscsi/iscsi_036.png" alt=""><br><img src="/assets/image/posts/iscsi/iscsi_037.png" alt=""><br><img src="/assets/image/posts/iscsi/iscsi_038.png" alt=""><br><img src="/assets/image/posts/iscsi/iscsi_039.png" alt=""><br><img src="/assets/image/posts/iscsi/iscsi_040.png" alt=""><br><img src="/assets/image/posts/iscsi/iscsi_041.png" alt=""><br><img src="/assets/image/posts/iscsi/iscsi_042.png" alt=""><br><img src="/assets/image/posts/iscsi/iscsi_043.png" alt=""><br><img src="/assets/image/posts/iscsi/iscsi_044.png" alt=""><br><img src="/assets/image/posts/iscsi/iscsi_045.png" alt=""></p>
<h3 id="iSCSI-initiator与iSCSI-target："><a href="#iSCSI-initiator与iSCSI-target：" class="headerlink" title="iSCSI initiator与iSCSI target："></a>iSCSI initiator与iSCSI target：</h3><ol>
<li><a href="http://unh-iscsi.sourceforge.net/" target="_blank" rel="external">UNH iSCSI</a></li>
<li><a href="http://iscsitarget.sourceforge.net/" target="_blank" rel="external">iSCSI Enterprise Target</a></li>
<li><a href="http://sourceforge.net/projects/intel-iscsi/" target="_blank" rel="external">intel iSCSI</a></li>
<li><a href="http://www.microsoft.com/windowsserver2003/technologies/storage/iscsi/default.mspx" target="_blank" rel="external">Microsoft iSCSI Initiator 2.0X</a></li>
<li><a href="http://linux-iscsi.sourceforge.net/" target="_blank" rel="external">linux-iscsi(project</a></li>
<li><a href="http://www.open-iscsi.org/" target="_blank" rel="external">Open iSCSI</a></li>
<li>Microsoft Storage 2003</li>
<li><a href="http://www.starwindsoftware.com/" target="_blank" rel="external">StarWind</a></li>
</ol>
<h3 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h3><ol>
<li><p>防火墙链接限制，外界无法访问Target服务器3260端口。<br> 请在防火墙上手动放开3260端口，或者有条件的话干脆关闭防火墙。<br> 更改防火墙配置并重启生效<br> vi /etc/sysconfig/iptables<br> server iptable restart  </p>
<p> service iptables stop<br> setenforce 0  </p>
</li>
<li><p>共享的路径都可以有哪些？<br> 在IET的技术文档中规定，以下几种路径是被支持的：  </p>
<pre><code>1)一个完整的 block 磁盘，比如/dev/sdb 。  
2)一个RAID设备或者是一个LVM.  
3)一个虚拟的镜像文件, 如dd使用创建.  
</code></pre></li>
<li><p>“iscsiadm:No portals found”.   </p>
<ul>
<li>可能服务没有启动：重启iscsid服务, <code>service iscsi start</code> </li>
<li>可能存储端没有允许当前ip访问：</li>
</ul>
</li>
</ol>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="http://www.cnblogs.com/yunnotes/archive/2013/04/19/3032488.html" target="_blank" rel="external">iSCSI学习总结</a></li>
<li><a href="http://tech.watchstor.com/storage-network-130569.htm" target="_blank" rel="external">★★★如何正确使用iSCSI Enterprise Target</a></li>
<li><a href="http://www.doc88.com/p-51666752050.html" target="_blank" rel="external">iSCSI协议解析★★★</a></li>
<li><a href="http://www.h3c.com.cn/Solution/Multimedia_Communicate/Video_Surveillance_Storage/How_Do_I_Do_It/White_Paper/201008/686814_30004_0.htm" target="_blank" rel="external">iSCSI技术白皮书★★★</a></li>
<li><a href="http://www.sansky.net/article/2007-12-03-iscsi-storage.html" target="_blank" rel="external">iSCSI存储技术全攻略</a></li>
<li><a href="http://blog.sina.com.cn/s/blog_5c0153620100g7e2.html" target="_blank" rel="external">Linux下iSCSI安装步骤</a></li>
<li><a href="http://kissthink.com/archive/4379.html" target="_blank" rel="external">ET - iSCSI Enterprise Target</a></li>
<li><a href="http://lynnkong.iteye.com/blog/1806470" target="_blank" rel="external">存储基础知识学习笔记</a></li>
<li><a href="http://storage.cnw.com.cn/storage-virtualization/htm2012/20121210_260295.shtml" target="_blank" rel="external">解析iSCSI存储系统的未来发展</a></li>
<li><a href="http://sunshyfangtian.blog.51cto.com/1405751/560162/" target="_blank" rel="external">CentOS5 iSCSI部署</a></li>
<li><a href="http://www.storage-conference.org/2003/papers/19-Meth-Design.pdf" target="_blank" rel="external">Design of the ISCSI Protocol</a></li>
<li><a href="http://pmghong.blog.163.com/blog/static/2146602802012111505853540/" target="_blank" rel="external">iSCSI 二 – 搭建基于iSCSI的IP SAN存储系统</a></li>
<li><a href="http://blog.csdn.net/do2jiang/article/details/5144706" target="_blank" rel="external">ISCSI Target的常用配置和常用操作-备忘</a></li>
<li><a href="http://blog.csdn.net/vah101/article/details/6300197" target="_blank" rel="external">Linux下应用tgtadm构建iSCSI Target–SAN</a></li>
<li><a href="http://www.2cto.com/os/201202/119963.html" target="_blank" rel="external">详解Linux下挂载和格式化虚拟磁盘</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://matrix207.github.com/2014/06/24/iscsi/" data-id="cin61d0k4008bfyiz8o4ra43y" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-how-to-learn-morse-code" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/24/how-to-learn-morse-code/" class="article-date">
  <time datetime="2014-06-23T16:00:00.000Z" itemprop="datePublished">2014-06-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/24/how-to-learn-morse-code/">How to Learn Morse Code</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/assets/image/posts/Morse-code-tree.svg" alt="Morse code tree"></p>
<p><strong>From</strong> <a href="http://www.wikihow.com/Learn-Morse-Code" target="_blank" rel="external">http://www.wikihow.com/Learn-Morse-Code</a></p>
<p>The Morse Code was developed by Samuel F.B. Morse in 1844. Even after more than<br>160 years, it is still used today, especially by amateur radio operators. The<br>code can be sent quickly over the telegraph, and is also useful for emergency<br>signaling (SOS) with a radio, mirror, or flashlight, and even for people with<br>severe disabilities to communicate. In order to master Morse code, however, you<br>need to approach it like a new language.</p>
<h3 id="Step-1"><a href="#Step-1" class="headerlink" title="Step 1"></a>Step 1</h3><p>Listen carefully to slow morse code recordings. What you’re listening for is a<br>combination of dots and dashes (also referred to as dits and dahs). A dit is a<br>short beep, while a dah is a longer beep (three times longer). Every letter is<br>separated by a short pause, and every word is separated by a longer pause (three<br>times longer).</p>
<ul>
<li>You can search or shop for practice recordings, or use a shortwave receiver to<br>listen to the real thing. Free and inexpensive Morse training software is<br>available and usually better than the recordings, it can be set to change the<br>text randomly so it never gets “stale” and you can choose whatever learning<br>method works best for you. Never count dots and dashes, learn the sound of the<br>letter. If you are using Farnsworth, you set the spacing between letters slower<br>than the letter speed. Choose a letter speed a bit above your target code speed<br>and never lower the letter speed, only the letter spacing. This is the way to<br>learn Morse as a language, 15-25 words per minute or more. The following methods<br>are best used when you have no intention of using Morse above 5 words per minute,<br>they will require you to un learn the bad habits and start over.</li>
</ul>
<h3 id="Step-2"><a href="#Step-2" class="headerlink" title="Step 2"></a>Step 2</h3><p>Refer to a copy of the Morse Code alphabet (as seen at the bottom of the page).<br>You can use a basic chart such as the one shown at right (click to enlarge), or<br>you can use a more advanced chart which includes punctuation, abbreviated phrases,<br>prosigns and Q Codes.<a href="http://morsecode.scphillips.com/morse2.html" target="_blank" rel="external">1</a> Match up what you heard to the letters in the alphabet.<br>What does it say? Were you correct?</p>
<p>Some people find it easier to learn by writing down the letter with dots/periods<br>and dashes, and comparing it to a chart such as the one shown; others say this<br>creates an additional step that will only slow you down in learning Morse code.<br>Do whatever feels more comfortable for you. If you choose to avoid interpreting<br>written dots and dashes, you can use a pronunciation chart which lists the sounds<br>of the Morse Code signals, as if you were hearing them, rather than the dash and<br>dot symbols.<a href="http://morsecode.scphillips.com/morse.html" target="_blank" rel="external">2</a></p>
<h3 id="Step-3"><a href="#Step-3" class="headerlink" title="Step 3"></a>Step 3</h3><p>Sound it out. Practice translating basic words and sentences into Morse code. In<br>the beginning, you can write it down, then sound it out, but eventually you’ll<br>need to go straight to sounding it out. For example, the word “cat”. Write it down:</p>
<pre><code>-.-.   .-   -
</code></pre><p>then transmit the word (you can use the buttons on a mobile phone, or beep<br>vocally – the latter will probably help your mind pick up the code faster). To<br>pronounce morse code, dit is pronounced di with a short i sound and a silent t.<br>Dah is pronounced with a short a sound. So cat is pronounced dah-di-dah-di di-dah<br>dah. Once you feel comfortable with that, pick up a children’s book and try to<br>transmit the content in Morse code without writing anything down. Record yourself<br>and play it back later to see if you were correct.</p>
<ul>
<li>Be conscious of your spacing. Each letter needs to be separated by a space<br>that’s the same duration as a dah (three times the duration of a dit). Each word<br>needs to be separated by a space that lasts about seven times the duration of a<br>dit. The better your spacing, the easier your code will be to understand.</li>
</ul>
<h3 id="Step-4"><a href="#Step-4" class="headerlink" title="Step 4"></a>Step 4</h3><p>Memorize the easiest letters first.<a href="http://www.learnmorsecode.com/" target="_blank" rel="external">3</a> A single dah is a “T” and a single dit is<br>an “E”. Next, a dah-dah is an “M” and a dit-dit is an “I”. Memorize the letters<br>for 3 and 4 dits and dahs in a row. Once you’ve got those down, start memorizing<br>the combinations: dit-dah, dit-dah-dah, dit-dah-dah-dah, and so on. Leave the more<br>complex combinations for last. Fortunately, this includes some less commonly used<br>letters (like Q, Y, X, and V) so when you get to this point, focus on the more<br>commonly used letters first. Notice how E and T have the shortest symbols, and<br>how K, Z, Q, and X have long symbols. </p>
<h3 id="Step-5"><a href="#Step-5" class="headerlink" title="Step 5"></a>Step 5</h3><p>Make associations. For every letter, think of a memorable “sound alike”. Here’s<br>an example: The letter “C” is dah-dit-dah-dit (long short long short). Can you<br>think of a word that starts with that letter, and sounds like the Morse<br>pronunciation? How about catastrophic, which has an emphasis on the first and<br>third syllable, and begins with a “c”? Or how about dah-dit, which is Morse code<br>for “N”? How about nanny? This will be harder for words that end in several “dahs”<br>in a row, since many words in the English language alternate emphasis between<br>syllables, and usually do not end with an emphasis, but you could use sentences,<br>too. There are also existing Morse code mnemonics that have been around for many<br>years; you might be able to find them online, or purchase them.<a href="http://www.cq2k.com" target="_blank" rel="external">4</a></p>
<ul>
<li>If you’re a music lover, you can try associating Morse code pronunciations with<br>tunes or melodies that are familiar with you. For example, the distinctive<br>beginning of Beethoven’s Symphony No. 5 is short-short-short-long, or dit-dit-dit-dah,<br>which is the letter “V”, the roman numeral for “5” (as in Beethoven’s 5th Symphony),<br>and is rather appropriate for such a “victorious” tune, don’t you think? During<br>WW2, BBC broadcasters used this four-note melody to start off its radio broadcasts<br>because of its association with the word “victory”! <a href="http://en.wikipedia.org/wiki/Symphony_No._5_(Beethoven)" target="_blank" rel="external">5</a></li>
</ul>
<h3 id="Step-6"><a href="#Step-6" class="headerlink" title="Step 6"></a>Step 6</h3><p>Have fun with it. Want to get your friends into it? Learn how to blink code. That<br>way, you can give an SOS blink when your friend just introduced you to a rather<br>unpleasant blind date, for instance. Use written Morse code to write secret notes,<br>or keep a diary in Morse, or tell dirty jokes without anyone knowing. Give someone<br>a Morse code greeting card. Say “I love you” in Morse code (how romantic!).<br>Whatever floats your boat, find a way to do it in Morse code, and you’ll learn<br>it much faster. </p>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="http://morsecode.scphillips.com/morse2.html" target="_blank" rel="external">1</a></li>
<li><a href="http://morsecode.scphillips.com/morse.html" target="_blank" rel="external">2</a></li>
<li><a href="http://www.learnmorsecode.com/" target="_blank" rel="external">3</a></li>
<li><a href="http://www.cq2k.com" target="_blank" rel="external">4</a></li>
<li><a href="http://en.wikipedia.org/wiki/Symphony_No._5_(Beethoven)" target="_blank" rel="external">5</a></li>
</ul>
<h3 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h3><ul>
<li><a href="http://www.onlineconversion.com/morse_code.htm" target="_blank" rel="external">online translate</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://matrix207.github.com/2014/06/24/how-to-learn-morse-code/" data-id="cin61d0k00088fyizmbtezyg7" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-iscsi-enterprise-target" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/23/iscsi-enterprise-target/" class="article-date">
  <time datetime="2014-06-22T16:00:00.000Z" itemprop="datePublished">2014-06-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/23/iscsi-enterprise-target/">iSCSI Enterprise Target</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="iSCSI-Enterprise-Target"><a href="#iSCSI-Enterprise-Target" class="headerlink" title="iSCSI Enterprise Target"></a>iSCSI Enterprise Target</h2><h3 id="Introduce"><a href="#Introduce" class="headerlink" title="Introduce"></a>Introduce</h3><pre><code>SCSI     : small computer system interface
iSCSI    : Internet SCSI
Initiator:
Target   :
</code></pre><h3 id="component-of-protocol"><a href="#component-of-protocol" class="headerlink" title="component of protocol"></a>component of protocol</h3><ol>
<li><p>Communication</p>
<ul>
<li>connect </li>
<li>session<ul>
<li>login</li>
<li>full feature</li>
</ul>
</li>
<li>pdu</li>
</ul>
</li>
<li><p>Naming and addressing</p>
<ul>
<li>iqn.iSCSI </li>
<li>eui.IEEEEUI264</li>
</ul>
</li>
<li><p>Error Handle</p>
<ul>
<li>misclassification</li>
<li>Recovery mechanism</li>
</ul>
</li>
<li><p>Security</p>
<ul>
<li>Authentication<ul>
<li>CHAP</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="Code-flow"><a href="#Code-flow" class="headerlink" title="Code flow"></a>Code flow</h3><ol>
<li>Login phase</li>
<li>Data execute of text phase</li>
<li>logout pahse<ul>
<li>Report LUNS(0xa0)-&gt; </li>
<li>Inquiry(0x12) -&gt; </li>
<li>Read Capacity(10) (0x25) -&gt; </li>
<li>Read(10)(0x28) -&gt; </li>
<li>Mode Sense(6)(0x1a)</li>
</ul>
</li>
</ol>
<h3 id="Source-code"><a href="#Source-code" class="headerlink" title="Source code"></a>Source code</h3><ul>
<li><p>source:</p>
</li>
<li><p>build:</p>
</li>
<li><p>patch</p>
<pre><code>tar xvf iscsitarget-1.4.20.tar.gz
cd iscsitarget-1.4.20
patch -p1 &lt; ../iscsitarget-1.4.20_patch/compat-2.6.32.patch
patch -p1 &lt; ../iscsitarget-1.4.20_patch/iscsitarget-xxx-1.4.20_for_centos_6_2.patch
patch -p1 &lt; ../iscsitarget-1.4.20_patch/iscsi_conn_close_raid_failed.patch
patch -p1 &lt; ../iscsitarget-1.4.20_patch/iscsi_load_balance_bug_fix.patch
patch -p1 &lt; ../iscsitarget-1.4.20_patch/iscsi_flow_control.patch
patch -p1 &lt; ../iscsitarget-1.4.20_patch/iscsi_disable_sync_cache.patch
</code></pre></li>
</ul>
<h3 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h3><h4 id="Kernel-module"><a href="#Kernel-module" class="headerlink" title="Kernel module"></a>Kernel module</h4><p>iscsi_trgt.ko</p>
<p>most of the work were done in kernel, such as data send and recv,<br>and the user mode do session create, author and login.</p>
<p>sub-module list as below:</p>
<ul>
<li>Files<ul>
<li>iotype.c</li>
<li>nthread.c<ul>
<li>listen iSCSI request from iSCSI Initiator</li>
<li>receive iSCSI request</li>
<li>initialize iSCSI Command structure and LUN parameters</li>
<li>allocate data cache (struct tio)</li>
<li>handle r2t data</li>
</ul>
</li>
<li>wthread.c<ul>
<li>communicate with nthread</li>
<li>handle iSCSI command from nthread</li>
<li>command can be divided into two types: related , not related </li>
<li>execute callback function</li>
</ul>
</li>
<li>response<ul>
<li>dispatch by wthread</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="User-module"><a href="#User-module" class="headerlink" title="User module"></a>User module</h4><p>ietd daemon, manager tool for IET, function description:</p>
<ul>
<li>configuration, such as port, uid, gid and so on.</li>
<li>read config info from /etc/ietd.conf, and send to kernel module </li>
</ul>
<h4 id="iSCSI-mod"><a href="#iSCSI-mod" class="headerlink" title="iSCSI mod"></a>iSCSI mod</h4><ul>
<li>blockio<br>translate network data to struct tio, then handle by<br>blockio_make_request from block_io.c, submit_bio to<br>common layer after generate bio </li>
<li>fileio<br>still use VFS, and do system call read/write to operate data.</li>
<li>functional description  </li>
</ul>
<h3 id="How-IET-add-lun"><a href="#How-IET-add-lun" class="headerlink" title="How IET add lun?"></a>How IET add lun?</h3><p>加入volume有两种方式:</p>
<ol>
<li>通过配置文件ietd.conf</li>
<li>通过ietdadm命令，使用<code>--op new --tid=[id] --lun=[lun] --params Path=[path]</code>参数</li>
</ol>
<p>第一种方式的流程如下: (用户态)<br><code>plain_init() -&gt; __plain_lunit_create -&gt; ki-&gt;lunit_create -&gt; iscsi_lunit_create -&gt; ioctl(ctrl_fd, ADD_VOLUME, &amp;info)</code></p>
<p>第二种方式的流程如下: (用户态)<br><code>ietadm_request_exec -&gt; cops-&gt;lunit_add() -&gt; plain_lunit_create() -&gt; __plain_lunit_create</code>  后面同上</p>
<p>核态部分相同:  </p>
<ul>
<li><code>config.c:add_volume -&gt; volume.c:volume_add -&gt; volume.c:parse_volume_params</code> </li>
<li><code>volume.c:parse_volume_params</code> 函数检查发现是opt_iomode类型，  </li>
</ul>
<h3 id="Type-IOMode-and-Sector-Setting"><a href="#Type-IOMode-and-Sector-Setting" class="headerlink" title="Type, IOMode and Sector Setting"></a>Type, IOMode and Sector Setting</h3><p>Run by the ietadm command as below:  </p>
<ul>
<li><code>ietadm --op new --tid=%d --lun=%d --params Path=/dev/%s/%s,IOMode=%s,Sector=%s,Type=%s</code><ul>
<li><strong>IOMode</strong>: wb or wt or ro</li>
<li><strong>Sector</strong>: 512 or 4096</li>
<li><strong>Type</strong>: fileio or blockio</li>
</ul>
</li>
</ul>
<p>Function calling:</p>
<ul>
<li><code>ietadm.c: main() -&gt; lunit_handle() -&gt; ietd_request() -&gt; ietd_connect(),ietd_request_send(),ietd_response_recv()</code><ul>
<li><code>ietd_connect() -&gt; socket(AF_LOCAL, SOCK_STREAM, 0), connect()</code></li>
<li><code>ietd_request_send() -&gt; write(fd, req, sizeof(*req))</code></li>
<li><code>ietd_request_recv() -&gt; readv(), read()</code></li>
</ul>
</li>
<li><code>ietd.c: main() -&gt; message.c: ietadm_request_listen() -&gt;</code><ul>
<li><code>ietadm_request_listen() -&gt; socket(AF_LOCAL, SOCK_STREAM, 0), bind(), listen()</code></li>
</ul>
</li>
</ul>
<p>Code analysis:  </p>
<ul>
<li><code>ietadm --op new --tid= --lun= --params</code><ul>
<li>调用 ietadm.c:lunit_handle函数 -&gt;ietd_request函数 -&gt;ietd_request_send函数</li>
<li>ietd.c的event_loop函数监听到有消息，执行message.c:ietadm_request_handle函数 </li>
<li>message.c:ietadm_request_handle函数 -&gt; ietadm_request_exec函数<br>类型为C_LUNIT_NEW, 执行cops-&gt;lunit_add  </li>
<li><code>plain.c:plain_lunit_create -&gt;__plain_lunit_create -&gt; ki-&gt;lunit_create</code> </li>
<li><code>ctldev.c:iscsi_lunit_create -&gt; ioctl(ctrl_fd, ADD_VOLUME, &amp;info)</code> </li>
<li><code>config.c:add_volume -&gt; volume.c:volume_add -&gt; volume.c:parse_volume_params</code> </li>
<li><code>volume.c:parse_volume_params</code> 函数检查发现是opt_iomode类型，<br>如果是ro类型执行SetLUReadonly(volume);<br>如果是wb类型执行SetLUWCache(volume);<br>如果是wt类型则类型不可用  </li>
<li>SetLUReadonly和SetLUWCache都在iscsi.h中定义，都只是修改struct iet_volume结构体中的flags的值。</li>
<li>另外块大小blocksize保存在结构体struct iet_volume的blk_shift中,且块大小必须是<br>2的幂次方，大于等于512，小于4096. 注意保存的是2的幂的次数，即如果是1024，则blk_shift是10</li>
<li>如果fileio,进入file-io.c:fileio_attach函数, 调用parse_fileio_params, 这里会忽略好些参数的值.<br>之用path参数会有处理。  </li>
<li>如果blockio,进入block-io.c:blockio_attach函数, 调用parse_blockio_params, 这里会忽略好些参数的值.<br>之用path参数会有处理。  </li>
<li>file-io.c 和 block-io.c要好好看看，这个逻辑卷到底怎么创建的.</li>
</ul>
</li>
</ul>
<p>Summary:</p>
<ul>
<li><strong>总结:</strong><ul>
<li>Type: <strong>如果是fileio那么读写操作通过vfs请求完成，如果是blockio则读写操作直接构造bio请求</strong></li>
<li>IOMode: <strong>如果是wb,    </strong></li>
<li>Sector</li>
</ul>
</li>
</ul>
<h3 id="Other-iSCSI-implement"><a href="#Other-iSCSI-implement" class="headerlink" title="Other iSCSI implement"></a>Other iSCSI implement</h3><ul>
<li>open-iscsi, <a href="http://open-iscsi.org" target="_blank" rel="external">homepage</a>,<br><a href="https://github.com/mikechristie/open-iscsi" target="_blank" rel="external">source</a>,<br><a href="http://blog.chinaunix.net/uid-14518381-id-3237994.html" target="_blank" rel="external">code analysis</a></li>
</ul>
<h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="http://en.wikipedia.org/wiki/ISCSI" target="_blank" rel="external">ISCSI Wikipedia</a></li>
<li><a href="http://iscsitarget.sourceforge.net" target="_blank" rel="external">iSCSITarget</a></li>
<li><a href="http://sourceforge.net/projects/iscsitarget/files/iscsitarget/" target="_blank" rel="external">iSCSITarget download</a></li>
<li><a href="http://blog.csdn.net/kidd_3/article/details/7670415" target="_blank" rel="external">iSCSI Enterprise Target的架构分析</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://matrix207.github.com/2014/06/23/iscsi-enterprise-target/" data-id="cin61d0k5008cfyiztp1oujzf" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-software-agent" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/06/21/software-agent/" class="article-date">
  <time datetime="2014-06-20T16:00:00.000Z" itemprop="datePublished">2014-06-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/21/software-agent/">software agent</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Concepts"><a href="#Concepts" class="headerlink" title="Concepts"></a>Concepts</h3><p>M.Minsky曾经在1994年就指出，“Agent是一些具有特别技能的个体”。针对计算机系统，<br>Agent是指“当使用者向机器说明完成某些任务，而无需了解机器自身是如何工作，即将其处理为黑箱时，就称其为Agent。”<br>目前学术界对其尚无一个公认的定义，国内多将其译为智能代理。</p>
<h3 id="Application"><a href="#Application" class="headerlink" title="Application"></a>Application</h3><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul>
<li><a href="http://en.wikipedia.org/wiki/Software_agent" target="_blank" rel="external">software agent</a></li>
<li><a href="http://en.wikipedia.org/wiki/Agent_Communications_Language" target="_blank" rel="external">ACL</a></li>
<li><a href="http://en.wikipedia.org/wiki/Agent-oriented_programming" target="_blank" rel="external">AOP: Agent oriented programming</a></li>
<li><a href="http://baike.baidu.com/link?url=MEUtNP6k1W7gXK2LcHdKX4O46UT4kAwv4Bje2hTKHAQSitqlCvbSAjK3z_iex6GdE8jRgcQc91kTPphXPEecIK" target="_blank" rel="external">Agent技术</a></li>
<li><a href="http://en.wikipedia.org/wiki/Java_Agent_Development_Framework" target="_blank" rel="external">JADE</a></li>
<li><a href="http://www.agentbuilder.com/index.html" target="_blank" rel="external">agentbuilder</a></li>
<li><a href="http://www.agentbuilder.com/Documentation/whyAgents.html" target="_blank" rel="external">Why, When, and Where to Use Software Agents</a> </li>
<li><a href="http://ootips.org/agent-orientation.html" target="_blank" rel="external">Agent Oriented Programming</a></li>
<li><a href="http://en.wikipedia.org/wiki/FIPA" target="_blank" rel="external">FIPA</a></li>
<li><a href="http://stackoverflow.com/questions/5216865/agent-oriented-design-in-the-real-world" target="_blank" rel="external">Agent Oriented Design in the real world?</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://matrix207.github.com/2014/06/21/software-agent/" data-id="cin61d0jy0086fyizbh4isan4" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/6/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/8/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/debug/">debug</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/kernel/">kernel</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/math/">math</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/windows/">windows</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ARP/" style="font-size: 10px;">ARP</a> <a href="/tags/Auto-Compile/" style="font-size: 10px;">Auto Compile</a> <a href="/tags/Batch-File/" style="font-size: 10px;">Batch File</a> <a href="/tags/C/" style="font-size: 10px;">C</a> <a href="/tags/Emacs/" style="font-size: 10px;">Emacs</a> <a href="/tags/FAQ/" style="font-size: 10px;">FAQ</a> <a href="/tags/ICMP/" style="font-size: 10px;">ICMP</a> <a href="/tags/IRC/" style="font-size: 10px;">IRC</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/NetworkStack/" style="font-size: 12.5px;">NetworkStack</a> <a href="/tags/Notepad/" style="font-size: 10px;">Notepad++</a> <a href="/tags/Translation/" style="font-size: 17.5px;">Translation</a> <a href="/tags/WinIO/" style="font-size: 10px;">WinIO</a> <a href="/tags/api/" style="font-size: 10px;">api</a> <a href="/tags/arp/" style="font-size: 10px;">arp</a> <a href="/tags/auto-compile/" style="font-size: 10px;">auto compile</a> <a href="/tags/awk/" style="font-size: 12.5px;">awk</a> <a href="/tags/batch/" style="font-size: 20px;">batch</a> <a href="/tags/blat/" style="font-size: 12.5px;">blat</a> <a href="/tags/blog/" style="font-size: 10px;">blog</a> <a href="/tags/book/" style="font-size: 10px;">book</a> <a href="/tags/dot/" style="font-size: 10px;">dot</a> <a href="/tags/exploit/" style="font-size: 10px;">exploit</a> <a href="/tags/flowchart/" style="font-size: 10px;">flowchart</a> <a href="/tags/gedit/" style="font-size: 10px;">gedit</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/github/" style="font-size: 12.5px;">github</a> <a href="/tags/google/" style="font-size: 10px;">google</a> <a href="/tags/graphviz/" style="font-size: 10px;">graphviz</a> <a href="/tags/hardware-monitor/" style="font-size: 10px;">hardware monitor</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/javascript/" style="font-size: 10px;">javascript</a> <a href="/tags/jekyll/" style="font-size: 10px;">jekyll</a> <a href="/tags/kernel/" style="font-size: 10px;">kernel</a> <a href="/tags/kvm/" style="font-size: 12.5px;">kvm</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/lisp/" style="font-size: 10px;">lisp</a> <a href="/tags/mac/" style="font-size: 10px;">mac</a> <a href="/tags/mail/" style="font-size: 10px;">mail</a> <a href="/tags/malloc-abc/" style="font-size: 10px;">malloc abc</a> <a href="/tags/mathematician/" style="font-size: 10px;">mathematician</a> <a href="/tags/maxima/" style="font-size: 10px;">maxima</a> <a href="/tags/mtrace/" style="font-size: 10px;">mtrace</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/net-snmp/" style="font-size: 10px;">net-snmp</a> <a href="/tags/netbios/" style="font-size: 10px;">netbios</a> <a href="/tags/network/" style="font-size: 10px;">network</a> <a href="/tags/nodejs/" style="font-size: 10px;">nodejs</a> <a href="/tags/novels/" style="font-size: 10px;">novels</a> <a href="/tags/opennebula/" style="font-size: 10px;">opennebula</a> <a href="/tags/org-mode/" style="font-size: 10px;">org mode</a> <a href="/tags/pandoc/" style="font-size: 10px;">pandoc</a> <a href="/tags/plugin/" style="font-size: 10px;">plugin</a> <a href="/tags/raid/" style="font-size: 10px;">raid</a> <a href="/tags/rsync/" style="font-size: 10px;">rsync</a> <a href="/tags/sed/" style="font-size: 12.5px;">sed</a> <a href="/tags/shell/" style="font-size: 17.5px;">shell</a> <a href="/tags/skype/" style="font-size: 12.5px;">skype</a> <a href="/tags/source-analyze/" style="font-size: 10px;">source analyze</a> <a href="/tags/sqlite/" style="font-size: 10px;">sqlite</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/study/" style="font-size: 10px;">study</a> <a href="/tags/svn/" style="font-size: 17.5px;">svn</a> <a href="/tags/tunnel/" style="font-size: 10px;">tunnel</a> <a href="/tags/valgrind/" style="font-size: 12.5px;">valgrind</a> <a href="/tags/vi/" style="font-size: 10px;">vi</a> <a href="/tags/vim/" style="font-size: 17.5px;">vim</a> <a href="/tags/wget/" style="font-size: 10px;">wget</a> <a href="/tags/wifi/" style="font-size: 10px;">wifi</a> <a href="/tags/wireless-tools/" style="font-size: 10px;">wireless-tools</a> <a href="/tags/wpa-supplicant/" style="font-size: 10px;">wpa_supplicant</a> <a href="/tags/xml/" style="font-size: 10px;">xml</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">March 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09/">September 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08/">August 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/07/">July 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/04/">April 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">March 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">November 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">September 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08/">August 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">July 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">May 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/03/">March 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">February 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/09/">September 2012</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/04/18/hexo/">Hexo</a>
          </li>
        
          <li>
            <a href="/2016/04/13/malloc/">malloc</a>
          </li>
        
          <li>
            <a href="/2016/03/12/performance-optimization-of-cplusplus/">performance optimization of C++</a>
          </li>
        
          <li>
            <a href="/2016/03/09/stack-trace-when-program-crash/">stack trace when program crash</a>
          </li>
        
          <li>
            <a href="/2016/03/09/database-knowledges/">Database knowledges</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Matrix207<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>